[{"title":"A Design Scheme for Personal Cloud","url":"/2021/10/27/a-design-scheme-for-personal-cloud.html","content":"\n21 century is a data world, we generate data, we consume data, and we protect data. Want to do more? Maybe you can follow this article.\n\n\n\nWhyNowdays, our personal data is growing bigger and bigger. Photos, videos, documents, all this kind of files fill in the computer, smart phone or external drive.\nI can’t say they are all important for me, but some does mean a lot and I don’t want to lose them.\nMeanwhile, our parents also generate many data exeryday, but they don’t even have any backup, if their mobile phone gets broken, they will lose everything.\nWhat’s worse, the public cloud service is too expensive for normal people, you knwo we just want to store some photos, not something like the password of nuclear bomb. And the privacy is also a disputed issue.\nThen I came up with the idea of building up a personal cloud service, it should be cheap and kind of reliable. Also, it would be better if we can use open source softwares.\nI hope this article could help you.\nSchemeAs a cloud, it must can be accessed remotely, thus we need a public IP address. And of course, to keep private, https will be considered, then a domain is needed as well.\nTo control the budget, it’s not acceptable to purchase a VPS with large storage capacity, a NAS would be a good choice. But the retail NAS is also too expensive, so I will make up one by myself, after all, it’s just a computer basically. Because the NAS is in the private network, some technology will be used to make it accessible.\nAfter days of investigation, I got the following list:\nHardware\n\nCPU: Intel J3455\nMotherboard: ASRock J3455-ITX (CPU included)\nMemory: SK Hynix 8GB DDR3L dual channel\nSystem drive: Intel 520 SSD 120GB\nData drive: WD Purple WD40EJRX 4TB * 2\nCase: U-NAS NSC-201\n\nSoftware\n\nOS: Ubuntu Server 20.04\nCloud Service: Nextcloud\nReverse proxy: FRP &amp; Nginx\nFilesystem: ZFS\n\nVPS\n\nAliyun Simple Application Server\n\nThe whole scheme is like this:\n\n\nStorageThough budget matters, but we don’t want to lose data anyway. And the most dangerous situation is hardware broken, especially hard driver failure. To mitigate this condition, we will use a software RAID1, and it’s achieved by a mirror pool of ZFS.\nTo make use of ZFS on Ubuntu, we need to install it first:\nsudo apt install zfsutils-linux\n\nThen, suppose the data driver is /dev/sdb and /dev/sdc, to create a mirror pool named storage:\nsudo zpool create storage mirror /dev/sdb /dev/sdcsudo zfs set mountpoint=none storagesudo zpool status\n\nFinally we create a ZFS filesystem for Nextcloud and mount it to /var/www/nextcloud:\nsudo zfs create storage/nextcloudsudo zfs set mountpoint=/var/www/nextcloud storage/nextcloud\n\nNextcloudInstallationWe will install Nextcloud on Ubuntu Server 20.04.\n\nInstall packages\nsudo apt install apache2 mariadb-server libapache2-mod-php7.4 php7.4-gd php7.4-mysql php7.4-curl php7.4-mbstring php7.4-intl php7.4-gmp php7.4-bcmath php-imagick php7.4-xml php7.4-zip\n\nInstall Nextcloud\nGoto Nextcloud, select Download for server and copy the link, then download and unpack the tarball, copy the nextcloud directory to webroot. We need to change the owner as well to make Apache be able to modify the files in it.\nwget https://download.nextcloud.com/server/releases/nextcloud-22.2.0.tar.bz2tar -xf nextcloud-22.2.0.tar.bz2sudo cp -r nextcloud /var/www/sudo chown -R www-data:www-data /var/www/nextcloud/\n\nConfigure database\nWe will create a user as well as a database for Nextcloud. Please replace the username and password to the one you want.\nsudo mysqlCREATE USER &#x27;username&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;CREATE DATABASE IF NOT EXISTS nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;GRANT ALL PRIVILEGES ON nextcloud.* TO &#x27;username&#x27;@&#x27;localhost&#x27;;FLUSH PRIVILEGES;quit;\n\nConfigure Apache\nFor security reasons, https will be used, thus we need to generate a self-signed certificate firstly.\nopenssl req -newkey rsa:4096 -x509 -sha256 -days 365 -nodes -out nextcloud.crt -keyout nextcloud.keysudo mv nextcloud.crt /etc/ssl/certs/sudo mv nextcloud.key /etc/ssl/private/\n\nThen create a new Apache config file for Nextcloud: /etc/apache2/sites-available/nextcloud.conf, with the following content:\n&lt;IfModule mod_ssl.c&gt;        &lt;VirtualHost _default_:443&gt;                ServerName nextcloud.colorfulshark.net                &lt;IfModule mod_headers.c&gt;                        Header always set Strict-Transport-Security &quot;max-age=15552000; includeSubDomains&quot;                &lt;/IfModule&gt;                DocumentRoot /var/www/nextcloud                ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log                CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined                SSLEngine on                SSLCertificateFile      /etc/ssl/certs/nextcloud.crt                SSLCertificateKeyFile /etc/ssl/private/nextcloud.key                &lt;FilesMatch &quot;\\.(cgi|shtml|phtml|php)$&quot;&gt;                                SSLOptions +StdEnvVars                &lt;/FilesMatch&gt;                &lt;Directory /usr/lib/cgi-bin&gt;                                SSLOptions +StdEnvVars                &lt;/Directory&gt;        &lt;/VirtualHost&gt;&lt;/IfModule&gt;\n\nEnable necessary Apache modules\nsudo a2enmod rewrite headers env dir mime ssl\n\nEnable Nextcloud website\nsudo a2ensite nextcloud.conf\n\nReload Apache service\nsudo systemctl restart apache2\n\nConfigure Nextcloud\nNow we can access the Nextcloud website in Chrome, because we are using self-signed certificate, the browser may refuse to open the website, we can simply type thisisunsafe on the blocked page.😂\nhttps://10.0.0.10\n\nOn this page, we need to input following information:\n\nadmin username\nadmin password\ndata folder\nmysql username\nmysql password\nmysql database name\n\nFinally, a welcome page will show up.\n\n\nOptimization\nIncreate PHP memory limitation\nsudo vim /etc/php/7.4/apache2/php.ini&lt;&lt;&lt;memory_limit = 512M&gt;&gt;&gt;sudo systemctl restart apache2\n\nDisable PHP output_buffering\nsudo vim /etc/php/7.4/apache2/php.ini&lt;&lt;&lt;output_buffering = Off&gt;&gt;&gt;sudo systemctl restart apache2\n\nSet AllowOverride to All for /var/www/ to protect data\nsudo vim /etc/apache2/apache2.conf&lt;&lt;&lt;&lt;Directory /var/www/&gt;        Options Indexes FollowSymLinks        AllowOverride All        Require all granted&lt;/Directory&gt;&gt;&gt;&gt;sudo systemctl restart apache2\n\nEnable HTTP Strict Transport Security\n&lt;VirtualHost *:443&gt;  ServerName cloud.nextcloud.com    &lt;IfModule mod_headers.c&gt;      Header always set Strict-Transport-Security &quot;max-age=15552000; includeSubDomains&quot;    &lt;/IfModule&gt; &lt;/VirtualHost&gt;\n\nEnable SVG support for php-imagick\nsudo apt install imagemagick\n\nEnable Memory caching\nsudo apt install php-apcusudo vim /var/www/nextcloud/config/config.php&lt;&lt;&lt;&#x27;memcache.local&#x27; =&gt; &#x27;\\OC\\Memcache\\APCu&#x27;,&gt;&gt;&gt;sudo bash -c &quot;echo &#x27;apc.enable_cli = 1&#x27; &gt; /etc/php/7.4/cli/conf.d/enable-apc-cli.ini&quot;sudo systemctl restart apache2\n\nSetup phone region\nsudo vim /var/www/nextcloud/config/config.php&lt;&lt;&lt;&#x27;default_phone_region&#x27; =&gt; &#x27;CN&#x27;,&gt;&gt;&gt;\n\nPretty URLs\nvim /var/www/nextcloud/config/config.php&lt;&lt;&lt;&#x27;overwrite.cli.url&#x27; =&gt; &#x27;https://nextcloud.colorfulshark.net&#x27;,&#x27;htaccess.RewriteBase&#x27; =&gt; &#x27;/&#x27;,&gt;&gt;&gt;sudo -u www-data php /var/www/nextcloud/occ maintenance:update:htaccess\n\nSetup Cron background job\nsudo crontab -u www-data -e*/5  *  *  *  * php -f /var/www/nextcloud/cron.php\n\nNetworkThis would be an interesting part, because we are going to make the Nextcloud be accessible remotely. \nDomainTo make use of https, we need a domain and set a A record to the IP address of VPS. Suppose the domain is nextcloud.colorfulshark.net.\nA certificate is also needed  for https usage,  it can be registered from Letsencrypt.\nsudo su &amp;&amp; cdapt install openssl cron socat curlcurl https://get.acme.sh | shsource ~/.bashrc~/.acme.sh/acme.sh --register-account -m colorfulshark@gmail.comdomain=nextcloud.colorfulshark.netcert=/usr/local/etc/certs/nextcloud.colorfulshark.net.certkey=/usr/local/etc/certs/nextcloud.colorfulshark.net.key~/.acme.sh/acme.sh --issue -d $domain --standalone --keylength ec-256 --force~/.acme.sh/acme.sh --installcert -d $domain --ecc --fullchain-file $cert --key-file $key\n\nFRPBecause the NAS is in internal network, to access it remotely, we need to setup reverse proxy for Nextcloud web service by using FRP.\nVPS side: /etc/frp/nextcloud.ini\n[common]bind_addr = 0.0.0.0proxy_bind_addr = 127.0.0.1bind_port = 7000vhost_https_port = 7443token = passwordtls_enable = true\n\nNAS side: /etc/frp/nextcloud.ini\n[common]server_addr = nextcloud.colorfulshark.netserver_port = 7000token = passwordtls_only = truetls_enable = true[nextcloud]type = httpslocal_port = 443custom_domains = nextcloud.colorfulshark.net\n\nThen accessing localhost:7443 on VPS is equal to accessing localhost:443 on NAS.\nNginxThough FRP supports TLS for https reverse proxy, Nginx would be better. Because there may exist many web services on VPS and they all use https. By using Nginx, we can proxy pass these services by identifying domain and path.\nVPS side\n/etc/nginx/sites-available/nextcloud.colorfulshark.net\nserver &#123;  listen 443 ssl;  listen [::]:443 ssl;  ssl_certificate       /usr/local/etc/certs/nextcloud.colorfulshark.net.cert;  ssl_certificate_key   /usr/local/etc/certs/nextcloud.colorfulshark.net.key;  ssl_session_timeout 1d;  ssl_session_cache shared:MozSSL:10m;  ssl_session_tickets off;  ssl_protocols         TLSv1.3;  ssl_ciphers           ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;  ssl_prefer_server_ciphers off;  server_name           nextcloud.colorfulshark.net;  location / &#123;    proxy_ssl_server_name on;    proxy_ssl_name $host;    proxy_http_version 1.1;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;    proxy_set_header Upgrade $http_upgrade;    proxy_set_header Connection &quot;upgrade&quot;;    proxy_set_header Host $http_host;    proxy_redirect off;    proxy_pass https://127.0.0.1:7443;    client_max_body_size 1024m;  &#125;&#125;\n\nEnable this site and resart Nginx\nsudo ln -s /etc/nginx/sites-available/nextcloud.colorfulshark.net /etc/nginx/sites-enabled/sudo systemctl restart nginx\n\nNextcloudYes, we are back to Nextcloud again, because Nextcloud only accepts the request from trusted domains, thus we need to let it trust nextcloud.colorfulshark.net as well.\nNas side\n/var/www/nextcloud/config/config.php\n&#x27;trusted_domains&#x27; =&gt;array (  0 =&gt; &#x27;10.0.0.10&#x27;,  1 =&gt; &#x27;nextcloud.colorfulshark.net&#x27;,),\n\nNow you can assess the Nextcloud through https://nextcloud.colorfulshark.net.\nMaintenance\nUpgrade\nsudo -u www-data php /var/www/nextcloud/updater/updater.pharsudo -u www-data php /var/www/nextcloud/occ upgradesudo -u www-data php /var/www/nextcloud/occ maintenance:mode --off\n\nBackup database\n#!/bin/bashnumber=$(($(date +%u) % 2))db_file=&quot;nextcloud_$&#123;number&#125;.sql&quot;# enter maintenance modesudo -u www-data php --define /var/www/nextcloud/occ maintenance:mode --onmysqldump --single-transaction --default-character-set=utf8mb4 nextcloud &gt; /var/www/nextcloud/backup/$db_filesync# exit maintenance modesudo -u www-data php --define /var/www/nextcloud/occ maintenance:mode --off\n\nAnd set a cron job\nsudo crontab -e0 5 * * * /var/www/nextcloud/backup/backup_db.sh\n\nRestore database\nsudo mysql -e &quot;DROP DATABASE nextcloud&quot;sudo mysql -e &quot;CREATE DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci&quot;sudo mysql nextcloud &lt; nextcloud_0.sql\n\nRestore from system reinstallation\n\nInstall all necessary packages\n\nRestore nextcloud database\n\nCreate database user and grant permission\n\nFinish all configuration and optimization\n\n\n\n\nReferencehttps://docs.nextcloud.com/server/latest/admin_manual/installation/example_ubuntu.html\nhttps://docs.nextcloud.com/server/latest/admin_manual/installation/source_installation.html\nhttps://docs.nextcloud.com/server/latest/admin_manual/configuration_server/occ_command.html\nhttps://docs.nextcloud.com/server/latest/admin_manual/maintenance/backup.html\nhttps://docs.nextcloud.com/server/latest/admin_manual/maintenance/restore.html\n","categories":["Geek"],"tags":["nextcloud","zfs","nginx","nas"]},{"title":"在Ubuntu（Debian）下烧写全志A33系统镜像","url":"/2018/04/30/a33-flash-firmware-under-ubuntu.html","content":"\n最近从箱底翻出来一个平板，是当时参加一个培训机构赠（购）送（买）的。不过工作之后就没碰过了，附有完整的Android和LinuxQt的源代码，全志A33平台，还是挺有可玩性，所以就搭建了开发环境，因为给的文档里说是在Windows下进行烧录。但是我使用的纯Linux环境，而且烧写程序无非就是向一个USB设备写数据，不存在系统限制，所以Google到了全志的一个Linux平台烧录工具——LiveSuit。\n\n参考：LiveSuit wiki\n\n\n软件下载git clone https://github.com/colorfulshark/sunxi-livesuite.gitcd sunxi-livesuite\n\n编译USB驱动全志针对自己设备的烧录所开发USB设备驱动——awusb\nsudo apt install dkmssudo cp -r awusb /usr/src/awdev-0.5sudo dkms add -m awdev -v 0.5sudo dkms build -m awdev -v 0.5sudo dkms install -m awdev -v 0.5\n\n修改udev规则这一步的目的是让你能使用普通用户权限执行烧录工具，因为设备节点默认是只有root用户可访问的。\nsudo vim /etc/udev/rules.d/10-local.rules# 注意将&lt;your group&gt;替换为用户所在的组，一般跟你的用户名一样SUBSYSTEM!=&quot;usb_device&quot;, ACTION!=&quot;add&quot;, GOTO=&quot;objdev_rules_end&quot;#USBaspATTRS&#123;idVendor&#125;==&quot;1f3a&quot;, ATTRS&#123;idProduct&#125;==&quot;efe8&quot;, GROUP=&quot;&lt;your group&gt;&quot;,MODE=&quot;0666&quot;LABEL=&quot;objdev_rules_end&quot;# 重启udev服务# sysvinit:sudo service udev restart# systemdsudo systemctl restart udev.service\n\n烧录镜像首先进入刚才克隆的源码的根目录\n./LiveSuit.sh\n\n可以看到烧录工具已经启动\n\n\n烧录的方式软件里面已经介绍，但如果你的设备有reset键的话，可以使用下面的方式，因为我的设备在LinuxQt环境下用电源键是关不了机的，所以只能这样。\n\n打开烧录工具\n将设备与电脑连接\n按住音量键，然后按一下复位键，并连续短按几次电源键\n开始烧录\n\n\n\n\n\n\n\n\n","categories":["Embedded"],"tags":["全志","a33","烧写","ubuntu","debian"]},{"title":"与小灰灰的恋爱实践","url":"/2021/02/15/best-practice-of-loving-with-zyh.html","content":"\n  01a8a38a1635bd5785056b4766e32e24343196b355268e37381669ec56d40bb5d5ac269d133b50b4c0fdf92efe32fca7807be4f4f2d1ee6f318a9e0f5e9a338cf12da53c95b8b833a335b35c91f42d7f2a1941390e3b1b3c143694e2eece185a115e4f604b2e6366b64e49485746a28b56b651ed1d0954cc6ab2ac80b02323ba9700acb25726625dcd3b3a4d92ff057e84d220c6f4108a90eb737f1bda3d65466e63b5c1679258eb74b8c3f192da92ecec5d5dbc8f00dc3a9f56f11f0a71186c952feae7cc733538d80dd94e9756ae12db53d96df18d74e9eb79fdcbfb9e9183e78e1319e9a6f76fa6918e0dacbae5e57371c470af11a46f41ac2c41744a87ca85af37f6e1528d4d8955e958de757b1a6de8cf608fbb9ead798bd29bc3f14e431cca9c5f5973a6cf1affa3893718e68456189d9461d5a3ed8985535c0be43fe8bf7f23c8de5bccf8a6050981f1a7e6aa0b957cb7dc5eb871c7329a06d80c1d6da84b1ab53cf975b98444e57087c47014c2b2c77535ea970f02084a928ddcf418753457be76ce8c58f1500771207cf6342b28b7d760bdad496daeedaabc1e186f22c8fcb84883ac5533ccb328f3868fdd716fc227a818611b4a52e1368b89e4c7b48a7c56825cec3309dbc08cc3a57c476aeb930348a2fdff40bf28e0fb208b3b14eedd37cbf2f0449ed05263ca57b3c683b5d46ec5be903018e5de2cac2472660f3968402f06cf6bb42f5057a9abcc5db172f84be66c22f725300e93f7bc003124b9bb89beb61652b29d99aa5e6c436d265b2c9766296e2144d66cb582ff16e54166b21d617e141f2523b5ce3cfd642b846dadd09306c0294ac11162e1f388717bc5c45594971b60863d14987aa9069f63cea9e0092b091ec56360de081f49326895585d16ac032c55583dfaa44046c1f65a19eb2128924b9cd9da7ce17d332254c63b8f34b87ce7df9f624cf6b18e622dc362523980531e4f65912acb544d2463bd2e7b9483520d20b915613308187080def09d89df5d3846791248a67aceb6670472245b707038653b11dabff1f19aae2081fb553afe6f9101bc7b699a22d3ec25e3bede12dc32e695aa39fa387f62f1182910ee4881cb1cf465637ff64d45c60d6552abffb80b8f0200a03f1ce9e551c029e53a0c9e622a7ddcfe52363695dad83c724edc28206fe68b97195a5ce032acc0cef5ce46a1bc4e0eb09a7d6bb04fe565b9c21781f8086d8c53b832947555f6804f8d6dfccec040d5063ebb87c52fdb53995de42f631d4ceada5f36c7354e042ffb4ed09b7829092b35b356d90beae3046f828dd5baf4a8fcc136ede806bbd3e9330b76b06f2aca46db7997188424edbbb4901e81347319989547899331e3fb264d2bfddc770c16973c948c45e68ca9389681bc33a2a61cab113d9aa9a5596e647ea7f1458104a6a0f042b90146b80fc6ab6a4cd91f3d058646c5de4b46b352e0b5642978184a453ece4af11756606238323aca106fa093469b2c8a784c6721d1e67ac631ba13f67c44b1a09782488e8b11deb4ddda3ea694446d9e9d57c8f653cf4209bbc96d7bbe4563588db5f338b3acfacca8f532101fe176e788386835f9f8d6b014a71a8ba61aad46ca618c1a9c9845d8bebe6b4993ea9f845395c9de004fff5c9d9feadb187bddd49e5c0b7f7ddfdbb4a0f7e44e02ccf8363c9671f9deffe70fd8feb75a364ab2f6b83484d930ab9110a2511ecf0f03d7b005bd73a9c08d62637fd5f3cb5c6452137b1ae2731f39d076d7339987a9a921e50b6e28d9f5324d53be450f8354489d548f4451cfd3ad6f3eaa2fc5fcc1575772013c7eae7fe12f2a069b0ae0c382b3940f2ea88542d34d49ccfc2d15cbbac8129d9b7be44e810da35d3388b5fa660905da4f5a8066dcff7bf82f0719ec56ed95da29de7bfa24fcad06499e99969c52c5ded50956097909c4946692bbf3baab7a12c2b32a4f373f72f8d83243e5bcb2bf80309c01066c0872fe2d9a99c6062654d1c9db1ee24c6ae08dab0baa440c12084610c565d66bfe3fb792fc6f53ab9c7c353f816d22e3282bc0f2a546026208f84d4a2178ab4035e598d52e46618282798cc9ba182c97703068114b42e8f6cf4725a177cdc7008756b87681ffaf6bdad0dfaed872b7d4dd136b560a9e82802eaaa1285ed7aefda56efe0f3bb86fe2d1d0bcd49e979ca136a29130ef45310145915fec2ee1ae4d3924d431458959af83f5510c86b28194c85c3958f8687ee44c5fc41acc1f5ad09e7d844d800ac01c923dc7f1b9bfbadc017f7d04ff015b6b65f2261463b42b9f803dd83bfc6283dcf469acb6abef759067eebe5514c4387ae77ec598ea49cb6ebea3762bf02ca70c7e7d4c1383ac02b16774db8d981fd594af338ba8128aa3ba741a1437fd1adaea61e9b467a49702013cfc2e2649fa32e470c399065f9ded05ecf16b54268b68d396234abc24bf83bfed2d6c80545e243c1dc7cbce7b1a9d34a59cab2058c5ac0d82e4c814210b2efef36ceda20f7ac322ee32dc21474a0c856338ca5757b3baf0a0629775f8433455c145302ccdac82be18c5ed147cb82c183a9b510e4c536da95695f054652904772f3fd4f8a20abf331a2ac8612bc629e0b7d8bb5930e647eddebdc4d6f1472971add4b979f99d75b886b6d48c9f29422e13c5375ca5a3de91dd8d8621d9dde639045d5ab37e7e61276f8c88c7b25c2385e63af2731c2bf89c4c71bd6eeacb9d99d1ccd164a7ccd0485a3dbe93b1ddd6641b9402fe1d2892ede2b014e2942c0f6b7776e2d0b7717bf3618ab386df2d8dd00575c8582c397eb1a2ed34cf6668c2f4fce8ef539dd3ac12ac12de60f5911b65722232c53c42157c1e83887041c08da16c828a6655c125af51c4b4bdfa707dab2b9ff2c367e4339842caa2f7ffe17758dfd85577b78e5dff3c3789f09b8b187728ca5ea571eb6c42d87f4aae440510bb1d7e09243d7272d5c43def146edff23787463506df8231856c1304ff7e5b27d332d45c58db1a72e38bea9582c96e0dae65fbf2ad68de0b82331ab9205156c341a4a03f39ce57aa395fabe76701346723c6192e1cc1a271449d78fac0db9d0c256e51473b1b81c81eb2e5cba61c60323e810482b7442ae10a541bfc2bb5523f63dd9f4f43e7ffba19e60907b49a93414d153898eccf43d7fd1638439500cec42fe46df0b40d36ee41c9dd9d1bf3b4c8f13e8d5083e64e5a33af183a5a50926056eabc45c2f960e1b298fa93bfc7d7ce290cde140490e37dc1cc9c8cf051fef78bf3a658f1f328ecbcfa40a07075e7e80eeddfd8173b4e00b5151f2530f7a1233cd7491b56e8a4aaa24ea3bf316f719f24340f56a684240ee462fb27cd9579f24f24c932322b3b73d3a02c5f24dd125854f5a6bd5feafaa2411ce1a450d8f090b82fa8d6610cd448e552880fe271f6e8ace3f5cc98727f80403c5b99f4f47f0f156700d9632deec0779d879641c7b592ff1c30f1f24952df23ece5999d408219d04ee74e6c44c24754ca6d58ed38ff75e327a9ed6b029b12d7039bc95a939dd328ed89586287c29d5dc7095b5aa11715bda97614581600c4f1795d6c9dde1d6ed49c21a28eac6cf114a0b1cca094cab159b876bc0e3602f11d7a475270cb019c0961e79fe2650de2da97bbdac85c35ca0c2ed20d15654a66a742dc37415471a4145db66a823212a9cb4de8db276e97a300d254ec392600fa1b519cd2d2ded3860c4bc78f4787b356f3865d58cd6553064d513deb17f83844900e13021441c580427c6429aed34cae4656717246819de660c36d49bd479d4bf6b39251364d370a4e7c483b93aba56c5b84699a68c11bcc19dd3da47a7856b14709877a77e087ddff61664b1739d911b2a6a7d8638ba76639c78c80be000fe6e9a772b3250284fa6b3fded0159d968612810fbf7698fcf5288af7ee940975f89a5b53f1787ec1a1de98980632d50bfff8023b0db519ffe222d6f388467a730349afceac15ca9584e44856f95a306b9786a957c1c369470adf5f37320693fafae106db2f934ff74a4dedd55ae7e2fef07de79e8cf94cadee745e784978df2deb396c7de732540167614ab8458fd9eef065237da5a5f48b3769be2f64a0077d77eea1fbd4cc13478e47a432f22a3742066758e110e1b82a8f6c1ab89d6ca97022d658bd53e7f4acce5726ebe1cfc82262f13f398f04169a4938dabe6bc33b081bf722a26ff851516e866a7d0bbf615486f862158f970476eb8e9cd5828d65a88048abd5ec3ed61931ef1eac1559bed62e99526a1814b4e0dd238b134131d741470bb6c031e587d1293ba9468f5a73c2da8d6b79865b7c62167251dcc40fe7bf9785f6c463f6b00560339b8dda9712938a03ce95c92483a2b2404ac468f75eae63f92a932cd2a91205938dac66ef6161bfc5617bc65c054dff2b1487e3beefd7e5c2612578b6252ebd1e61933094c26ed9664bb3e75c6873d84f8c9941bdc910059cbf38d04d5ea7cbd1b3665d11ce22a93c6c6b1c4a4f2cf54e3178c17b476f69788cdbbe7526cb407f078d9e3eb8d3ef87c7c1241293d0b3e1eb1f48a74a421a2b7cdea8d4dee973f982bdf9727d55ae32b4ab13e73a6270b31aec3087a84c85c37fd886c51bc3e2aef9547b01a0fa2b3685bb645cbc4ba5333e424e9d04ebccd3712eceeddf2055daa16b3501fa15afa273aad4fd242064d8c64612f61a58cb45c524a7d598957b0e4600a0b61efdeb47d7cd22a57fc9dee9068479d4e5f41637cffe4ebd7a4b609fcee1af102fd09f0d106cae37dffb273e5d0dce1f4ee44b99133b86a6d61d84ea2eed4523f664d138f4d538efff6f0d161b8369ebd1530032a90e15e5eebcee877787f8542ffdc9408a12dc2fc77be2fd847567f34f1eb1259e34086b5e3733034cd550f670fc1c4c66d7ec0cae2e8b415121e47943d893ff19bacafa2befe851deff73d53c91e5c62a9722f29ff8926554b25517b0a70eb544602c43e50669ec3d71c9fdd7ab534565ec48ac8b473cd98167b356186e10664a0ab3faf92eca1580d2e71f375573880a2151268ca538179a8098a970770d37b5b914141ba74e11269514ddcc1bd5ffc0cf854bd654531e1339413efbcdaf0d9c94b3c171912c3f3512b0b2d08a3cd8b2c03cd73c1fa93e149a1c87f71e006a34312199986b9f05917be113cbb4fe3c0c33894e83b1202ed134aff92a3e5feb305ced0ba79957c7292b6495d197ec62f46a71c2606e1c2311f1261f4971723e0cefafcecb9e9a2fd079d122c224fe9379e9def91cdf62e51446b0b5d2967c70dd6a5562d19a81f30c5c3286bdecdd4c480e58b3138b2e1347c6978d889541209d5286b71254fd54412d1c0b225fa5a45f1e5658c2d34af28472586fb51d28fe80cbb48ba930318f0185998f637ccf86b4e083c8c99bb732ca8a9ce978dd788502fdb3719b81e921ed60ff1a4175115260037862c8b33f6aa8640dfb1bc6193262a1189243e91f308d9807477fd65b2a498dc49ca0ce7a2262d0d92bc477c4157d93c3c1837203194a9fee7200d834b4f2b18808b53b8eb489af6900614c16c34736b5acd8ca84d902aee121ca79d16740f242c8b264666b7b0323df34a63725d029650a3733bc5b8b846dc3afea9880ac53c83320ad7e0fdb6b5ab6c5dbc1ad5346cd35d13691f7a97777a1cc6ac32b23c466da124cfb37a91990ac0120c673a06d4973754c42f3f3261616e135aa9ad7f5d2fc94a1cd72178d05d7cb5b8eaf4c5e135c733ee00d9e6803dc1b94a4123b8f7656c9391e645209293e479c994cf8aabc7888c92ada0ed82b71af9faf02b035b6e2b5e016ec7a0ce814e6b0485e08622b3fc54e90ef4aa769af9d514f1269376646ab2a183c9d98cde52131e3294f13e6077ad9da07d6661f6418b749ba44f4debc54fce5f38feea3fae6d34c28a4c425dcd21cff0de26b77bada3414f25b2a852da506ef711eb73b4f7333af54f188ea24cbf1054af64f9b8ca136923ba4bd789f8d1cdc111e46121f8a6d43ca9aa7fd62dba742527d4eeee840ebaeeb579a252a1cc8c1a9060e506283f6aa981d86724beba1e7d63c5efe7cfaa8c91633bacad69a56e59f5068eb6c59684071aa65cb14784ab1fe1a98361db94ae63008a7363a7af696aff398ad5841acfccb559c3701a7dc0cb0749ee5c1acee9bb6627b744a81838ed9508abbf1ec7598c695e717a34bd0bd12f23d60c28720c92ded4359fad2edf6988162bfff6517fc43ab6d6a43727726b52b9e8fc866f9601639b6c441091662991ee8efb09371e58d8e3dc20c7802e232aa6ca0bd18fa7e885aa67ceb7435d156f3d75ab8d2be6be17ea35346640f1056d7abec4ae94dc19b8809f7afaaa2b05a8c6037eefc77036630e0394ab0a79ea048a8d2fb53e5fa7d981067c050f7f22842236c4b786562267abebc32176ab470515a7b6b35dd4b5dfd92c168f83d42aceadd760bcc292c7cb11c2c4d926c158a942368a9bcc4e7ae1dd399559bd246a2e3860a3b66c92d52f058f3cd2dd1ff95628788e8cc664acc912979f259d6573532bb6c07f0c9907aee85897cb85934dbac5cfae20a2618c94317c813e2619a275fa55eaf694410b1f63f6c9ece20f3bb0ad7c234f97d59e73a0b37edf0c23d871b351c93381332b4b1d4bfd3987328acec0061c2d7d1520a649583ce3d8257980d9a50c66b5249df79c5198bb623a2f503c1e46dd0b4b4137e1d82e5044324d088a029b18a86c8918717727960fc7aa4acc35fcce1d683dc3898853da082a292a988338d4d3ada82ab5c56f0214c83fa9df9a0e77e0f71e713051d5d2de857efd0df15d80ff9cc35feac3e937feac963b3fa2cc0cca8352852d6ed392534fb534274ff587b5b4b86c8c043bf4de00b17685805f4d51bc10a0f3dadff27dca0f6c072eda65b61b805c581cd474aebb73365a4e3d0aa6742de89059dbd04dcd6b81709cb2f91e39c459eb7140224c2eb971b4e9542d8d9fc04800983d5ffd77d7078d55a70b29e3feba68e87bd73f3da376edc461e590e65804e10cc9cbca968a66fb6083f3db2c54e9b2326237e14893e707ae107163bc3f7860e3c0d48308cd4dd1c1f9304eb3b6f28fc17f74af2b4128d621868bbd9099df31faefff778c22ee1436342fa538f252d491d3cc237e9eeb1584e0666d9f8381cd12465cd0c202e571201f283e5aa6de82300832c23e702c92447fdba1e3adde871c84f58449e1ef45f911ec6f9429b10fcb52110a26f8483a0cd7fdc026fd3cf2f1c1ce245ad6feb2333ff5372c567e336708c03008d50c58dedc15eca2dbd75b623a10fba49753dd7f8a9fb4b279ef0613d01e9e225edf1834903650947283a1e33eede2cdf68bbd7987086c90a9986907c26b62ca1ad72c8199985c1365a7fc175225278b1794004177c24ed07b1b1ee58f673e6fac7179566ded0596688dce15b172148966479a9e008c37ddc3a224c699ff110e631e3e985cde03426adbe894aaecf72c5ee92f8b47b84e20e29e710d0fb9bf1653409dd4d925561383e90ab4997b5416ef149c965b969682589361d4d30ebf228ecec2050685a83ad8c509fe466da0f434b281a8c56b64070ef6a653d95c91cc874305e92fcfb9ffcf5dfd2153676ac14c32d245b2f426ecbe3d24e62058ff3c72c28461452781974db0f0d37b25befe8d5efa47513d8a2f741fe3b647f2208536822f5a252641b19a742e93923e3d5e6cd3e9d6a29532fa90ac9864684243ef5979842985ec5655bdfa5689591cdfcccad327d2df7883900fa80a7748006ca894c00b3b407689547b641f002397c96f2e9db4992403f72d3c39ec0df943ff8bfb57b771b91a537fe406314cdee3f4e43abe58e1c472948ee3b247438b22525e68425beecff7aae9a3f87683609856e3f74f1bfe9aa38af865758ffc56f60d30b6e86d99dcd08faa11d01eccd83d0eea9439681b351efc0277c8fccb4b33cfd4cab81d7d4da307b892a1abfb99ded0768461412ccb31341ac8e9073aa433163cd463d03d6610443bbd05d2818472b9fada76a0409ae8f905042ee411c95f550422a54752f593903fc04262cbf9851963c5d0e506cbc5266a71711ae9c202d92327608fe1a4de73225495cb2e66638db001db55bc03672400e74a6875f4ae19c6c9dba21d5606d086066dcf8043c8f1174d7bfa3acba20c7cd6771a1c5985a19911ee43775f90ea6cacd741e911eb88ea047322770ec0465839dfe84cf8b437936b51c756c88edd681c33bf95c93fdb27039af33ba1e54146b9dcba2bf9525da8744dfcfc4e9931d223fd16478649b5d6aa0acbd32865c45835d39d7f60fb53ed6fd928f9243b34d02f33730bd28b1bd068244f0d4d2fd288f9367bfcb09eed750352555ddd9ab7fb25b09cfc0f73eddca7457d5b937184d6eb5720f5904125b3812cfbe479eb11c8eb3e0ba7f3ca02601df661f055d3bd81ddbb985454be19672f624772a12baadc67b7ac4228bba6e962b069e15b536a8fa5984b2295d8c62d8b59fd230ef55d91fa7c10ad1f82113a81e1201bae36fed2ec37b32896a140dadc3bcc54c5c627ba5e9d0f4a55d5814896576519347e698cdbb41e80b011976116eb22e1062948d12fd1683f24f9e3d2bb60ddb0b28b6af91fea3087493887f9ff95f61dcded0e3487164a14574e6495d9b412c4a13068d1dac2f1da815ce98a9982ef3987c033c8a6eae591d01668bc822f34e26280126414e23fe1203dfeacb93a86fa39bf43da16149ed71008f3653b0d5b6a7c4d9ef596393ea5063ffb58ec561a77570ab94f60b07cd9c93de0cdcad30a12af723c6dcb3379d36ceb95f98cb850a80e383886e72a65ca1f89770599c6e9084d4c07c42069480ecd1252419cea1e8a2dc34eabfccfc8de4d08b940079997cbbf6ec414dba6eb74fe0b21c81b1e7e088fa287f6676c94c090e419d6362a3cbeaf8d5056e2d5ffe81e65332c9f8a5f78e0df21f76278489a840117456a605429a6d3d2755d845bfcad9badddb80578135f3d69e0d29b5e9b6682a4b4ef7a27ba0f94a376de9ecb967294e4047a0ce867a84330521573e82146a9ad0eb8a9b4a00332b4af573bb735de859f30406c52dce110b28f7a8c58ee55e9d30913cbdb91c63ed2f79115e488bb1630204c50f081f2ee86037bf281d9b9991449a29d4faaa9b5ca78378fe9db618878729f5e55fd250a995812c70d025148fdb2d9f53488ab5006a9b2347e1e428e127eeb792363ab2ad803ae150c4de5a73ae52261960f0f29e45b4c6e24993c0da37a78128e5ae9cc98e30e71feeb266d4c47ac779effb0205163e5e261863be493c11be78874e575d80f8ede41dc85f6a3c9b78d0d9d339535c8192f62e32d1dace7c2c308da0a81510b1fb499fbb694557cc1ff939edf037a48b2916c38ec2405b952b0cbb3bb48ffa21ceab1ead7df4460661345f44dfa0acca0e22f499fa40551b628f1104474f85232d250cf68407a60bc6118228c8fa6a2077df7b6f55a00abbfc184f7259b6db844d66565503862274490baae4ec8c4aef07c47b220c3e1d98985594e768de02fd3751f501bc45971ee568ff4005b4b503ae9cc14d2572e482b0240b5563dd3af3efd7c679346161ed92f30b82a3c9a0bd4ca99060e851248d5247cd06b4e810286f379b7056e65d3520b3c174ec9b55439f852e3244aa17c0e7599f937103021e3582c15445d09a577e7b18959e5745c67234a6736b61c27100ff0b98b912f5b5dc6dd5c74329bb95dec03290371fb272bd5a4978d32927a40bb4fe5bef6b2a450de9ba02e14cfbd5cf15763f31cd8e71edc2b69ac98675b8aa69c2495df7ff880195d9dcc6ed81947d8caa7c2573af2dc291b3c7cc59dc58464b1d431d3e7d5bf9cac19dfcfb0496c05cb4d5f80f5d686c909085bc4ff3ed17334f5b77c4b8f9e3b61aa3a276dc33abae6ce2d1232366307039bb32c95e94562797b38dfa7599f20a6943e4064e24068ecb730880bf8d449a6d03cafd64aa7a2c33dfd386aeadc75d4700facfeedb8873fbd6652be28d99672c2e44774a3843854eeff201e5e38d2eb264743385ffbccb49ea3110f41c4e437a7c84b20d086def34c302a559d158101146d312b8ab97af67f927c8b463b1eb3d217bdb80b9a073881e7d1cd9bcee9d7418b2bed1b124a9ffe1fe0aa77fdb90dce644c3a544072d17b7ad65363ee12806dd9b835b2bc21ec5a1f79eb4c1ecd4021b9af3c5ce9e14262b7e8fafef19d5e6be5309bb7abb0b1bc467af879bf66dcc2b5e88cb46e2fc9559a458b927e26212f6b9dfad702099fd8fc2e0e9ad0726954a04f45ee32328ddebaffe2a250f268937396ee55ef913d0ddbac1198b352987d1114dfc5120439a835f0e090e7a043262f390a2e383b792af3baeb864ef909e0e8a94492deab295e2aac695ba303e446f9c0cbae16469a7910709fb0c83e73da1c0bad8f4204a2eca9a44e8c73ffbfb4e100b412eb5c9adb71de9fb7eba56ff3ffb41055c55f4d9cae8cf32d115e5e92ef813cedad9c94d0b20063d39978ae6f3b9ca21f6ce6b7812c9fc2b1dbfc3dee20f7ade487a2de1d9f5b730898a63895026e4a7879382f910c17c1e36d1393afe2fbc305238c632b21e9a2f29dad1fd7f779d380dc6990d215c569d6bb74bbae850e4da3226fc31f8987e9eff5a8ae5bff31d18a64ecb5ede9d40a4532946e3fc2e8a06295b5f90cda9c964f1caef141ac725ec1ca6e56831ad8af02b099b3fb7272b93add802418535a8ae84d945656543dc5efef5c1613f1a8d9c24e87436e2d6fe0f528c6e7a983f120562be2b6f553bca2bd46c4acc417e3a8aca8a212103ce2cb832c6da60e332bddcf57127afe3915b2c2fc7934366dc67557f53b6d6f6cbeb89892594c1b2ea509fbfdc2b24301e43b53bccd26581e298927cd8269f217a278dd29e19a3c3e41a4e4fc36dc25cdc35ff220e91f65a84452ce0b7d98f40c77a6d76cc9c6c9e3635ad7a096e5c47521b1ec1b0d9483c57bf61c18308e802a752e1a968781f9da1540f0183ad519c276400144f6cf69b119ed540b6d276b5901c5f402d7c58414e9049a9fb2b849dac12b508bb6d488070c36d0f7864d5c7aa13b0830a789d484788af9747116df942958b9b8ab672a9e14cd4cbd6a7f60c06169a563a41e3659af0c30ecb70cb0f91218bbd50abbed6bc83efb2e049162190e205a3ea5fd95b666510d3ecdbc33baac118ec2b9191884b93bf810ee65b582981f835f182a4b725b134bffe945c4e4a974710f4b3f8e6bae560789f03aa6098a7f9c3af620b15de713be6efd763a6546cedad1452a4adc3a742cb4003342e9e59854d0cf9a1d3884083f29e0178e7901f999814a996a19cd51f99e55ddc7953d7644c9d6a9cead28d08ce021e1cdfb3daa23068e925309c09757201ea3bad505c4d93a567eacbfd2aac1f511a88b3129084dee6eafc249f48d344da48be1d0e11c1fc9065a36b273a1d7db5fc5c82aaaf44d234cb87040200e41e69b232ab908f1900962ac6ef44b69ef97e9562eeb9bc56ad19d4944cc0d808144baea6c5b86586dbd2e3dc7b254c261f82a3546a7ce63b4913bbee9db604467554ebd3c33ae3229fd26d7d32a6a146cd56abd8a995d6bcc7b71a9689500d5c823fd726e9033fe105fdfc5535ea626b44e8a7c1d675de8e68a1f4f13b860c28ba57f6e5871ea2181da8067d956780c2d7b2774616f1405bbb625ad79651e24983623ed1474c5e9ba45561601f0e33623644aebe2d3fb697dbe9cc368a5925819066c9772d040b8ff36836bfc772ae79104bed56410127966fac247ea7149bfd945437c45e2f37b726f6833a1c95af5344299acda073db2540bac73af34c9e19cf6d4c18f46e3c9204df4aa2e11974db0c9ea6343f692b241992a63b08531d352f1a82cba354d5690352492bd576ad7de41c8e362bea0a185a37bbb49e699276ba9a9efe3e2375e376fba5b5c149b394d8f06da5f63200e3e8ea52b7c0a3b2f07b489a67588eb3726bf81866bf43c9672351113039507f6b536ef4a7b7b235c099b5bb4633c622e184df6d97972df8dbcef7047bdc80b4c8a5dbe2c4bc52bf44f13606a4b02cde05ccf594bad4cd59a99a95f1a210706c29e54928f69a51bcc2e34a8884757c429209c7547260e904b0d792066a7596b85b155825caa960ba0f7af32bc27c3f4c19abf4fdf41f7ed92844926055e3d884813efc1c381535d8366efb95ccb6397e5328957367e9ef10506b5bc4caf9d953c82dc379f0289752475f27e41cf46981c1f22920c65c9ef25ff15a1dabc025c0f41695fa14544bd1ef8e63b5d9907e9b66b88f3de43ea8ba3ceff3cb2fab9d1657905858bf73c0a6242368b8cb413b5a951cc2f0ac494828a650f972972c00fa87d84b116fc094098738fb6eb4e8ab3a55cdcd7c65844a9cd20fc8fed88e3efefa3fb7223f76088eed4cef17ebac4bc883d2998952281d3705e2fb70a79bc8982bafc61e5482d42629ed36cc0f7e114a7056a64b59cd25e083aa20d6d180aa43655bc8b4727b1321950a291a6bee13c3a86c96c08da2587bd52ed5f06ec5ee41510e67a3c480dbf628ad90f290e5552c5ed1f1fde5c721e499192d63ea740c95157f18d7d4ed5e334f9e1bd0a2483ebb0c575bfe6828de8ac1789bed478c70a59279c8d06855e069bf0dfc8903c013d0f0c784362961bc5fa9e995b49c2abe5ec09e4afdd1d33f7809b02897b7057b8c1c39228795cb7d0d84674e0b0187c6d657470db9f2029cef6785948af2e0b94e0dba43a8e074e2bab7eefbb4d0a0ca7e35b7222d83df754f03d0d1bd4c3cdad41b7bd9deb6235230a76b08366c1751e5f5c87db1919ffa2610bbece69794612e913c3e3de5009514017255394c17728a86d2173f6855af8e37abf993e30629fcf764bba14d6e07accc5b8bb7c86458496bcf934e2550f8efde71caeb0f56b9824f5300374cd8583d106131d2abd153c5cf57106d78cbe5b908eadb0513cde8e8b5ea5ff5265224b590296f3f5d7bf01ff5d2f652ef22506652974af69fa7b7cb347cdfd4d4da424cf1c4fefb32bdad30c6b7cd5bef34631e12f37ae92b7fa0d080b5ab95f5746cfa684931ae1dc45cab9594d26c1b29ea7ade5c70e5c6b7595cfa37b473f6ebeba598c14919ea13e8cc280d5d79c1adce302e5c950c473f15\n  \n    \n      \n      \n        Hey, password is required here.\n      \n    \n  \n\n","categories":["Life"],"tags":["恋爱","实践"]},{"title":"Best Practice with FRP","url":"/2021/10/16/best-practice-with-frp.html","content":"\nFRP is a tool for reverse proxy. By using FRP, we can easily expose service in local network to public internet. Though the official documents provides some configurations for specific condition, it can still be confusing for new users. Thus I would like to record how I use it.\n\n\n\nInstallationFRP doesn’t provide any installation script, maybe because it’s quite easy to run under command. But FRP does provided systemd configs, thus we can manage FRP service though systemd.\nDownload latest tarball from FRP Binary and unpack it, then execute following command to install on Linux with systemd:\n# on frp clientmkdir /etc/frpcp frpc /usr/bincp frpc_full.ini /etc/cp systemd/frpc@.service /lib/systemd/system/# on frp servermkdir /etc/frpcp frps /usr/bincp frps_full.ini /etc/cp systemd/frps@.service /lib/systemd/system/\n\nConfigrationYou may notice that we use frpc@.service rather than frpc.service, this is a kind of systemd grammar. We can append extra string after @, and systemd will use the config file with the same name.\nSSHClient\nAdd config file /etc/frp/ssh.ini\nLocal sshd listens at 127.0.0.1:22 and we would like to access it through &lt;server ip&gt;:7022 . Multiple client can make use of the same server with different tag [ssh] and different remote_port.\n[common]server_addr = &lt;ip or domain&gt;server_port = 7000token = &lt;password&gt;[ssh]type = tcplocal_ip = 127.0.0.1local_port = 22remote_port = 7022\n\nEnable and start service\nsystemctl enable frpc@sshsystemctl start frpc@ssh\n\nServer\nAdd config file /etc/frp/ssh.ini\n[common]bind_addr = 0.0.0.0bind_port = 7000token = &lt;password&gt;\n\nEnable and start service\nsystemctl enable frps@sshsystemctl start frps@ssh\n\nHttp service with NginxUnder this condition, we have a http service in local network and would like to access it through Nginx.\nClient\nAdd config file /etc/frp/http.ini\nSuppose we have a local http server listening at http://127.0.0.1:80\n[common]server_addr = &lt;ip or domain&gt;server_port = 7000token = &lt;password&gt;[http_service]type = httplocal_port = 80custom_domains = &lt;bound doamin&gt;\n\nEnable and start service\nsystemctl enable frpc@httpsystemctl start frpc@http\n\nServer\nAdd config file /etc/frp/http.ini\nIn this config, FRP server will listen at 0.0.0.0:7000, and the exposed http service will listen at 127.0.0.1:7080. The limitation is that 1 server can only serve 1 client if you don’t use the locations, while FRP can not rewrite URL path as this work should belong to Nginx.\n[common]bind_addr = 0.0.0.0bind_port = 7000proxy_bind_addr = 127.0.0.1vhost_http_port = 7080token = &lt;password&gt;\n\nEnable and start service\nsystemctl enable frps@httpsystemctl start frps@http\n\nAdd Nginx location\nlocation / &#123;  proxy_redirect off;  proxy_pass http://127.0.0.1:7080/;  proxy_http_version 1.1;  proxy_set_header Upgrade $http_upgrade;  proxy_set_header Connection &quot;upgrade&quot;;  proxy_set_header Host $host;&#125;\n\nHttps service with NginxUnder this condition, we have a https service in local network and would like to access it through Nginx. You may ask: Why use https for internal service? Well, sometimes this can happen and we can not change, such as Proxmox VE, it only supports https for web service, and it’s hard to switch to http.\nClient\nAdd config file /etc/frp/https.ini\nSuppose we have a local https service https://127.0.0.1:443\n[common]server_addr = &lt;ip or domain&gt;server_port = 7000token = &#x27;password&#x27;[proxmox]type = httpslocal_port = 443custom_domains = &lt;bound domain&gt;\n\nEnable and start service\nsystemctl enable frpc@httpssystemctl start frpc@https\n\nServer\nAdd config file /etc/frp/https.ini\nIn this config, FRP server will listen at 0.0.0.0:7000, and the exposed https service will listen at 127.0.0.1:7443. The limitation is that 1 server can only serve 1 client if you don’t use the locations, while FRP can not rewrite URL path as this work should belong to Nginx.\n[common]bind_addr = 0.0.0.0bind_port = 7000proxy_bind_addr = 127.0.0.1vhost_https_port = 7443token = &lt;password&gt;\n\nEnable and start service\nsystemctl enable frps@httpssystemctl start frps@https\n\nAdd Nginx location\nlocation / &#123;  proxy_ssl_server_name on;  proxy_ssl_name $host;  proxy_ssl_verify off;  proxy_pass https://127.0.0.1:7443;  proxy_set_header X-Real-IP $remote_addr;  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  proxy_set_header Host $http_host;  proxy_set_header cookie $http_cookie;  proxy_set_header Proxy-Connection &quot;&quot;;  proxy_http_version 1.1;&#125;\n\n","categories":["How-To"],"tags":["frp","proxy"]},{"title":"Best Practice with ZFS","url":"/2021/10/18/best-practice-with-zfs.html","content":"\nThis article will introduce some practicality usage of ZFS file system.\n\n\n\nBasic UsagePool related\nCreate a pool\n# create a striped poolsudo zpool create new-pool /dev/sdb /dev/sdc# create a mirrored poolsudo zpool create new-pool mirror /dev/sdb /dev/sdc# create a pool with specific mount pointsudo zpool create -m /mnt/storage new-pool mirror /dev/sdb /dev/sdc\n\nSet the mount point\nsudo zfs set mountpoint=/mnt/storage new-pool\n\nCheck status\nsudo zpool status\n\nDestroy a pool\nsudo zpool destroy new-pool\n\nImport a pool\n# scan existing poolsudo zpool import# import specific poolsudo zpool import new-pool\n\nFilesystem related\nCreate a filesysytem in a pool\nsudo zfs create new-pool/new-fs\n\nDestroy a filesystem in a pool\nsudo zfs destroy new-pool/new-fs\n\nList all filesystems in a pool\nsudo zfs list\n\nSet mount point for a filesystem\nsudo zfs set mountpoint=/mnt/storage new-poolsudo zfs set mountpoint=/mnt/new new-pool/new-fs\n\nConditions\nHow to replace disk in a mirrored pool\n\nShutdown system, replace the disk, then boot up\n\nCheck the ID of disk with UNAVAIL status by executing\nsudo zpool status\n\nReplace with new disk /dev/sdb\nsudo zpool replace new-pool 4932927217405226991 /dev/sdb\n\nCheck status and wait for resilvering\nsudo zpool status\n\n\n\nReferencesSetup a ZFS storage pool\nHow to replace a failed disk in a ZFS mirror\n","categories":["How-To"]},{"title":"在QEMU中启动U-Boot和内核","url":"/2021/01/30/boot-kernel-in-uboot-from-qemu.html","content":"\n作为Linux内核工程师，QEMU是日常工作中经常接触的一个虚拟化工具，通过其CPU以及外设的模拟能力，我们很容易搭建出一套用于测试或开发的虚拟环境。以前在使用时通常都是直接去引导内核，但其实QEMU并不只是能够引导内核，任何拥有硬件初始化和管理能力的二进制程序它都可以引导运行。今天我们就使用qemu引导uboot，并在uboot中启动内核。\n\n\n\n为什么要使用U-Boot既然QEMU本身就具备引导Linux内核的功能，我们为什么还要先引导U-Boot呢？我想主要有一下几点好处：\n\nU-Boot能够提供更灵活的内核引导方式，它不仅可以从本地获取内核文件，还能通过网络获取\nU-Boot可以提供更完整的调试环境，如果直接使用QEMU，我们就很难看到bootloader做了哪些事情\n对于嵌入式系统的学习，U-Boot也是重要的一环，因此了解其工作原理有时也很重要\n对于跨平台模拟，如Arm，当涉及到DTB加载和引导压缩内核镜像的时候，QEMU有时并不能正确处理\n\n安装QEMUQEMU在主流的发行版中都可以直接从源上下载安装。\n\nArch: pacman -S qemu\nDebian&#x2F;Ubuntu: apt-get install qemu\nFedora: dnf install @virtualization\nGentoo: emerge --ask app-emulation/qemu\nRHEL&#x2F;CentOS: yum install qemu-kvm\nSUSE: zypper install qemu\n\n当然也可以从源码编译安装，参考QEMU网站的Build instructions。\nQEMU为每一种Arch生成一个对应的可执行程序，我们主要关注以下两个程序：\n\nqemu-system-arm: 模拟32位Arm CPU，如Arm9&#x2F;Arm11、Cortex-A7&#x2F;A9&#x2F;A15\n\nqemu-system-aarch64: 模拟64位Arm CPU，如Cortex-A53&#x2F;A57\n\n\n可以通过qemu-system-arm -machine help来查看支持哪些开发板的模拟。\n这里我们使用 vexpress-a9 这款开发板。vexpress-a9 是 Arm 公司自己设计的一款 4 核 Cortex-A9 开发板，U-Boot、Linux Kernel 和 QEMU 对这款开发板都做了完整的支持。\n安装交叉编译器请参照这篇文章安装所需的交叉编译工具链：\n《安装Arm交叉编译工具链》\n编译U-Boot下载源码git clone https://gitlab.denx.de/u-boot/u-boot.git\n\n编译make vexpress_ca9x4_defconfigmake CROSS_COMPILE=arm-linux-gnueabihf- all\n\n最终编译生成ELF格式的可执行文件 u-boot 和纯二进制文件u-boot.bin，其中 QEMU 可以启动的为ELF格式的可执行文件 u-boot。\n编译文件系统这里我们使用Buildroot来快速构建一个我们需要的文件系统。\n下载源码git clone git://git.buildroot.net/buildroot\n\n配置首先进入menuconfig：\nmake menuconfig\n\n\nTarget options\n\nTarget Architecture: ARM (little endian)\n大部分 Arm 都是小端模式，所以选上little endian。\n\nTarget Architecture Variant: cortex-A9\n这款开发板的 CPU 是 cortex-A9。\n\nEnable VFP extension support: enable\n\nTarget ABI: EABIhf\n我们将使用Linaro GCC进行编译，Linaro的GCC默认都打开了hardfloat的支持，所以选上VFP extension和EABIhf。\n\n\n\nBuild options\n\nLocation to save buildroot config: ca9_mini_defconfig\n该选项是设置最后生成的配置文件的保存路径，buildroot可以针对不同的板子生成特定的defconfig文件，默认保存在configs目录下。自己修改各项配置后，执行make savedefconfig命令，就会生成新的defconfig文件。下次编译之前，可以直接执行make ca9_mini_defconfig命令来加载已有的配置。\n\nDownload dir\n该选项设置 buildroot 下载的各种第三方包的存储路径，默认在 dl 目录下。\n\n\n\nToolchain\n\nToolchain type: External toolchain\n\nToolchain: Custom toolchain\n因为这里使用电脑上自己安装的toolchain，所以我们这里选External toolchain和Custom toolchain。\n\nToolchain path: /usr/local/toolchain/gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf\n然后在Toolchain path中填写toolchian在电脑上安装的位置。\n\nToolchain prefix: $(ARCH)-none-linux-gnueabihf\n另外要注意Toolchain prefix这个前缀别写错。\n\nExternal toolchain gcc version: 10.x\n设置toolchain的版本。\n\nExternal toolchain kernel headers series: 4.20.x\n设置用来编译这个toolchain的内核头文件的内核的版本。这个版本可以在toolchain里面的version.h这个文件查到，打开这个文件：\n$&#123;toolchain_location&#125;/arm-linux-gnueabihf/libc/usr/include/linux/version.h#define LINUX_VERSION_CODE 267277\n\n267277对应的16进制为0x4140D，如果版本号为M.m.p，那么\nM = ( LINUX_VERSION_CODE &gt;&gt; 16 ) &amp; 0xFF /* 0x04 = 4 */m = ( LINUX_VERSION_CODE &gt;&gt; 8  ) &amp; 0xFF /* 0x14 = 20 */p = ( LINUX_VERSION_CODE &gt;&gt; 0  ) &amp; 0xFF /* 0x0D = 13 */\n\n所以我们设置为4.20.x。\n\nExternal toolchain C library: glibc/eglibc\n\n\n\nSystem configuration\n\nRun a getty (login prompt) after boot\n\nTTY port: ttyAMA0\nvexpress_a9内核启动的控制台的名字叫做ttyAMA0。\n\n\n\n\n\nFilesystem images\n\ncpio the root filesystem: enable\n\nCompression method: lz4\n\n我们把编译的rootfs以initramfs的形式和Linux Kernel链接在一起，为了让根文件系统镜像尽量小，可以对文件系统采用lz4压缩。\n\n\n\n\n编译make\n\n编译内核下载源码git clone https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git\n\n配置把前面buildroot编译的rootfs.cpio.lz4拷贝到Linux Kernel根目录下：\ncp &#123;buildroot_dir&#125;/output/images/rootfs.cpio.lz4 ./\n\n然后加载vexpress_a9这块开发板的默认配置，并进入menuconfig做进一步配置：\nmake ARCH=arm vexpress_defconfigmake ARCH=arm menuconfig\n\n\nGeneral setup\n\nInitial RAM filesystem and RAM disk (initramfs&#x2F;initrd) support: enable\nInitramfs source file(s): rootfs.cpio.lz4\n\n\n\n\nKernel hacking\n\nprintk and dmesg options\n\nShow timing information on printks: enable\n这样打印的内核 log 前面会附带有时间戳信息。\n\n\n\n\n\n\n编译make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- -j8\n\n启动QEMUQEMU可以模拟sd卡等外设。我们就把编译好的固件放在一个模拟的sd卡上，让QEMU从这张模拟的sd卡上启动Linux系统。\n\n制作sd卡镜像，并将它格式化成fat格式\ndd if=/dev/zero of=sd.img bs=4096 count=4096mkfs.vfat sd.img\n\n把编译好的kernel zImage和DTB文件拷贝到sd.img中\nsudo mount sd.img /mnt/ -o loop,rwsudo cp arch/arm/boot/zImage /mnt/sudo cp arch/arm/boot/dts/vexpress-v2p-ca9.dtb /mnt/sudo umount /mnt\n\n在QEMU中启动U-Boot\nqemu-system-arm -M vexpress-a9 -m 512M -kernel $&#123;u-boot_dir&#125;/u-boot -nographic  -sd sd.img\n\n从sd卡中加载Linux Kernel和DTB\nfatload mmc 0:0 0x62008000 zImagefatload mmc 0:0 0x64008000 vexpress-v2p-ca9.dtb\n\n这里面的0x62008000和0x64008000分别对应zImage和dtb文件在内存中的加载地址。我们可以在arch/arm/Makefile里面搜索textofs:\n141 textofs-y       := 0x00008000\n\n这个textofs定义的就是Linux Kernel zImage执行地址对应的内存偏移地址，默认偏移为0x8000。\n在U-Boot命令行中输入bdinfo命令，可以查到这块开发板内存的起始地址：\n=&gt; bdinfoboot_params = 0x60002000DRAM bank   = 0x00000000-&gt; start    = 0x60000000-&gt; size     = 0x20000000\n\n可以看到这块开发板的内存其实地址为0x60000000，所以对应内核的起始地址为：0x62008000。DTB的加载地址没有特别的要求，一般注意和 Linux Kernel Image 避开，不要重叠即可。\n\n通过bootz命令启动Linux Kernel\nbootz 0x62008000 - 0x64008000\n\n","categories":["Embedded"],"tags":["qemu","uboot","kernel"]},{"title":"为Debian编译内核的deb安装包","url":"/2019/01/04/build-kernel-deb-for-debian.html","content":"\n手里面有一台北美的VPS，网络状况不太稳定，早就听说了Google的全新TCP拥塞算法BBR，所以打算尝试一下。该拥塞算法实际已经合入主线内核，但是为了获得最好的效果，这里我将编译谷歌专为开发BBR而创建的内核——net-next。替换内核的同时需要替换内核模块，因此将内核编译为deb安装包将更加便于管理。\n\n\n\n依赖环境这里的所有操作在Debian9下进行。\nsudo apt update# following packages are used to build kernel, you may need moresudo apt install build-essential libncurses5-dev git flex bison wget bzip2# following packages are used to build kernel packagesudo apt install kernel-package fakeroot\n\n获取内核源码这里我以Google用来开发BBR的内核net-next为例。\ngit clone git://git.kernel.org/pub/scm/linux/kernel/git/davem/net-next.git linux-kernel\n\n配置与编译配置内核需要config文件，你可以使用内核中的x86默认配置，也可以将本机的配置文件复制到源码目录。\ncd linux-kernelmake clean &amp;&amp; make mrproper# if you want to use default configmake x86_64_defconfig# or use local machine configcp /boot/config-`uname -r` ./.config# configure anything you wantmake menuconfig\n\n这里并不直接使用make编译，而是使用make-kpkg，搭配fakeroot来编译内核安装包。\nmake-kpkg cleanfakeroot make-kpkg --initrd --append-to-version=-custom kernel_image kernel_headers\n\n最后，在上级目录中就可以找到编译好的linux-image和linux-headers。\n安装内核要安装新内核，需要首先卸载旧的内核，安装好之后，还要更新grub，否则机器将无法启动。\n# WARNING, following command will remove your kernel!dpkg -l | grep linux-image | awk &#x27;&#123;print $2&#125;&#x27; | xargs -I &#123;&#125; sudo apt purge &#123;&#125; -y# install new kernelsudo dpkg -i linux-image*# update grubsudo update-grub\n\n","categories":["How-To"],"tags":["debian","kernel","linux","package"]},{"title":"将树莓派打造为无线中继","url":"/2018/01/06/build-wireless-bridge-with-raspberry-pi.html","content":"\n让树莓派进行wifi中继，最简单的方式是安装OpenWrt或者LEDE，然后通过Luci界面可以方便的进行操作，前提是你的无线网卡能够在OpenWrt下顺利驱动。由于我需要中继5G信号，所以选购了一款支持双频的USB无线网卡，主控为RTL8812AU，Realtek实际上间接提供了Linux下网卡驱动的源码，在Github上可以搜索到很多，但是无奈这个驱动交叉编译完成后insmod到OpenWrt和LEDE并不能很好的驱动网卡，无奈之下只好使用Raspbian，通过相关配置来完成需求。\n\n\n\n准备工作\n已经安装完Raspbian的树莓派，且能够通过串口、SSH或者显示器登陆\n网线\n电脑\n\n这里我假设你已经在树莓派上安装好了系统，因为树莓派安装系统并不复杂，所以这里不过多赘述。\n配置网桥可能很多人会不解：添加网桥的作用是什么，通过树莓派的以太网口不是已经可以很好的通信了吗？不知道你有没有想过一个问题，为什么你把网线插到路由器上随便一个lan口，都可以ping通192.168.1.1（假设你的网关是这个），那几个lan口也有IP吗？路由器的lan口到底有什么特殊之处？学过计算机网络的童鞋应该知道，网桥是一个工作在二层的设备，目的是分离不同的碰撞域，设备之间直接通过mac地址通信。在Linux系统中，假设我们有4个以太网卡，一个网桥，并且将这4个以太网卡设置为网桥的4个接口，同时将网卡设置为混杂模式，那么我们就得到了一个虚拟的网桥设备，如果再为网桥设置一个IP，那么这个网桥就是传说中的lan了。实际上基于Linux系统的路由器正是这么做的，在OpenWrt的终端下使用ifconfig命令可以看到一个br-lan的接口，那就是虚拟网桥。\n明白了原理，接下来只要知道如何创建网桥并分配接口，配置IP就行了，首先需要安装网桥配置工具：\nsudo apt install bridge-utils\n\n然后输入如下命令，即可完成配置，更详细的使用方法可以参考man手册。\nbrctl addbr br-lanbrctl addif br-lan eth0ifconfig br-lan 192.168.1.1 upifconfig eth0 0.0.0.0 up\n\n配置IP转发一般的Linux发行版默认都不会开启ip_forward，因为正常的计算机都是作为终端，没有转发数据报的需求，因此需要手动打开。\n第一种方式echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n\n第二种方式vim /etc/sysctl.conf+ net.ipv4.ip_forward = 1\n\n第三种方式sysctl net.ipv4.ip_forward = 1\n\n配置iptables如果我们中继的是运营商的wifi，那么可能会获得一个公网的IP，这种情况下想让内网的所有设备共享这一个公网IP，需要在wlan0网口启用nat。\niptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE\n\n安装DHCP&#x2F;DNS服务器作为一台准路由器，插在上面的设备最好能够自动获取IP，这里我选用的是dnsmasq，因为科学上网比较方便。\napt install dnsmasqvim /etc/dnsmasq.conf+ dhcp-range=192.168.1.50,192.168.1.150,255.255.255.0,12h\n\ndnsmasq的功能很强大，这里我仅仅使用了基础的DNS&#x2F;DHCP功能，你也可以根据自己的需求定制。\n在树莓派上连接WiFi通过图形界面连接wifi难度不大，这里主要说一下通过命令行连接wpa&#x2F;wpa2加密的wifi。在Linux发行版中，一般都会集成一套wireless-tools，但是在树莓派中，同时还提供了wpa_supplicant，它基于C&#x2F;S模型，我们需要使用wpa_cli来和wpa_supplicant通信，完成相关设置。\nwpa_cli\n然后会出现下面这样的命令行界面\nwpa_cli v2.4Copyright (c) 2004-2015, Jouni Malinen &lt;j@w1.fi&gt; and contributorsThis software may be distributed under the terms of the BSD license.See README for more details.Selected interface &#x27;wlan0&#x27;Interactive mode&gt;\n\n既然是命令行，就可以敲命令，首先扫描一下wifi\nscan\n\n然后读取一下扫描的结果\nscan_result\n\n当看到你需要中继的wifi的SSID后，记下来，然后新建一个空网络\nadd_network\n\n此时会显示新建的网络的编号，如果没看清，可以查看一下当前所有配置过的热点信息\nlist_network\n\n下面我们需要配置网络了，假设新建的网络编号为0\nset_network 0 ssid &quot;OpenWrt&quot;set_network 0 psk &quot;1234567890&quot;\n\n最后选择一个网络进行连接\nselect_network 0\n\n如果正常的话，就可以连接成功，可以查看当前状态\nstatus\n\n后续此时，将无线路由器的wan口与树莓派的lan口连接，并设置为自动获取IP，就可以上网了。这样可以将中继的接收方与发送方通过网线连接，因此灵活性更高，前提是你能给树莓派找到一个不会被偷的地方(¬､¬)\n","categories":["Embedded"],"tags":["linux","raspberrypi","wireless","bridge"]},{"title":"在Debian下配置Samba服务器","url":"/2018/12/29/configure-samba-server-under-debian.html","content":"\n有时，我们需要在Windows下访问Linux下的文件，但又不想把文件权限搞乱，这时可以使用Samba将Linux下的文件共享给Windows。之所以不使用FTP，是因为它需要将文件下载后才能编辑；而基于SSH的SFTP则不被Windows原生支持，需要额外的客户端。\n\n\n\n安装Sambasudo apt updatesudo apt install samba\n\n配置SambaSamba的配置文件比较长，单纯的共享不需要进行复杂设置，只需要在配置文件/etc/samba/smb.conf最下方添加自定义的共享即可。\n[my-share]   comment = my share directory   path = &lt;patch to you share directory&gt;   browseable = yes   read only = no   guest ok = no   create mask = 0644   directory mask = 0775\n\n如果想要搭建一个匿名访问的共享目录，可以使用下面的配置\n[anon-share]   path = &lt;patch to you share directory&gt;   writeable = yes   browseable = yes   public = yes   create mask = 0644   directory mask = 0755   force user = &lt;username&gt;\n\n重启Samba服务# if you are using systemdsudo systemctl restart smbd.service# if you are using sysvinitsudo service smbd restart\n\n将用户添加到Samba如果你发现自己的用户密码无法用来登陆Samba服务器，那么需要将用户添加到Samba。\nsudo smbpasswd -a &lt;username&gt;\n\n在Windows下访问Samba服务器一般情况下打开“网络”，系统会自动搜索网络上的Samba服务器，如果你发现了自己的服务器，直接点击然后登陆即可。\n特殊情况下某些情况下，比如本机与Samba服务器有多条网络连接，且速度各异，或者“网络发现”没有及时找到可用的Samba服务器时，可以手动访问Samba服务器。\n# 打开Windows的资源管理器，在地址栏输入\\\\xxx.xxx.xxx.xxx\n\n其中“xxx.xxx.xxx.xxx”为Samba服务器的IP地址，此时就可以指定某一网络直接访问Samba服务器了。\n","categories":["How-To"],"tags":["linux","samba"]},{"title":"使用Ftrace调试Linux内核","url":"/2019/12/07/debug-kernel-with-ftrace.html","content":"\n在进行内核调试时， 最长使用的方式就是printk()，由于printk()被设计成可以在任何上下文（进程上下文、中断上下文）执行，因此它会在执行过程中带来较大的开销，尤其是所调试的代码对时间很敏感时，比如时间中断。而ftrace则能够在输出log的同时，最大程度上降低调试带来的开销。\n\n\n\n配置FtraceFtrace的API接口位于DebugFS中，可以直接通过修改对应的文件来控制Ftrace，它们都位于\n/sys/kernel/debug/tracing\n\n如果没有该目录，首先检查DebugFS是否挂载，如果没有可以手动挂载\nmount -v | grep debugfsmount -t debugfs debugfs /sys/kernel/debug\n\n然后检查相关的内核选项是否开启\nCONFIG_FUNCTION_TRACERCONFIG_FUNCTION_GRAPH_TRACERCONFIG_STACK_TRACERCONFIG_DYNAMIC_FTRACE\n\n以下的操作都在该目录中进行。\n启动&#x2F;停止tracing开启Ftrace后虽然不会影响系统的功能，但是会对性能造成一定的影响，而且用于记录log的buffer空间有限，如果不及时停止，关键的数据就会被新数据覆盖。\n用户空间# start tracingecho 1 &gt; tracing_on# stop tracingecho 0 &gt; tracing_on\n\n内核空间/* start tracing */tracing_on();/* stop tracing*/tracing_off();\n\nTracersFtrace提供了多种tracer，每种tracer都会以特定的格式记录PID、TIMESTAMP、FUNCTION等数据，同一时刻只能选择一种tracer。\n查看当前内核所支持的tracer\ncat available_tracers\n\nhwlat blk mmiotrace function_graph wakeup_dl wakeup_rt wakeup function nop\n\n要启用对应的tracer，直接将其名称echo到current_tracer 中即可\necho function &gt; current_tracer\n\n通过trace文件可以直接读取抓取的log数据。\ncat trace\n\n下面介绍几种常用的tracer\nfunction tracerfunction tracer生成的log数据较为全面，但是对于函数的嵌套关系描述不是很直观。\n抓取的log格式如下\n# tracer: function## entries-in-buffer/entries-written: 410007/21079612   #P:8##                              _-----=&gt; irqs-off#                             / _----=&gt; need-resched#                            | / _---=&gt; hardirq/softirq#                            || / _--=&gt; preempt-depth#                            ||| /     delay#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION#              | |       |   ||||       |         |             awk-8215  [006] d... 17018.301564: __mod_zone_page_state &lt;-release_pages\n\n第一函数是当前执行的函数，第二个是其调用者。\nfunction_graph tracerfunction_graph tracer很适合分析内核代码的执行路径，以及性能优化。\n抓取的log格式如下\n# tracer: function_graph## CPU  DURATION                  FUNCTION CALLS# |     |   |                     |   |   |   | 6)   0.546 us    |                  get_mem_cgroup_from_mm(); 6)               |                  memcg_kmem_charge_memcg() &#123; 6)   0.325 us    |                    try_charge(); 6)   0.331 us    |                    page_counter_try_charge(); 6)   1.551 us    |                  &#125; 6)   3.050 us    |                &#125; /* memcg_kmem_charge */ 6)   7.527 us    |              &#125; /* __alloc_pages_nodemask */ 6) + 10.066 us   |            &#125; /* alloc_pages_current */ 6)   0.365 us    |            inc_zone_page_state(); 6) + 11.301 us   |          &#125; /* pte_alloc_one */ 6)               |          filemap_map_pages() &#123; 6)               |            alloc_set_pte() &#123;\n\n通过DURATION这一列可以看出每个函数的执行时间。\n如果超过10微秒，则在前面会有“**+**”\n如果超过100微秒，则在前面会有“**!**”\n添加自定义log有时，内核自带的trace point可能无法满足我们需求，这时，我们可以添加额外的trace log，并让其与原本的log结合起来。\n内核空间 —— trace_printk()文章一开始就提到，虽然printk()使用起来简单，但是其开销较大，有时甚至会影响到我们对内核进行调试。\n比如在调试scheduler或者network这种非常忙碌的子系统时，printk()会极大地拖慢系统性能，甚至造成死锁；而在调试一些竞态问题时，使用printk()甚至会让问题“消失”，或者难以复现。\n而Ftrace提供的trace_printk()则可以用于这些调试场景，跟printk()一样，它也可以用于任何上下文中；不同的是，它不会把log输出到console，而是输出到一个独立的buffer。使用trace_printk()输出的log会与其它tracer输出的log结合。\n在内核模块中测试trace_printk()，模块代码如下\n#include &lt;linux/kernel.h&gt;#include &lt;linux/module.h&gt;MODULE_LICENSE(&quot;GPL&quot;);MODULE_AUTHOR(&quot;colorfulshark@hotmail.com&quot;);static int hello_kernel_init(void)&#123;        tracing_on();        trace_printk(&quot;hello kernel\\n&quot;);        return 0;&#125;static void hello_kernel_exit(void)&#123;        trace_printk(&quot;goodbye kenrel\\n&quot;);        tracing_off();&#125;module_init(hello_kernel_init);module_exit(hello_kernel_exit);\n\n\n当使用nop&#x2F;function作为tracer时，输出的log如下\n# tracer: nop## entries-in-buffer/entries-written: 2/2   #P:8##                              _-----=&gt; irqs-off#                             / _----=&gt; need-resched#                            | / _---=&gt; hardirq/softirq#                            || / _--=&gt; preempt-depth#                            ||| /     delay#           TASK-PID   CPU#  ||||    TIMESTAMP  FUNCTION#              | |       |   ||||       |         |          insmod-1442  [002] .... 23080.367994: 0xffffffffc044a005: hello kernel           rmmod-4353  [003] .... 23271.094110: 0xffffffffc044a025: goodbye kenrel\n\n当使用function_graph作为tracer时，自定义的log会以类似注释的形式出现\n# tracer: function_graph## CPU  DURATION                  FUNCTION CALLS# |     |   |                     |   |   |   | 5)               |  /* hello kernel */ 6)   1.430 us    |  _raw_spin_unlock_irqrestore(); 5)               |  blocking_notifier_call_chain() &#123; 5)               |    down_read() &#123; 5)               |      _cond_resched() &#123; 5)   0.195 us    |        rcu_all_qs(); 5)   0.627 us    |      &#125; [...] 2)               |      0xffffffffc044a030() &#123; 5)   0.235 us    |                  rcu_cblist_dequeue(); 2)               |        /* goodbye kenrel */\n\n用户空间 —— trace_marker在调试用户空间程序时，我们可能会希望能够同步了解内核里的状态，虽然Ftrace输出的log有时间戳，但它跟墙钟并没有非常精确的对应关系，所以最好的解决方法是让用户空间的程序有能力把log输出到Ftrace的buffer中，从而与tracer输出的log结合。使用trace_marker这个文件即可实现这个功能。\necho &#x27;hello trace&#x27; &gt; trace_marker\n\n其效果与在内核空间使用的trace_printk()相同。\n使用Ftrace调试oops当内核崩溃时，我们通常只能获得崩溃发生时的上下文信息，但是对于崩溃之前发生的事却所知甚少，通过使用ftrace_dump_on_oops，即可在内核发生崩溃时，将Ftrace buffer中的内容打印到console上。这对于揭示崩溃发生的原因可能起到至关重要的作用。\necho 1 &gt; ftrace_dump_on_oops\n\n使用sysrq-z可以手动触发这个过程，也可以直接在内核代码中使用ftrace_dump()来触发。\n使用Ftrace跟踪栈的使用因为内核栈空间非常有限，分析内核函数对于栈空间的使用可以用于优化内核代码。\n要使用这个功能，首先要启动相应的内核选项\nCONFIG_STACK_TRACER\n\n虽然这个tracer是基于function tracer开发的，但是它使用独立的buffer\necho 1 &gt; /proc/sys/kernel/stack_tracer_enabled\n\n如果需要从系统启动就开始记录栈的使用，将stacktrace加到内核的启动参数中即可。\n\n查看到目前为止被使用过的最大的栈\ncat stack_max_size\n\n2728\n\n查看每个函数使用的栈大小\ncat stack_trace\n\n      Depth    Size   Location    (15 entries)      -----    ----   --------0)     2840      64   __msecs_to_jiffies+0x5/0x301)     2776      80   update_group_capacity+0x28/0x1f02)     2696     384   find_busiest_group+0xff/0x9c03)     2312     248   load_balance+0x164/0x9d04)     2064     112   pick_next_task_fair+0x443/0x5b05)     1952     104   __schedule+0x11e/0x8806)     1848      16   schedule+0x2c/0x807)     1832     144   schedule_hrtimeout_range_clock+0x181/0x190\n\n总结Ftrace非常强大，但是通过DebugFS使用起来也非常复杂，以后会介绍基于Ftrace API接口的工具，比如trace-cmd，kernelshark，它们可以大大简化Ftrace的使用。\n参考资料Debugging the kernel using Ftrace - part 1\nDebugging the kernel using Ftrace - part 2\nftrace - Function Tracer\n","categories":["Kernel"],"tags":["linux","debug","ftrace"]},{"title":"在Ubuntu（Debian）下配置全志A33开发环境","url":"/2018/05/03/environment-setup-for-a33-development.html","content":"\n之前参加某嵌入式培训机构，送了一个全志A33平台的平板，一开始看到全志平台，其实我是拒绝的 (￢_￢)，不过鉴于物尽其用（钱包空空）的原则，还是免为其难的玩耍一番。\n\n\n\n# 基本软件环境sudo apt install build-essentialsudo apt install git# 32位兼容库apt-get install lib32z1 lib32ncurses5apt-get install lib32stdc++6# 解决awk: line 2: function strtonum never definedsudo apt-get install gawk# uboot编译工具集sudo apt-get install u-boot-tools\n\n获取源码注意，这个代码目前只适合我这个平板，不过据说这个培训机构学生不少，所以这个平板的保有量也应该比较多～～～\ngit clone https://github.com/colorfulshark/fspad-a33.git\n配置与编译# 配置工程./build.sh config# 编译工程./build.sh# 打包工程./build pack_debug\n\n清理工程./build clean./build distclean\n\n烧录镜像参见在Ubuntu（Debian）下烧写全志A33系统镜像\n","categories":["Embedded"],"tags":["a33","linux"]},{"title":"Hack China Unicom Optical Modem","url":"/2022/02/06/hack-chinaunicom-optical-modem.html","content":"\nNormally, in Fiber-to-Home condition, optical modem will take charge of PPPoE dialing, then the router connected to it will regard it as a gateway. Such scheme will lead to 2 limitations: Double NAT and Public IP restriction. To solve them, we need to hack the modem and make it working in bridge mode.\n\n\n\nExtract DatabaseThough the web page of modem can be a good hack point, we will use a much more universal and geek way: connecting to modem though TTL.\n\n\nBecause modem is basically an embeded board running Linux, the vendor will always preserve the serial port to do some debug conveniently. Theoretically, end users will never have anything to do with serial port, so the protection is pretty weak. For example, the password for root user is just root…\nAfter logining into modem through TTL, what we need is the database located in\n/userconfig/cfg/db_user_cfg.xml\n\nAs this file is encrypted, we need to transfer it from modem to laptop and do some decryption.\nAnd the only transfer tool in modem is TFTP client, then a TFTP server will be required.\n\nMac: Transfer\n\nWIndows: Tftpd64\n\nLinux: tftpd-hpa\n\n\nOf course, before we start transfer, we need to connect laptop with the modem through an ethernet cable firstly. And set a static IP for laptop, such as 192.168.1.2, according to the subnet of the modem.\nFinally, we can start uploading the database to TFTP server by\ntftp -p -l /userconfig/cfg/db_user_cfg.xml 192.168.1.2\n\nDecrypt DatabaseTo decrypt the database, we will use a tool called offzip. It needs to be compiled mannually on MacOS or Linux.\ncd offzipmake\n\nThen decrypt with\n./offzip -a ./db_user_cfg.xml ./ 0\n\nThere will be many files being decompressed out, what we need are the files with xml extention.\nThen search admin in those xml files and find out the admin password.\nAdmin AccountFor me, to open the web page for admin login, I need to append /cu.html after the IP of modem, such as\nhttp://192.168.1.1/cu.html\n\nNow, do everything you want.\nReference记中兴 F477V2 新版固件改桥接 &#x2F; 末影随想\n[教程] 中兴光猫f477V2改固话桥接，支持电脑、手机SIP APP拨打\nLuigi Auriemma\n","categories":["How-To"]},{"title":"Cache工作流程","url":"/2020/01/04/hardware-cache-access-example.html","content":"Cache出现的目的是为了弥补CPU与内存之间速度不匹配的状况，如果要访问的内存地址的内容已经存在于Cache中，那么CPU就无需访问速度较慢的内存。本文通过一个内存访问的例子，简单介绍两种Cache模型，以及它们是如何工作的。\n\n\nCache LineCache的理论基础是程序的局部性原理，当访问了某个不在Cache中的内存地址后，通过将相关内存地址的数据迁移到Cache中，降低再次需要访问内存的概率。\n从内存向Cache迁移数据是以Line Size为基础单位，假如Line Size是32Byte，那么每次迁移都是32Byte。\n当给定一个内存地址时，我们怎样让其与Cache Line中的某个具体Byte对应呢？参照内存分页机制，不妨也将内存地址拆分为几组，这就引申出了Set，Tag和Offset三个概念。\n整个Cache空间被分为若干个Set，每个Set包含若干个Cache Line，每个Cache Line用Tag标识，当找到对应的Cache Line后，使用Offset来确定在Cache Line中的偏移。\n根据每个Set中Cache Line的数量，Cache可以分为直接映射、组相联和全相联三种。\nDirect Mapped在直接映射模式中，每个Set只有1个Cache Line，假设我们的Cache有128Byte，每个Cache Line有32Byte，内存地址是12bit（通常来说是32bit或者64bit，为简单起见使用12bit），那么\nOffset &#x3D; log(32) &#x3D; 5bit，即使用5bit作为在Cache Line中的索引\nSet &#x3D; log(128&#x2F;32&#x2F;1) &#x3D; log(4) &#x3D; 2bit，其中1表示每个Set有1个Cache Line\nTag &#x3D; 12 - 5 -2 &#x3D; 5bit，剩下的bit用于标识Cache Line\n即内存地址被分割为\n\n\n\nAddr\nTag\nSet\nOffset\n\n\n\n12bit\n5bit\n2bit\n5bit\n\n\n0x070\n00000\n11\n10000\n\n\n对应的Cache空间布局如下表所示\n\n\n\nSet\nValid\nTag (Line)\n\n\n\n00\n0\n0\n\n\n01\n0\n0\n\n\n10\n0\n0\n\n\n11\n0\n0\n\n\n当我们在访问内存时，首先把内存地址划分为Tag、Set和Offset，然后根据Set选择对应的组，如果Valid字段为1，并且Tag字段匹配，那么Cache命中，否则Cache未命中，需要把内存中1 Line的数据存储到对应的Cache Line。\n假如我们有一组待访问的内存地址，那么第一次访问以及第二次访问的命中情况如下表所示。\n\n\n\nAddr\nTag\nSet\nOffset\n1st\n2nd\n\n\n\n0x070\n00000\n11\n10000\nM\nH\n\n\n0x080\n00001\n00\n00000\nM\nM\n\n\n0x068\n00000\n11\n01000\nH\nH\n\n\n0x190\n00011\n00\n10000\nM\nM\n\n\n0x084\n00001\n00\n00100\nM\nM\n\n\n0x178\n00010\n11\n11000\nM\nM\n\n\n0x08c\n00001\n00\n01100\nH\nH\n\n\n0xf00\n11110\n00\n00000\nM\nM\n\n\n0x064\n00000\n11\n00100\nM\nM\n\n\n第一次访问Cache的命中率是：2&#x2F;9 &#x3D; 22%\n第二次访问Cache的命中率是：2&#x2F;9 &#x3D; 33%\n2-way Set Associative在2路组相联模式中，每个Set有2个Cache Line，假设我们的Cache有128Byte，每个Cache Line有32Byte，内存地址是12bit（通常来说是32bit或者64bit，为简单起见使用12bit），那么\nOffset &#x3D; log(32) &#x3D; 5bit，即使用5bit作为在Cache Line中的索引\nSet &#x3D; log(128&#x2F;32&#x2F;2) &#x3D; log(2) &#x3D; 1bit，其中2表示每个Set有2个Cache Line\nTag &#x3D; 12 - 5 -1 &#x3D; 6bit，剩下的bit用于标识Cache Line\n即内存地址被分割为\n\n\n\nAddr\nTag\nSet\nOffset\n\n\n\n12bit\n6bit\n1bit\n6bit\n\n\n0x070\n000001\n1\n10000\n\n\n对应的Cache空间布局如下表所示\n\n\n\n\n\n\nWay 1\n\nWay 0\n\n\n\nSet\nLRU\nValid\nTag (Line)\nValid\nTag (Line)\n\n\n0\n0\n0\n0\n0\n0\n\n\n1\n0\n0\n0\n0\n0\n\n\n注意，由于此时每个Set中有2个Cache Line，那么当Cache未命中时，应该替换哪一个Cache Line呢？这时候就有多种策略可以选择，比较常见的是LRU，即最近最少使用算法。比如我们刚更新过Line0，那么LRU就被设置为1，表示Line1将在下一次未命中发生时被替换。本意是将最不活跃的Line替换出去。\n那么，使用同样一组数据，Cache命中情况如下表\n\n\n\nAddr\nTag\nSet\nOffset\n1st\n2nd\n\n\n\n0x070\n000001\n1\n10000\nM\nH\n\n\n0x080\n000010\n0\n00000\nM\nH\n\n\n0x068\n000001\n1\n01000\nH\nH\n\n\n0x190\n000110\n0\n10000\nM\nM\n\n\n0x084\n000010\n0\n00100\nH\nH\n\n\n0x178\n000101\n1\n11000\nM\nH\n\n\n0x08c\n000010\n0\n01100\nH\nH\n\n\n0xf00\n111100\n0\n00000\nM\nM\n\n\n0x064\n000001\n1\n00100\nH\nH\n\n\n第一次访问Cache的命中率是：4&#x2F;9 &#x3D; 44%\n第二次访问Cache的命中率是：7&#x2F;9 &#x3D; 77%\n可以看出，在没有增大Cache空间的情况下，仅仅改变了Cache的模式，就大幅提高了命中率。\nFully Associative在全相联模式下，只有1个Set，假设我们的Cache有128Byte，每个Cache Line有32Byte，那么这个Set中将包含4个Cache Line。\nWay &#x3D; 128&#x2F;32 &#x3D; 4\n对于小空间的Cache来说，似乎不是什么问题，但是当Cache有几百KB甚至几MB，那么就会存在大量的Cache Line，这会造成两个问题\n\n由于是通过比较Tag来确定对应的Cache Line，而不是使用索引，比较这么多Tag很低效\nLRU算法需要找到最长时间未被使用的Cache Line，而这一般是硬件完成的，如果Cache Line很多，硬件设计会变得很复杂\n\n因此，几乎没有实际的硬件使用这种Cache模式。\n总结本文简单的介绍了一下Cache模型，以及其工作方式，虽然Cache对于程序员来说是透明，但了解其工作方式可以帮助我们更好的优化代码性能。如果想了解文中例子的具体执行流程，可以观看参考中的两个视频。\n参考Cache Access Example (Part 1)\nCache Access Example (Part 2)\n","categories":["Kernel"],"tags":["linux","cache"]},{"title":"DLP的工作原理","url":"/2021/01/24/how-does-dlp-work.html","content":"\n投影仪在日常生活中非常常见，无论是用来在会议中播放PPT，观看电影或是打游戏，都能获得不错的大屏体验，主流的投影仪使用DLP作为其核心显示部件，相较于LCD，它的工作方式有些特别，今天就来看看DLP是怎样工作的。\n\n\n\n首先来看看今天的主角，一台老（报）式（废）的Dell投影仪。\n\n\n所有投影仪的工作原理都是相同的：光线从光源发出，然后通过一个光线过滤部件，这个部件会根据当前显示的画面，让正确的光线通过透镜，最后在投影幕布上成像。\n胶片投影仪的工作方式非常简单：光源发出的光线通过胶片，然后通过透镜在幕布上成像。\n\n\n而LCD投影仪就是把胶片换成了LCD，通过液晶分子的偏转角度来控制通光量。\n\n\nLCD投影仪有个问题，为了显示彩色的画面，我们可能需要使用3块LCD来分别控制红、绿、蓝三种颜色的光线。这在一定程度上增加了设计难度，因为最后我们需要把这三条光路精确地拼接在一起。\n而DLP投影仪则只需要一条光路即可显示彩色的画面，从而降低了成本，并且在某些特性上也更有优势。\n那么DLP是怎么做到只需要一条光路的呢，让我们把它拆开来看看。\n\n\n\n\n\n\n在DLP芯片的表面，有无数个可以偏转的“小镜子”，每一个“小镜子”对应一个像素。为了便于大家理解，这里通过一个模型来演示。\n\n\n这个模型里面有36个可以独立偏转的小镜子，每个小镜子后面有一个小铁环，这样，当磁铁在它们后面移动时，镜子就会随之发生偏转\n\n\n\n\n下面打开光源，调整好透镜，然后在DLP模型后面移动磁铁，此时可以在墙上看到对应的“像素”发生了明暗变化。\n当小镜子朝向透镜时，其反射的光线可以正常通过透镜，此时对应的像素发光；而当它转向一边时，光线就不会通过透镜，此时对应的像素不发光。\n\n\n这时候你可能会想，现在只看到了一种颜色的光，那它要如何显示彩色画面呢？答案就在光源上。\n使用DLP成像的投影仪中有一个特殊部件，叫做色轮，它被放置在光源的前方。\n\n\n投影仪的处理器需要将一幅画面分成红绿蓝三个色彩通道。当绿色区域旋转到光源前方时，此时投射到DLP上的光线就是绿色，而DLP则显示绿色通道的画面，红色和蓝色通道也是相同的道理。当切换速度非常快时，我们的大脑就会自动将不同色彩通道的画面合并，从而拼凑出正常的颜色。\n\n\nLCD可以通过控制液晶分子的偏转角度来实现灰度控制。然而DLP上的小镜子却只有两个偏转角度，对应了像素的“开”和“关”，那么它是怎样控制像素的明暗呢？\n答案还是通过小镜子的快速翻转。这有点类似于现在OLED的PWM调光，当像素在“开”和“关”之间快速切换时，通过控制像素打开时间所占总时间的比例，也就是“占空比”，并利用人眼的暂留效应，来达到控制像素明暗的效果。实际上，DLP上的小镜子可以在5到10毫秒内完成一个翻转。\n下面我们来近距离看看DLP芯片的真实模样，这张图是光学显微镜下的画面。\n\n\n我们清楚地看到这些紧密排列的小镜子，每个小镜子大约10微米长。\n为了更加清楚地看到其结构，需要使用扫描电子显微镜。\n\n\n在电子显微镜下，DLP芯片的细节显露无疑。\n\n\n可以看到画面中有许多小镜子已经损坏了，这是由于在拆卸过程中撬棍接触到了DLP芯片表面，虽然力度非常小，但还是导致其结构被破坏。不过，这对我们来说是件好事，因为这样就能更清楚地看到小镜子下面的结构了。\n\n\n可以看到，小镜子实际上是以对角线为轴进行旋转的。与模型不同，DLP是通过电压来控制小镜子旋转，当施加电压时，小镜子会偏转到一侧，电压消失后，它会自动回位。\nLCD投影仪的另一个缺点是，光源发出的光线通过LCD面板后会损失近一半，因为LCD中需要电极来控制液晶分子，而电极本身并不是完全透明的。\nDLP则不存在这个问题，因为光线并不是穿过DLP，而是直接被反射的，从而光源的利用率大大提升。这样就可以使用功率更小的光源，以及更小的电源，从而降低整机的成本和体积。\nhttps://www.youtube.com/watch?v=9nb8mM3uEIc&amp;t=1s&amp;ab_channel=AppliedScience\n","categories":["Geek"],"tags":["DLP","原理"]},{"title":"在终端下调整ext4文件系统的大小","url":"/2019/12/29/how-to-resize-ext4-filesystem.html","content":"\n在带有GUI的Linux系统中，我们可以通过GParted方便地管理磁盘分区，但是在很多时候我们没有条件使用GUI工具，所以本文简单介绍一下如何在命令行界面调整ext4分区的大小。\n\n\n\n系统环境\n待分配分区：/dev/sdb1\n分区工具：fdisk\n文件系统检查工具：e2fsck\n文件系统调整工具：resize2fs\n\n扩大文件系统首先需要明确，决定文件系统上限的是其所在的分区大小，因此，如果待调整的文件系统已经占满了整个分区，那么在调整文件系统之前，需要先调整分区大小，本文假设待调整分区的后面仍然有可用的空间。\n重建分区原始状态下，分区dev/sdb1有512M，我们要把它调整为768M。\nNAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTsdb      8:16   0     1G  0 disk└─sdb1   8:17   0   512M  0 part /mnt\n\n\n解挂分区\nsudo umount /mnt\n\n删除旧分区\nsudo fdisk /dev/sdb\n\nWelcome to fdisk (util-linux 2.31.1).Changes will remain in memory only, until you decide to write them.Be careful before using the write command.Command (m for help): pDisk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x485cc8a2Device     Boot Start     End Sectors  Size Id Type/dev/sdb1        2048 1050623 1048576  512M 83 LinuxCommand (m for help): dSelected partition 1Partition 1 has been deleted.Command (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.\n\n创建新分区\nsudo fdisk /dev/sdb\n\nWelcome to fdisk (util-linux 2.31.1).Changes will remain in memory only, until you decide to write them.Be careful before using the write command.Command (m for help): nPartition type   p   primary (0 primary, 0 extended, 4 free)   e   extended (container for logical partitions)Select (default p): pPartition number (1-4, default 1):First sector (2048-2097151, default 2048):Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2048-2097151, default 2097151): +768MCreated a new partition 1 of type &#x27;Linux&#x27; and of size 768 MiB.Partition #1 contains a ext4 signature.Do you want to remove the signature? [Y]es/[N]o: nCommand (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.\n\n注意：新分区的起始扇区必须跟老分区的起始扇区一致。\n\n\n检查文件系统   sudo e2fsck -f /dev/sdb1\n\n   e2fsck 1.44.1 (24-Mar-2018)Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structurePass 3: Checking directory connectivityPass 4: Checking reference countsPass 5: Checking group summary information/dev/sdb1: 12/32768 files (0.0% non-contiguous), 6354/131072 blocks\n\n调整文件系统sudo resize2fs /dev/sdb1\n\nresize2fs 1.44.1 (24-Mar-2018)Resizing the filesystem on /dev/sdb1 to 196608 (4k) blocks.The filesystem on /dev/sdb1 is now 196608 (4k) blocks long.\n\n缩小文件系统缩小文件系统理论上不需要调整分区，但是这样会造成空间的浪费，其操作顺序与扩大文件系统相反。我们现在把刚才的768M的文件系统再调整为512M。\n检查文件系统sudo e2fsck -f /dev/sdb1\n\ne2fsck 1.44.1 (24-Mar-2018)Pass 1: Checking inodes, blocks, and sizesPass 2: Checking directory structurePass 3: Checking directory connectivityPass 4: Checking reference countsPass 5: Checking group summary information/dev/sdb1: 12/49152 files (0.0% non-contiguous), 7447/196608 blocks\n\n调整文件系统sudo resize2fs /dev/sdb1 512M\n\nresize2fs 1.44.1 (24-Mar-2018)Resizing the filesystem on /dev/sdb1 to 131072 (4k) blocks.The filesystem on /dev/sdb1 is now 131072 (4k) blocks long.\n\n重建分区\n删除旧分区\nsudo fdisk /dev/sdb\n\nCommand (m for help): pDisk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x485cc8a2Device     Boot Start     End Sectors  Size Id Type/dev/sdb1        2048 1574911 1572864  768M 83 LinuxCommand (m for help): dSelected partition 1Partition 1 has been deleted.Command (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.\n\n创建新分区\nsudo fdisk /dev/sdb\n\nCommand (m for help): pDisk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectorsUnits: sectors of 1 * 512 = 512 bytesSector size (logical/physical): 512 bytes / 512 bytesI/O size (minimum/optimal): 512 bytes / 512 bytesDisklabel type: dosDisk identifier: 0x485cc8a2Command (m for help): nPartition type   p   primary (0 primary, 0 extended, 4 free)   e   extended (container for logical partitions)Select (default p): pPartition number (1-4, default 1):First sector (2048-2097151, default 2048):Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2048-2097151, default 2097151): +512MCreated a new partition 1 of type &#x27;Linux&#x27; and of size 512 MiB.Partition #1 contains a ext4 signature.Do you want to remove the signature? [Y]es/[N]o: nCommand (m for help): wThe partition table has been altered.Calling ioctl() to re-read partition table.Syncing disks.\n\n总结本文所描述的场景仅仅适用于分区后面仍然有可分配的空间，如果后面紧跟着其它分区或者该分区是最后一个分区，会涉及到分区的移动，以后有机会会讲到。\n参考资料Resize Partition and Filesystem with fdisk &amp; resize2fs\n","categories":["How-To"],"tags":["linux","filesystem"]},{"title":"人性的弱点","url":"/2021/01/23/how-to-win-friends-and-influence-people.html","content":"\n如果你要从这本书里获得最大的益处，有一个必须具备的条件。不然，你再怎么研究，也不会有多少用处。如果有这种天赋的才智，你即使没有看这篇建议的文章，也能获得奇迹。\n\n\n\n获得奇迹这种奇妙的条件是什么？那是一种深入的、想要学习的欲望，一个增加你应付他人能力的强烈决心。\n你如何出发这样一个冲动呢？经常提醒你自己，让自己知道这些原则对自己是何等的重要。替你自己做这样的想象——如果将这些原则运用自如，将使你接触到多姿多彩的环境；在经济酬劳上，将有更多的帮助。你要一次又一次地对自己说：“我所以受人欢迎，我所获得的快乐，和我酬劳收入的增加，那是由于我知道了与人相处的技巧。”\n记住，只有恒久的，深切的温习，才能使这些原则的运用成为习惯。\n新奇的尝试当你的妻子、子女或是同事，找出你违反某一项原则时，你不妨付出10元或是20元给他们，作为对自己的处罚。\n记录实施这些原则的效果，把日期、效果和对方的姓名记录下来。\n每星期做一次检讨，质问你又犯了什么错误，有哪些地方需要改进，将来该怎么做。\n为人处世的基本技巧不要批评、责怪或抱怨发自内心地赞赏别人思考对方的优点。\n知悉对方的想法思考对方需要什么。\n学会关心和帮助他人能够获得更多朋友和快乐。\n平安快乐的14项法则选择正确的思想意志 —控制—&gt; 行动 —影响—&gt; 感觉\n坚守自我，拒绝模仿保持本色，做独一无二的自己。\n从悲伤中走出来将内心中的恐惧转化为奋斗的决心。\n学会放松，解除疲劳接受最坏的情况，思考如何改善它。\n克服忧虑的心理健全的信仰、睡眠、音乐和欢笑。\n活在真实的今天不要忧虑过去和未来，全力做好今天的每件事。\n勿存报复之心集中精力去做一些超出能力之外的事。\n施恩不图报唯一能得到爱的方法，就是不求回报地付出。\n时刻怀有感恩的心珍惜目前所拥有的一切。\n将酸柠檬变成甜柠檬汁从损失中获利。\n每天都要带给别人快乐真诚地对别人感兴趣，忘记自己的需求。\n没有人愿意踢一条死狗受到批评是因为自己足够优秀。\n不要被批评伤害坚持做自己认为对的事。\n学会自我批评记下别人的批评和自己所犯的错误。\n获取信服的12种方法争论中没有赢家永远避免正面的冲突。\n如何避免制造敌人永远别指责对方是错的。\n如果不对就及时认错愚蠢的人才会辩护自己的过错。\n使你走上理智的大路以友善的方法开始。\n苏格拉底的秘密使对方很快地回答：“是！是！”\n处理一个抱怨者的安全手法尽量让对方有多说话的机会。\n让别人愿意跟你合作使对方以为这是他的意念。\n一个创造奇迹的公式要真诚地以他人地观点去看事情。\n同情对方的意念和欲望人类普遍追求同情。\n吸引所有人的魅力激发人们更高尚的动机。\n实行、推进，别停顿下来使你的意念戏剧化。\n当你无计可施时，就试试这个吧提出一个挑战。\n说服别人的9种方法选好开始批评的方法称赞和真诚的欣赏。\n如何批评才不致引起反感间接地指出人们的过错。\n先说出你自己的错误谦逊和称赞。\n没有人喜欢接受命令建议，而不是命令。\n让对方保住他的面子体恤、谅解对方。\n如何鼓励人们成功称赞最细微的进步。\n给狗取个好名字给人一个美名让他去保全。\n使错误看起来容易改正鼓励对方把事情看成很容易。\n使人们乐意做你所建议的事不让人有不愉快的感觉。\n让你处处受欢迎的6项法则让你到处受欢迎的实用方法真诚地对别人产生兴趣。\n如何给人好印象微笑。\n这样做，你就能避免发生麻烦记住别人的名字。\n如何养成优雅而获得好感的谈吐善于倾听。\n如何使人对你感兴趣就别人的兴趣讨论。\n如何使人很快地喜欢你使别人感觉到他的重要。\n创造奇迹的信奇迹是可以创造的请你帮我解决一项困难运用“请你帮我一个忙”的心理学9种方法打造幸福快乐的家庭你是否在自掘婚姻的坟墓切莫喋喋不休。\n爱他就给他多一些自由别尝试改变你的伴侣。\n这样做你就快要离婚了不要批评。\n使人快乐的方法给予真诚的欣赏。\n对女人特别有意义的事随时注意琐碎细微的小地方。\n如果你要快乐，就请牢记这些要有礼貌。\n如何与女性相处如何与男性相处不要做一个“婚姻的文盲”如何把自己修炼成成熟有魅力的人成熟，从勇于担当开始为自己的行为负责。\n困难不等于不幸勇敢地面对、接受、克服、解决。\n摆脱生活中的不幸让时间去治疗伤痛。\n拥有自己的信仰并付诸行动。\n你就是唯一持续不断地自我发现，自我探寻。\n了解并喜欢自己期待自己完美是愚蠢至极。\n坚持自我本色展现自己的独特性，有自己的观点和主张。\n不要做令人讨厌的人避免言语乏味。\n先使自己让人喜欢专心一意去喜欢别人。\n8步走出孤独忧虑的人生解开忧虑之谜问自己4个问题。\n减少生意上50%的忧虑是什么？为什么？怎么办？\n消除思想上的忧虑让自己不停地忙着。\n不要为小事烦恼生命如此短暂。\n不要杞人忧天看看事情发生地平均概率。\n勇于接受不可避免地事实接受还是毁灭。\n给忧虑设置底线具备正确地价值观念。\n不要试着去锯木屑不要为已经发生地事情忧虑。\n抛却名利带来的烦恼一生最重要的决定选择正确的工作。\n抛却工作和金钱的烦恼提高自己的财商。\n夫妻间的职业冲突鼓励对方去做喜欢的事。\n合理开支，平衡收入制定合理的预算。\n高记忆力的3个自然技巧印象重复联想","categories":["Life"],"tags":["人性","情商"]},{"title":"安装Arm交叉编译工具链","url":"/2021/01/30/install-cross-toolchain-for-arm.html","content":"\n通常我们使用的Arm交叉编译器都是从各种开发板的SDK中得到的，那些toolchain的版本有可能比较旧或者无法满足我们的编译需求，所以今天来讲一下如何获取并安装一个预编译的Arm交叉工具链。\n\n\n\n工具链的种类GCC 的命名规则为：arch [-vendor] [-os] [-(gnu)eabi]-gcc\n比如 arm-linux-gnueabi-gcc ， arm-none-eabi-gcc， aarch64-linux-gnu-gcc\n\n带[]的是可选部分。\narch：芯片架构，比如32位的Arm架构对应的arch为arm，64 位的Arm架构对应的arch为aarch64。\nvendor：工具链提供商，大部分工具链名字里面都没有包含这部分。\nos：编译出来的可执行文件(目标文件)针对的操作系统，比如Linux。\n\narm-none-eabi-gcc一般适用用于Arm Cortex-M&#x2F;Cortex-R平台，它使用的是newlib库。\narm-linux-gnueabi-gcc和aarch64-linux-gnu-gcc适用于Arm Cortex-A系列芯片，前者针对32位芯片，后者针对64位芯片，它使用的是glibc库。可以用来编译u-boot、linux kernel以及应用程序。\n工具链的下载现在Arm平台上用的最广泛的工具链是Linaro发布的，大家可以到Linaro官网下载。\n如果要下载的工具链版本比较新，还可以从Arm官网下载。\n另外，还可以使用国内的清华源以加快下载速度。\nwget https://developer.arm.com/-/media/Files/downloads/gnu-a/10.2-2020.11/binrel/gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf.tar.xz\n\n工具链的安装首先需要解压到一个指定的目录，这里我们解压到/usr/local/toolchain\nsudo mkdir -p /usr/local/toolchaintar -xf gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf.tar.xz -C /usr/local/toolchain/\n\n然后我们需要添加环境变量，只有把可执行文件对应的路径加入到 PATH 环境变量里，系统才可以认到这些命令，可以添加到 ~/.bashrc 文件的最后。\nPATH=$PATH:/usr/local/toolchain/gcc-arm-10.2-2020.11-x86_64-arm-none-linux-gnueabihf/bin\n\n查看版本arm-none-linux-gnueabihf-gcc -v\n\n","categories":["Embedded"],"tags":["linux","arm","toolchain"]},{"title":"在Ubuntu上安装MySQL","url":"/2019/12/28/install-mysql-on-ubuntu.html","content":"\n随着MySQL的升级，其安装配置方式也变得越来越复杂，以至于新手第一次安装可能无法顺利地登录数据库，因此本文对如何在Ubuntu上安装配置MySQL进行简单阐述。\n\n\n\n系统环境\nUbuntu 18.04\nMySQL 5.7\n\n安装MySQL直接从Ubuntu的软件源安装即可：\nsudo apt updatesudo apt install mysql-server\n\n配置MySQL安全检查首次配置MySQL，我们最好进行一次安全检查，它会修改一些默认的不安全配置，比如禁止root用户远程登陆，以及删除一些用于测试的账户和数据库等。\nsudo mysql_secure_installation\n\n它将会做以下几件事：\n\n安装密码检查插件，它会对密码强度进行检测，并拒绝低强度的密码\n设置root密码\n删除匿名用户\n禁止root用户远程登陆\n删除测试数据库\n重新加载权限配置\n\n使用密码登录root用户在MySQL 5.7中，root用户默认使用auth_socket进行身份验证，而不是使用密码。这样虽然可以在一定程度上提高安全性，但也增加了复杂性，尤其是当我们想要通过一些工具管理数据库时。要想使用密码登录root用户，需要将认证方式换成mysql_native_password。\nsudo mysql\n\n首先查看一下每个账户在使用哪种认证方式\nmysql&gt; SELECT user,authentication_string,plugin,host FROM mysql.user;\n\n+------------------+-------------------------------------------+-----------------------+-----------+| user             | authentication_string                     | plugin                | host      |+------------------+-------------------------------------------+-----------------------+-----------+| root             |                                           | auth_socket           | localhost || mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || debian-sys-maint | *06B203089FC724D1B1C4B9197F88991FB2D287B3 | mysql_native_password | localhost |+------------------+-------------------------------------------+-----------------------+-----------+4 rows in set (0.00 sec)\n\n从查询结果可以看出，默认为root用户分配的认证方式就是auth_socket。\nmysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;password&#x27;;\n\n注意，这条命令会修改两个地方：\n\nroot用户的认证方式修改为mysql_native_password\nroot用户的密码被设置为password\n\n然后刷新MySQL的权限配置\nmysql&gt; FLUSH PRIVILEGES;\n\n最后确认一下root用户的认证方式是否被修改\nmysql&gt; SELECT user,authentication_string,plugin,host FROM mysql.user;\n\n+------------------+-------------------------------------------+-----------------------+-----------+| user             | authentication_string                     | plugin                | host      |+------------------+-------------------------------------------+-----------------------+-----------+| root             | *84AAC12F54AB666ECFC2A83C676908C8BBC381B1 | mysql_native_password | localhost || mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE | mysql_native_password | localhost || debian-sys-maint | *06B203089FC724D1B1C4B9197F88991FB2D287B3 | mysql_native_password | localhost |+------------------+-------------------------------------------+-----------------------+-----------+4 rows in set (0.00 sec)\n\n之后，我们就可以使用密码登录root用户了\nmysql -u root -p\n\n创建新用户创建用户并设置密码\nmysql&gt; CREATE USER &#x27;sammy&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;password&#x27;;\n\n该命令创建了用户sammy并将其密码设置为password。\n对新用户授权\nmysql&gt; GRANT ALL PRIVILEGES ON *.* TO &#x27;sammy&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION;\n\n该命令授权sammy拥有所有数据库的所有表的所有权限，但仅限本地登录，如果希望能够远程登陆该用户，将localhost改为具体的IP，或者%表示任意IP。\nmysql&gt; GRANT ALL PRIVILEGES ON *.* TO &#x27;sammy&#x27;@&#x27;%&#x27; WITH GRANT OPTION;\n\n测试MySQL数据库mysqladmin -p -u root version\n\nmysqladmin  Ver 8.42 Distrib 5.7.28, for Linux on x86_64Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Server version          5.7.28-0ubuntu0.18.04.4Protocol version        10Connection              Localhost via UNIX socketUNIX socket             /var/run/mysqld/mysqld.sockUptime:                 4 hours 20 min 8 secThreads: 3  Questions: 29  Slow queries: 0  Opens: 127  Flush tables: 1  Open tables: 120  Queries per second avg: 0.001\n\n参考资料How To Install MySQL on Ubuntu 18.04\n","categories":["How-To"],"tags":["ubuntu","linux","mysql"]},{"title":"在Windows上安装OpenJDK","url":"/2020/12/30/install-openjdk-for-windows.html","content":"\nLinux用多了，即使切换到Windows，也开始有意无意地使用开源软件，最近Manager想要在Windows下使用TraceCompass，需要安装Java环境，于是就研究了一下在Windows下安装OpenJDK的方法，其实跟安装JavaSE是一样的。\n\n\n\n下载OpenJDKOpenJDK官网\nOpenJDK下载\n这里我下载的是Windows平台的二进制zip包。\n解压OpenJDK将下载的压缩包解压到任意位置，如果为了方便管理，可以解压到C:\\Program Files\\Java\\jdk-15.0.1。\n设置环境变量不同Windows版本设置环境变量的位置都一样，但是找到它的方式却不太一样，对于Windows10，是通过设置 -&gt; 关于 -&gt; 高级系统设置 -&gt; 环境变量。\n需要设置的环境变量有5个：\n\nJAVA_HOME : C:\\Program Files\\Java\\jdk-15.0.1\nJDK_HOME : %JAVA_HOME%\nJRE_HOME : %JAVA_HOME%\\jre\nCLASSPATH : .;%JAVA_HOME%\\lib;%JAVA_HOME%\\jre\\lib\nPATH : %JAVA_HOME%\\bin\n\n注意设置PATH的时候要使用追加的方式。\n测试Java环境在PowerShell&#x2F;CMD中使用\njava -version","categories":["How-To"],"tags":["windows","openjdk"]},{"title":"在Proxmox VE中安装Openwrt作为软路由","url":"/2019/11/03/install-openwrt-in-proxmox-ve.html","content":"\n最近一直种草软路由，从j1900看到i5 7200u，无奈囊中羞涩，最便宜的也得500以上，于是打算把大学时用的旧笔记本利用起来，i7 4702mq的处理器即使放到今天也不算过时（感谢牙膏厂）。但如果只是安装一个Openwrt的话，有点太浪费硬件性能，于是打算在Proxmox VE中安装Opnewrt虚拟机。\n\n\n\n安装Proxmox VE\n进入PVE下载页面，下载最新的iso镜像\n\n\n使用ultraISO将ISO写入U盘，注意写入方式需要选择RAW，Linux用户可以直接使用dd命令\n\n\n将U盘插入电脑，并从U盘引导系统\n\n\n选择安装到哪个硬盘，注意硬盘数据会被全部清除\n\n\n设置PVE的后台管理IP地址，这是一个静态地址，最好选择一个不容易冲突的，比如我设置的192.168.1.100\n\n\n安装完成后，使用另一台设备接入相同的网络，打开https://192.168.1.100:8006，进入PVE的后台管理界面\n\n\n安装Openwrt首次打开时，将在左侧看到一个pve节点以及local和local-lvm这两个存储设备，其中\n\nlocal：存储虚拟机之外的数据，以文件形式存在于pve的文件系统之中，如iso镜像\nlocal-lvm：存储虚拟机磁盘文件，当为虚拟机分配磁盘后，相应的磁盘文件存储于此\n\n\n\n设置桥接在安装之前，我们首先要设置网卡桥接，因为虚拟机将会使用物理网口对应的网桥作为虚拟网口，从而实现网卡的虚拟化。\n\n选择pve节点，再选择System-&gt;Network，检查是否每个网卡都有对应的网桥\n\n\n如果有未设置桥接的网卡，需要手动创建桥接，选择Create-&gt;Linux Bridge，在Bridge ports中填入对应的物理网卡的名字，如enp3s0\n\n\n创建虚拟机由于Openwrt固件通常以image镜像的形式存在，因此并不能直接启动，我们首先要进入到一个LiveCD当中，然后把Openwrt的镜像写入到虚拟磁盘，LiveCD可以选择WinPE或者Linux，这里我选择Ubuntu Desktop。\n\n上传LiveCD，选择local-&gt;Content，点击Upload，选择镜像文件，并上传\n\n\n点击Create VM，在第二步选择LiveCD的镜像，其它步骤按提示进行\n\n\n创建完成后，在左侧的pve节点下即可看到对应的虚拟机，点击Start启动虚拟机，选择左侧的Console，即可进入LiveCD\n\n进入LiveCD后下载所需的Openwrt固件，使用dd命令写入虚拟磁盘即可，例如\ndd if=openwrt.img of=/dev/vda bs=4MB &amp;&amp; sync\n\n重启虚拟机，即可进入Openwrt\n\n\n配置Openwrt我们首先来看一下网络拓扑结构，方便下一步的设置\n\n\n为了方便使用软路由，要求至少有两张物理网卡，这里我使用一个USB网卡作为第二张网卡。\n\n在Console中修改/etc/config/network，将192.168.1.1修改为192.168.50.1，避免与光猫的IP冲突\n\n为Openwrt的虚拟机配置两个网卡，因为Openwrt默认会将第一张网卡作为lan口，第二张网卡作为wan口，所以根据图示，需要将第一张网卡连接到bridge1，第二张网卡连接到bridge0，这样Openwrt的wan口就可以从光猫获取IP，而所有连接到bridge1，即Openwrt的lan口的设备，都会从Openwrt获取IP\n\n\n将安装PVE的电脑的eth1，即Openwrt的lan口连接路由器的wan口，另一台电脑连接路由器，此时即可通过192.168.50.1这个IP地址进入Openwrt的后台\n\n\n后续操作PVE不仅可以运行Openwrt，比如我还安装了一个ubuntu server作为开发服务器，通过桥接bridge1从而与Openwrt的lan口连接，甚至还可以再安装一个windows作为下载机。\n开发的时候需要很多硬盘空间，可以将物理硬盘直接映射进虚拟机，通过下面这个命令实现\nqm set VM-ID --virtio0 /dev/disk/by-id/DISK-ID\n\n其中VM-ID是虚拟机的编号，比如100；**–virtio**是映射类型，0是一个编号；最后一个参数是待映射的磁盘的ID。\n","categories":["How-To"],"tags":["proxmoxve","openwrt"]},{"title":"解读基金——我的投资观与实践","url":"/2021/02/02/interpretation-of-fund-and-my-practice.html","content":"\n复利——被爱因斯坦称为“人类最有力的发现”，也被一些人称为“世界第八大奇迹”。复利，其实就是大家俗称的“利滚利”。一听到利滚利，我们想到的都是高利贷，我们都知道一旦陷入高利贷、利滚利的圈套，几乎永远不能翻身。是啊，当我们借贷的时候，利滚利会要我们的命。可我们如果把自己的钱利滚利，让利滚利为我所用，那得到的结果就是——你会成为一个百万富翁。\n\n\n\n投资的准备我们必须搞清楚的一点是：我们要投资而不是投机。\n基金就是把大家的钱收集到一起，由专门的人（基金经理）帮我们去投资证券市场。他提取他的佣金，我们拿我们的收益。\n开放式基金的运行模式是采用一种严格的制衡关系。也就是说，基金资产的管理于保管是分开的，基金公司管理我们的钱的投资运作，而钱一般是托管在银行的。\n佣金主要分为两部分：\n\n一次性收费\n认购 &#x2F; 申购费用：新发基金叫认购，成立后叫申购\n前端收费：购买时缴纳\n后端收费：赎回时缴纳\n\n\n赎回费用\n\n\n非一次性收费\n管理费\n托管费\n\n\n\n开放式基金的总份额是不固定的，每份的销售价格就是其净值。主要有以下4种类型：\n\n股票基金：股票市场\n债券基金：债券市场\n货币基金：短期货币市场\n配置型基金\n\n千万别立刻就开始投资。先学习，先做功课，态度决定一切。钱是我们自己的，投资是我们自己的事情，我们自己的事情还得我们自己做主。投资不是比智商，而是比谁更理性，而理性的前提就是理解，要理解就得花时间。\n","categories":["Wealth"],"tags":["基金","投资"]},{"title":"Interview Questions for Linux Engineer","url":"/2022/01/22/interview-questions-for-linux-engineer.html","content":"\n  436d19a0d0602a055c299e3594dce1803eec5752eb3b235495abef4d4c8e8c48ab4e20eab6c605243bf5321d3d5ccfce22d11d2e7728a23ad65c2a6d79f5a401ba87732d218e19fcaaad3c68aa26fe1ebbfd62d0e5a159abf7dce060a46769871ee9e5d29f437e80919de0a7e9e91ba342a5f80a0fe52f09a4b2ed1bf23e825e084084b708509968d2c0acb64201bde590a007c44ef1a23915961c31947c2764a4d4c26aeeadf58b81fbc9c4666eb4983e1497dcb2188d8da10925f986668a8dd8f92434d448a138cfe5a8cdbdc4b01d72e731bafcfcedb070cbee6db15a3e292bbd43298896f3026a9fa3a38b1bfa2dbd716642d81cefb27b343960a17cdaf91df735507d428b0f67b4d75218de73b39311061a52cba6421a857b72dc6b8985fff82fd8690378789bf6b7777b07c99c0c5fd641991d7622bcdcda83687786448798e647f3289374a730d99c1b337ef99ba92d72210751cf37162a30e138b2ff0f8bfa28f74b7a4c230f174c890daf47ef49622c1de4d10a327e06582d29c1965260b4b0205326442ee55a133aaee6bfda58b2d9e99b9e219e2c1efa37eda781e180f99a8eb1f07348559d0896c2ea4e11a5e55454a983df854acb9e76096dbf6afbc20bcd92d6b0a087918d9940ec121edb23ec25e07e2d76de4828c2f82893fc3b1858011fe4690c7b15f138ed75f05fbd77d1d98dc223cf24d04c2f234329adbc5a3a29cad49742a097ad3cb28cbe70682d6f71e3a7f8e80693dc09320d3621a9ab52c8344adb60f63d2f2a603e8b2bf2ea2d115a10df6310a7ecc2d2f9cdf62d4f609f702d195f05f7277863e3b264bc4f7280225ed2f06a6f3ff6cb8c09776e0daad3e22bba8a734f4c51bad708bd7ca79185d760c3e8282f6c6771167dcc53b1a718f189a850c9b9f838fae7d3a2acb81221856035b9d147715288e44cc175e85fe2458c04b674d062b444e47f9a83277a41aeabec2427836598e59610b73834eb44e35b77a5e78fc7e7e4f823132b28f7549d9d48fc0e01505b019764d69538d712c8ec7e4ab3d07610acaca491f7da177e642dcedcb5bfd0ea578cd96831e93ea6c000c6266337d09cfe38b8e1c6833f76ef888ded85c2e941305bfb37275fd744de5fbc70fc8bfca0b4a759525938e8197a8e773c4a588ca7d7df88fef0cfdad4d9bd8338b0847cdd380923f01b34245fa1a148cb714a921c535dcb8887e4d451e559611f0b28fe236950dd84d75a73bfe9fe53fd3264b0bdc5638c6c4307cc01d4cdadb9874537a513bace4ad72ade4bae3b45fd6f245846309c8699e1c5a04253250bed84e9d853ec1b8cb94149121f6bc858e097d46b75a292be34a6f1bc16b3abd094a223224281c3a4451ab91baa9b6e8c398b707682d0bc509ab0cab9713efd3c8cb16f9e2476e0558964e23457e9b1e432532d2c59dbb7099d51900b4d660bbb82d76484d0493b7d3f365d5888d7a3d47ee8deb5bcfdc424b23a63a32ec03c82e418c31d4d7a2630ab1169ad7753715dde533afab33f568a72529a51e9f9af2b7081d706eb1c852981337dfb8ad81c0a9e8aec4227c8f07b4c9e863ea820566ac2a41ad85932bc78978c16ebdccf75a888bec4e786876142aed17bf8228a14734cb9a7c2f3d29e686956415f8e6f86a18e7c5f9d487fdda51587a5bd37e9d29455469f38a46e744d43315b8bb002c242139a8feb754bd51138254f575d66c86c06ae7e265ac697a592f2c26985df3f90a3a7999491304d1d9d061f466e13c8bdb1bb4b42b3a7da94ef337f3b35a134ace70cce17a79d7ef9cc42a84ceacc2cfc439f60303d3e88fce6e70980a37c08eba11620136f010ff936c45b69b33bfb76f2e02ccecf7443e9fe17057e9bda4821b3cacfa69c2f1b75790afb65772aeb79414e5787b2e748c5bf5024f795d8405801461d6ab9a56602f4069bc87d9df11875d4a15dc44cd7249aca93217efdd1bd1591621a687cd2e61b5b76cb26e29a143b15d1ecb72fa337dcb42717e2fae95b168d15f66be2f4bc988059d6c2ad2c408357b26dbb708f1f9eb8899d0d71c6ca6d64aa24e6a23c8efbba04c1a663aa5eb191cb84495d583f714b9de6c9a546c4a3327f55aefe382961eb06c063c0049d578180b4710ff308af52ec14c6621dfa4fd64d4b5b9ea2131c279191272d4566236a0a86b7649a5ffbeb99d41422efa6c9cff11a2d15198d0cd34808636758f14f770ce257aa0612bcff262d04fde1304a791d2066ef5b40c18098633902b6d0462f878114b2f25df94a87e7def88211a09661a6a5792979ff671ff283e9d00fa98c69e1d207cfadaf76091e80fed8a15dccb01de99041a0ac97d649c738bd48352afae6385f3518d0b69f18a945efe1b51ce2280d342ad58b5af2cd3c5e8475ff0215095e273bdd2f3171ecc6ba48f1be47cf06a1307f3b1dcfd1e02d9d41ca54ff17784e167a435e348b545b5183917315c78f6ee57c1520a335840897db2e32cd60a6f1793b2b94fd384f47cd2f63013766193ed046b61fe6433f1d2308bd7b3eef27bf9a543bd8dbb1cdb0cadd72cc59c619360e633a86c68c811aabcfdb7b6a969218bc6667a06863784413c8edaf3eda9492609532d1a20fd8f2d5c5e353728bfc94d9de3de918ad7ad22823cb38bd9a608e242b2577cb1430d7b4628ef2d8de4973c15b04b2e9538b17ae4a814933e52dd6e4b4f6fa8281886dea77b4919e5016185fe5fd4150e81a4c99a30ce3e7ea5cbbabbe775ffc85074367b7795781e498eb5396b2e627618f3e4b2b54e722e6aa123cead77a456beda0e51ef69dcbb990071aaa0148e72b31b7c6c418d9282a1e8e57d3b49ed3577d09a6e6707b0dd719d7e79955961f64b1a9972c9efa0bc757415ecee79a2a8e55cba974bcce3348834b9425fb0413b03c66897a94fc6d475700a8eeea380d3f2dd4ce49e5451e00a6241113483961c767fdd56ae7b63a8dc602277dd9e32f083deb0e6cf6e7370aee640c73985de9f5b3609e62fd520d1c41f7790041dce843b73d4589d9e65ed9ac633c3c1a10f117c82d498c1faad00f062771ae26e5abfce63acaea69aed0ce63f3f1e53ee04893ab0c6fc9611c33a8dec63c3775d5e891dbaac876aeb0a4f3723683010500ac9220512b391f475c09a73fa3ee20629e1ebc56ce5cf188d2828a4b7710421c3cb5ac1b4964157ac0b4bb2be3091a42531f48b28a3b30a286c5b04f3f914b11fad0f042a7780bb6c1a609a2b40229739a6d334b1d55bfe9dd728c564766aa0bb16708a88d7675af8af7632d918b83b9bd26e4fd3a3efe717ca3fabc98fdd6c514c2f15995c2f3521038f6d7a73d3b7572bb96e48d270ed21a93f315e0bbdd29bd529417dd4cd26f35bbc198c257992aabd7b627c9dcf57f10f84a31f1adf08c7c28be3f684a44281c8db618637804818e79fb6463ec2dcb0f932a9926324f1a7c6cc44e90f57dc802e17fdecbb463477d97b146b60ef31008747769e9c53eb118fdf0fe005cf98e2efc64e10700534d3442fe944481d73a373ef369393ea96bc03ba78336151844066406c5be4806a790fd2eb3dab94a5b5fbbfb78fea5e16ae4ecf1dc1d96b5e43881ad97f1f97806f85103d0660429d8d779f6d7105984db27b96ad23fed57c390afcd02ca2d5c7094c4400f8ab34463f99af224bd07fbe163d1424479cba52f360700f04446cc36103046643e2fbc286ca3775b901db24c3ba5eac40f54464634cb5e40a3798ff42c24ebea15f08bbe8d877093dab8b2a0097896877c772fdeefc14b5c5c216d0303f960ef908de10bd38d20cb7d07c02c800696b421793214cbcc5e080fd0f9d1c9c9fed97a32f54f3b2f2e2a671fff2ee9d7a94239184c2a4283e3f76cf40ebad0852825e2b458adc42c533be59eabfeab4578ae599f9a0de1d908e3216c433bf3fe4ddaf833c9e52b726c85b393f6e35babdaed2da42d0d2efea5f8ba8c8d6e03d2c6f2eb2081d26b4d5d60e29faed2ee64540205bd94d75b39c15e77b05b8da3877caf3337a6719d09d88a2c1ebd182ad84e6ba9a6ec76207256570769802af3e993d651d394c3dd4723dbf1681765a47154d3257148724b4178c000c67db51f55383036a072903f6a88b646be4049e0caee6fd889fd56edcf5fb89728d49a04e0eea121ef8ad2007268ae0ae1e18b2cd179fe51a36ab7e4ceccb7683d0b83f77be9de793c9010c68a3c660040cb035ce6ad89ce7309792e5d0cc6f066686095a6472cd4f37f529b3620b6c879aa4329dd726f704ea106b699ac447eb28886709dc2347c5184dcf6b339914cba9050c18be084f060633fd48c45a34f91a44b0083dd9f3e07aaa944a0e3962b55b5207e00c0064521dae2fba93787ff95d18d9b2afc99a99333b17984ba8010ddc5e0fe8f8219b649a5f5c7275068cfce321b25ec327cff265ff05adaf5a8e5efa785f9f3117c716c54b6f210ac6d5908bca70ec97ab3f41bb4116c7a5978aab7b320ed073e47c9ef4ac4b286d33d68dfcc0cf2c38896434dffa39270612abee8a911a822285ffb801c529173e5d3b2f5f298a76d57f7ae00c75ea4763c66e53a8dce6b68f95fe1028e2ae0b104a3906f051a3df15815a6412adc8d38ccb731098affd2e84af126d711d384400aca109eecb1ff4947074078d23218057c56d54e9bf74cdcfd689c1342a0b9a80fc0811cb3b282014a7e28237c049e46a9f2828e8b7d87c5d2cc1835b488611fa2f0ec6e1bf1e5489ae08e52c46334f28e7247defaa2f1d75ac5c3a723399ed40450e938526fe467ea728d68f4fac3cc4da4e9c318c6ac6d3fb504d2aa3d0f420ad59e0ebe5eb76f416ad576c486381cc1692c033b445848c6afcd034dcd4efe173e5a1f4b37bc81990f35800a3faf7a77e25ae4f1d2519e9d800fac016e551681c88bcdfb2b947fbb849bb3c1da7186969e7db9539ce5ab0c4da85243adfb0e2481d3b401d2cf7915c14f6a1b149708fa3976c05ee3848035d7c1a46abcacbd5d055df1882758881223d91460ae991a6f29af3c1407163f95a41e47c25fb499a980ac41bb85a70fb9f09c5659ff695ed1ff90c198e44dc5c722c79f279f32dca60d3767cc57c969414c3442288d320886ebf1c36a1c573565a49594da6f4ff6eeff3ad529e76bcf5184d4c71dcc52833e79bc80456bc44cec8dcadd4f424c3c05e6bfd156f21d578ae80430af342bf2875d89ca603da41812737c0605518a144bad0eecaf5e14c8c1e15b7a8044366f60289fc66887a57bc95139bca54ec9b773e0ca779662e2ecbcace463be1fbb2b116d1e59bfdf71c2c1cac98d9edbc64d71f8946d7a5b3ff15bfe038da1e637ffb29c6fbd8f9492003f422f067938d759cb91851c5d42998a6fe2d836b7b4a92a8165bcc9f2ded43328834e2e19637a3badc20caed10b5d4bc8c7b6bd346e2e13fa5f2de9d6afcd1f76b113046fb236ced8184b26c7da2a5defe510c49a6004c7f80f2e93f66d0333f5331464e993f8fde3c7873a6854eb9a77f73f81da7c7aff2d38a39ba12a199e4ca807dfab82a535f8638afa62428e48de24dd73f223cb245644ccd73bd6744e338ad525ed898070d1c07337bb1504dc48a93ef4f3ca0c1e1cf8486e585d3c15816d09f35d6f5ff0740bcd04f76cb094b6fce2cf964b1a076c3b75b50b4f301fee44ec5cc9d912221081c3b1e269c2f43947945f30f5197c48d790c113ea284f1460521f5c947fccd88d32f1a00037bb84f392330aa52d8ae655f2912fb47a782f45045c60009c0b009d7027694b9557bcf1e34331fc69a43f69d6f07da853e37ccaaff3c1fcbcd7784161e619717dff2df0af7dd25e574219a595be4983bab1d3bd96385d2f885dfde79790ab2f219b5147f797a34e31f7e16df7e280ce08ee2af6935a73865fb771c63a286fd896da4418b4249da7b7d6947eb1a578196c7929929b9c230c43db960fe8f2418fd01ccf67b6abefb2c9b0fc8602b77eff54661b8c921d3c7adbd9360d25bbee88ff1726ecc3fbec6de1b88a152f7030ec61d9166156e18bb1a76b1fd55050c768d989039c9b73f26474e90e838e5982486d749f5bbb0ca8b5bf54ff6d564e629a22191f6b3aefe516e49ab7aa46745a02d3d0bcef02e0c5da603e17e3681776ef156e6af0881a1d616faa4dbe571fb7678ff87b51ef05f49811ad51c1e0b08f593ac843a43ff56b35f7859125f1fc731ef68d07b2123350e24404b6b1eb118c69b79e8ba7e768e019465e9fed4f274dc265fec194153f1747a351e4d9e48a81a8865a997ad117683d71666901a13cd07169e99f4f2e1e06937149ec6fd872da21bb292825290809d16c68de7e1521d339dc4306adc9509ac831ff4e3a3e224e9439d43ff64f1ab0861c39fa4f36980593cb43226bfd72ecef173ac152cf96c3eff8a474a9715e5c44fdc05455e943165412a9344238fa1e7e73d49449e5c1bf27a561f4792e6a6dad08e14a88c00ea9ea1bc890a72b98d5424a86332e943b718b607d0db400981e9aadcc473eeb2660f3870d26bdf63ee0fbd5c06b30ee15cfbbd62f46282f84df95a6531449997437a28196f0d11a1622e1837621c0932067ef79422daa3b49a27816227d6cc3b777e2542ff47280b288a23ed4925f4ee4b2f4b0191782cace9c90cdc9b3d42c7c994768d852f054cabee313bf809afac37734e12a5160ef981a18d8273133a2daab7d8dc3079184e01911999fe601f4bded2a8934c1ec93e36992dbccb54eb1fe4b1b795c4a4858aabd19c98b2bf87d3e07098fafa74dde6ede45cbd0c3a07584d0da1fbc8e3974aea9f4c50d912e7c250df10c70bef0f579c6fdf2ba19418f87edfa3c2b29d858e92828404d92d3a0ed57ae1c035b0ddd31de5b9ef0229ea4f4e584f781e9344370242de393b9fe0b1aa906750fde786f901b1a35d5765a3247c3f621eef8fb0af092f0f825b7928ad75086e9b19c12d1e75e0d23ef394c0aaf2f41e9543c32ea6ad6c86477eb3b89b0121b6636bf472f6bea7f48b520075cde545c099416a542df39092d3f71ec4ffbdceafc5172f3394d33809c2abaf7cd4b3c3d2eab1c14a8ce8d05c8491a197282f629a4c9d4015fd252ca9724f565e1081e9ba4910a8a24313069e7b1e9a973ecb4590dc6ff01cc4fb63de10c9173c7bcfc260fd5de7c61cdb66c4b29ec63748e4df102833b885eeb29518b12dd3d184a56bd7a72ec78b29a94c8a8f28f3ce60aa4f8dcacaf14375e742cf1bfde287b013d54eab1e55c484f633a865ac5b750804a1c2694ea629316bbb6004c376d26c5b4e5e39bd7b390105c42c4d7e6d9e14f4c8db475c0d9edd2f8f60d57c64a9fdd7cfee1b41e94f49c9b0ce05dfdb4f121116ca5c16415e4079277521a114719f8017e87cae49103fe3eb014e4b084f6ea7e6ee35db5dbc9b3e57d2a8e4d5f99feb0ceabde5c34ab37367ef269c77cd5d40594e528f4a968811681de3578945d0f679f3025e94cbc99cf296df0278fe5c1419205029deba28a9d4996ef0917f1b7f9b75b9c96c05269d0a6252d6cd5d575a0b05c0fd398992ee9e6c064f19f30cadf123f007e123a29aa3559ccc7a1de1685ac134b244c172b890de8bdd472e19cc4d7e205caf723d6a9c5c34a46e283914790b3eb5ef582d629f3ebcef08147d04955cca003e1ef87c2c21d37398174a0ef20ff2bcb6e3f2ae3570534d4caec82c3\n  \n    \n      \n      \n        Hey, password is required here.\n      \n    \n  \n\n","categories":["Interview"]},{"title":"The Bitcoin","url":"/2021/05/26/introduce-of-the-bitcoin.html","content":"\nPathways: Dynamic Leadership\nLevel 1-3: Researching and Presenting\n\n\n\n5月19日，加密货币市场出现了一波大震荡，相较于一个月前，比特币的跌幅高达53%，以至于交易所都出现了宕机，许多购买了杠杆的炒币者被平仓，损失惨重。这次震荡也使得比特币再次进入公众视野当中。\n谈起比特币，大家最先想到的是什么？\n诸如区块链、电子货币、一夜暴富等词汇似乎与比特币有千丝万缕的联系，所以，第一部分我想跟大家聊聊，比特币到底是什么。\n说起比特币，有两个计算机技术是绕不开的话题——哈希校验和非对称加密。\n我们先来看比较简单的——哈希校验。\n计算机中所存储的种种数据、如文档、音乐、视频等，都可以被看作是一长串数字，哈希校验算法通过对这一长串数字进行运算，得到一串新的数字，即使源数据发生微小的变化，经过计算得到的校验值也会与之前完全不同，因此这个数字就可以看作是一个特征值，用于标识一个特定的数据。\n但是这种计算是不可逆的，通过一个哈希值，我们没有办法恢复原本的数据。\nToastmaster: f27478c4d67652228fbbc189954d1068301622461bf817a5e4582614a13aae46\ntoastmaster: f98a53e31e80c45ddcb93bb5a9da73cf6db0c4425c41517a516c2795a113685b\n再来看第二个技术——非对称加密。\n这里包含两个概念，公钥和私钥，可以简单的把它们理解成两个钥匙，并且具有这样的特点：\n\n使用私钥加密的数据，只能使用公钥解密\n使用公钥加密的数据，只能使用私钥解密\n\n这里，比特币主要使用了第一种情况，即私钥加密、公钥解密，它还有一个很形象的名字——数字签名。\n签名的目的就是为了证明这个东西是我的，而不是别人伪造的。\n所以如果我想对一个视频进行数字签名，并发送给Lowensky，首先，我把我的公钥给Lowensky，然后计算文档的哈希值，接着用我的私钥加密这个哈希值，就得到了数字签名，最后将视频以及数字签名发送给Lowensky，Lowensky只需要用公钥解密数字签名，得到哈希值，再与他自己计算得到的哈希值进行比较，就能知道视频有没有被篡改。\n了解了这两个技术，我们终于可以聊聊比特币的本质——比特币系统就是一个账本。\n这里，我再举个例子：\n我跟Bob、Alice是好朋友，我们经常一块出去玩，那么就需要对费用进行AA，但是每次算账很麻烦，不算帐实力又不允许，于是我们就把账都记录在一个账本上：\n1. Ryan 付了 50元 给 Bob2. Alice 收了 Bob 100元3. Bob 付了 30元 给 Ryan\n\n然后到了月末，对账本进行汇总，如果谁有盈余，就将盈余取走，如果谁欠了钱，就需要补回来，每月一次，方便了很多。\n但如果有人偷偷加了一条不存在的交易记录怎么办？\n这时，就可以使用数字签名技术，我们把每一条交易记录附上一个数字签名：\n1. Ryan 付了 50元 给 Bob 0011101...2. Alice 收了 Bob 100元 1010111...3. Bob 付了 30元 给 Ryan 1011011...\n\n这样，别人就不能偷偷的在账本上增加或者修改不存在的交易记录，因为每个人只有自己的私钥，而没有别人的私钥， 因此，每一条记录只能由当事人添加。\n这样，大家就共同建立了一个互相信任的账本，但是还存在一个问题，如果有人欠了很多钱，跑路了怎么办？为了解决这个问题，可以在一开始，大家先在账本中充值，然后再使用账本，当某个人余额不足的时候，就决绝添加交易记录：\n1. Ryan 充值了 100元 0010101...2. Alice 充值了 100元 0111011...3. Bob充值了 100元 1101101...4. Ryan 付了 50元 给 Bob 0011101...5. Alice 收了 Bob 100元 1010111...6. Bob 付了 30元 给 Ryan 1011011... -&gt; 余额不足，拒绝交易\n\n这时，我们就会发现，如果所有人都使用这个账本，我们就可以完全与现金脱钩了，每个人的财富由其所有的交易记录的汇总来定义。\n因为这个账本人人都可以修改，人人都需要修改，那么放在哪里才能让大家都能访问呢？比特币为了区中心化，选择了一种独特的方式——工作量证明。\n还记得我们刚才说的哈希值吗，因为它本身是不可逆的，所以如果我问：\n（账本数据 + 未知数）&#x3D;&#x3D;哈希&#x3D;&#x3D;》 哈希值（256位的前60位都是0）\n这个未知数是多少？要得到这个未知数，唯一的方法就是一个一个试。这个尝试并得到答案的过程就是工作量证明。\n在比特币的网络中，存在许多计算节点，它们无时无刻不在监听，监听的对象就是一笔笔的交易记录。每个节点会把这些交易记录放在一个池子中，然后拿出一组交易记录，开始计算那个未知数，当计算出未知数后，这个（账本+未知数）就是一个区块，然后该节点会向其它节点广播这个区块，告诉大家，我算出答案了，这样，这组交易记录就被永远写在比特币网络当中，一个一个区块相互链接，就形成了区块链。\n每生成一个新的区块，都会产生一定数量的比特币，这些比特币就会奖励给这个计算节点，也就是所谓的比特币矿工，这些新产生的比特币，本质上也就是交易记录。\n随着区块数量的增多，每个区块所附加的比特币也会递减，最终减少到0，因此比特币的总量是有限的，大约是2100万枚。而比特币账户，也是完全匿名的，它只是一个字符串，用于唯一标识一个用户。\n单纯从技术上来看，比特币似乎很美好，去中心化，总量有限，不会超发，交易完全匿名。\n目前，中国对于比特币的态度是严厉禁止，主要可能基于以下两点：\n\n比特币基于互联网，它可以绕开外汇管制，对于洗钱等非法交易提供了极大的便利\n人民币的本质是中心化，比特币的去中心化与中国的发展战略背道而驰\n\n甚至最近有新闻指出，比特币矿工将会被列入失信名单，可见中国对于比特币的强硬态度。\n在可预见的未来，比特币都将长期存在，持有少量比特币也不会有太大风险，但是对于杠杆、合约、期货等炒币行为，希望大家能够谨慎对待。\n","categories":["Geek"],"tags":["toastmaster","speech"]},{"title":"什么是液态镜头（Liquid Lens）","url":"/2021/01/31/introduction-of-liquid-lens.html","content":"\n随着手机拍照的大规模普及，越来越多的人拿起手机记录生活，摄像头的各种参数也逐渐被大众所熟知。相较于大家比较关注的CMOS尺寸和像素，镜头这个话题的热度比较冷清。目前主流的镜头都是使用玻璃作为镜片，通过调节镜片之前的间距来实现对焦。但是，还有一种使用液体来实现对焦的镜头，今天就介绍一下这种有趣的液态镜头。\n\n\n\n首先来看一下液态镜头的实际效果：\n\n\n可以看到，镜头可以在一个相当大的范围内连续调节焦距，并且整个过程非常顺滑。\n液态镜头不使用传统的玻璃作为光学透镜，而是使用透明的油滴，没错，就是一滴油和一滴水。\n传统的镜头是使用一组镜片，通过调节镜片的间距来调节整个光学系统的焦点，因为每个镜片的曲率半径是没有办法变化的，所以单一的镜片就不能实现对焦。\n液态镜头则恰恰相反，它通过改变“镜片”的曲率半径来实现对焦，这非常类似于人眼的晶状体，如下图所示：\n\n\n与人眼通过睫状肌控制晶状体的形状不同，液态镜头利用了一种叫做电润湿（Electrowetting）的现象，简单的说就是通过改变电压来改变抗水表面的亲水性，由于原先抗水的表面现在变得更吸水，油膜不得不改变其形式。\n所以液态镜头就是在两块玻璃板之间，夹着一滴水和一滴油，在没有电场的时候，水滴和油滴都处于松弛状态，此时充当“镜片”的油滴是一个凹透镜。\n而当我们施加了一定的电压之后，右侧电极的金属表面变得更加亲水，于是就把更多的水吸引到镜头的边缘，也就是镜头中间的水会变少，此时油滴自然而然地就会变成一个边缘薄，中间厚地凸透镜，其曲率半径以及焦点地位置都会随之发生变化。\n目前世界上最大的制造液态镜头的公司是Varioptic，镜头的外形类似于一个小金属按钮，电极的触点则是在镜头的前后两侧，所以通过把它夹在两块覆盖铜箔的电路板之间就可以对它进行供电。\n\n\n要驱动这个镜头需要比较高的电压，并且需要专用的芯片来驱动：HV892，这款芯片来自于Supertex。我们需要通过IIC来控制它。所以使用Arduino作为驱动板。\n\n\n液态镜头相较于传统的机械对焦镜头的优势就是体积小，对焦速度快，对焦范围大。比如在生产线上识别条形码的时候，不同高度的货品通过时需要连续地快速精确对焦。\n\n\n","categories":["Geek"],"tags":["liquid","lens"]},{"title":"iTop-4412 learning —— beginning","url":"/2022/01/03/itop-4412-learning-beginning.html","content":"\nRecently I bought a new deveopment board: iTop-4412, which is based on samsung exynos 4412. Hoping this new board will increase my understanding of Linux and hardware.\n\n\n\nLearning Framework\nSingle chip microprocessor + C language\n\nLinux basic framework (Bootloader, Kernel, Filesystem)\n\nLinux userspace programming\n\nLinux character device programming\n\n\nDIP Switch\n0: near to number\n\n1: near to letter\n\n\n\n\n\nDIP switch\n1\n2\n\n\n\nEMMC\n0\n1\n\n\nTF\n1\n0\n\n\nBoard TypeSCP: 6 chips\nCOP: 2 chips\nFlash ImageFastbootIn Uboot:\nfdisk -c 0fatformat mmc 0:1ext3format mmc 0:2ext3format mmc 0:3ext3format mmc 0:4fastboot\n\nIn fastboot shell:\nfastboot flash bootloader u-boot-iTOP-4412.binfastboot flash kernel zImagefastboot flash ramdisk ramdisk-uboot.imgfastboot flash system system.imgfastboot -wfastboot reboot\n\nTF cardWill update if needed.\n","categories":["Embedded"]},{"title":"Leadership between Democracy and Authority","url":"/2021/06/24/leadership-between-democratic-and-authoritative.html","content":"\nPathways: Dynamic Leadership\nLevel 2-1: Understanding Your Leadership Style\n\n\n\nContentAs a newbie without going through too much in the society, it seems I never have taken time to think about what if I am a leader, because in my work life, the only thing I can control is my computer, and she will never resist my order. What kind of leadership style will I have, and can I get along well with my subordinate? It turns out that if I want to figure out my leadership character, I need a real case.\nAfter searching in my mind, I realized I did have an experience of leadership, but it’s not quite a delighted one. What happened? Please let me share the story.\nWhen I was in college, to encourage students to do some technology innovation, the school established a foundation to support new ideas and creations. At that time, I was quite interested in coding, thus I decided to recruit two of my classmates and as a group we will make an Android app to apply for the fund. And of course, I would be the leader of the team. That’s the first time I realized that there could be so much problems coming from my leadership styles.\nAt the design stage of the project, to act as a friendly and democratic leader, I just let everyone to share their thoughts, this is all right, but the crazy part is that I decided to achieve them all. Though I knew some ideas were difficult, I just didn’t want to reject any idea from anyone, I didn’t want to be the bad guy. That’s the moment when the nightmare started.\nAfter finished design, we needed to write the paper of project plan. At the meeting, I asked the team: do you want to write the document? No one responded. Then I continued, or I can do this if you don’t…  There is no doubt this job belonged to me. Actually I didn’t want it at all, what I wanted was just being nice and letting everyone can do anything. This idea sounded good but felt bad.\nBut just as the saying said: The only lesson mankind has learned from history is that it never learns anything. When we finished distributing the jobs and entered the coding stage, I said: please feel free and you can do this job at your spare time. Then we came to home on the summer holiday. To decrease the pressure I brought to my team, I didn’t ask about this among the whole holiday. After we went back to school, guess what, nothing had been done by them. I feel angry, but I need to be nice, so I behaved something like nice-angry. I said: It’s impossible to have zero free time to work at home, now that you didn’t finish yours, I will try to do these jobs by myself.\nThe project was complex and I have to work overtime. The coding had been not that attractive and made me exhausted. I felt tired, angry and regret, I just wanted to be a good leader but now all the things messed up.\nEventually, I nearly finished the whole project on my own, unfortunately all of us needed to report to the teacher about the role and duty in the project, then I had to make up some workload for them, how ironic it is!\nI don’t think this is a smooth and successful project, there existed a candy bomb: I tried to be democratic, but failed to provide enough communications and connections in the team. It became so inefficient because too much freedom made the team lost the direction.\nSuppose I have another chance to lead a team, I will limit the democratic in a reasonable range and be more authoritative in some critical stage to make sure everything can be finished on time.\nThat’s the leadership experience of mine and the style I have, now I believe the good ending of a project needs the balance between democracy and authority.\nEvaluationGood point\n\nStart the speech by asking some questions\nThe speech title is interesting\nthe description of the story is vivid\n\nBad point\n\nCould use more gestures , such as showing number\nCould use more body language to make the conversation in the speech vivider\nPut more emotion in the speech, do not act as reciting an article\n\nPhotos\n\n\n\n","categories":["Life"],"tags":["toastmaster","speech"]},{"title":"在Ubuntu安装OSX的主题","url":"/2019/05/19/make-ubuntu-look-like-osx.html","content":"\n随着Ubuntu再次回归Gnome的怀抱，其UI的可定制性再上了一个台阶，这次来看看基于Gnome3打造一个高仿OSX的界面。\n\n\n\n安装插件\n安装gnome-tweak-tool\nsudo apt install gnome-tweak-tool\n\n安装Arc menu插件\n在应用商店中搜索“Arc menu”并安装，如图所示\n\n\n安装user themes插件\n在应用商店中搜索“user themes”并安装，如图所示\n\n\n安装blyr插件\n在应用商店中搜索“blyr”并安装，如图所示\n\n\n安装主题\n安装OSX主题\nMcOS-themes，需要下载图中的两个文件，分别对应亮色调和暗色调，然后将它们解压到~/.themes。\ntar -xf McOS-MJV-Gn3.32-v2.1.tar.xz -C ~/.themestar -xf Mc-OS-MJV-Dark-Gn3.32-V.2.1.tar.xz -C ~/.themes\n\n\n\n安装OSX图标\nCupertino iCons Collection，需要下载图中的文件，然后解压到~/.icons。\ntar -xf Cupertino-Mojave.tar.xz\t-C ~/.icons\n\n\n\n安装OSX shell\nmacOS MOJAVE，需要下载图中的文件，解压后按照Gnome的版本，将相应的目录复制到~/.themes。\ngnome-shell --version # 确定gnome版本tar -xf OSX.for.Dash.to.DOCK.tar.xzcp -r 3.26\\ -\\ 3.28/Mojave ~/.themes/\n\n\n\n配置主题打开Tweaks，在Apperance -&gt; Themes下，分别选择安装好的项目。\n\n\n\n\n一些区别由于OSX原生的Dock会挤占屏幕上下的空间，这对于读写代码很不利，所以我并没有追求完全一样的效果，相对来说，竖排的Dock栏更加高效。\n","categories":["How-To"],"tags":["ubuntu","gnome3"]},{"title":"Markdown语法大全","url":"/2018/10/15/markdown-syntax.html","content":"&lt;&lt; 访问 Wow!Ubuntu\nNOTE: This is Simplelified  Chinese Edition Document of Markdown Syntax. If you are seeking for English Edition Document. Please refer to Markdown: Syntax.\n声明： 这份文档派生(fork)于繁体中文版，在此基础上进行了繁体转简体工作，并进行了适当的润色。此文档用 Markdown 语法编写，你可以到这里查看它的源文件。「繁体中文版的原始文件可以查看这里 。」–By @riku\n\n\n注： 本项目托管于 GitHub上，请通过”派生”和”合并请求”来帮忙改进本项目。\nMarkdown 语法说明 (简体中文版) &#x2F; (点击查看快速入门)\n概述\n宗旨\n兼容 HTML\n特殊字符自动转换\n\n\n区块元素\n段落和换行\n标题\n区块引用\n列表\n代码区块\n分隔线\n\n\n区段元素\n链接\n强调\n代码\n图片\n\n\n其它\n反斜杠\n自动链接\n\n\n感谢\n   Markdown 免费编辑器\n\n\n概述\n宗旨\nMarkdown 的目标是实现「易读易写」。\n\n可读性，无论如何，都是最重要的。一份使用 Markdown 格式撰写的文件应该可以直接以纯文本发布，并且看起来不会像是由许多标签或是格式指令所构成。Markdown 语法受到一些既有 text-to-HTML 格式的影响，包括 [Setext] 1、[atx] 2、[Textile] 3、[reStructuredText] 4、[Grutatext] 5 和 [EtText] 6，而最大灵感来源其实是纯文本电子邮件的格式。\n总之， Markdown 的语法全由一些符号所组成，这些符号经过精挑细选，其作用一目了然。比如：在文字两旁加上星号，看起来就像*强调*。Markdown 的列表看起来，嗯，就是列表。Markdown 的区块引用看起来就真的像是引用一段文字，就像你曾在电子邮件中见过的那样。\n兼容 HTML\nMarkdown 语法的目标是：成为一种适用于网络的*书写*语言。\n\nMarkdown 不是想要取代 HTML，甚至也没有要和它相近，它的语法种类很少，只对应 HTML 标记的一小部分。Markdown 的构想不是要使得 HTML 文档更容易书写。在我看来， HTML 已经很容易写了。Markdown 的理念是，能让文档更容易读、写和随意改。HTML 是一种发布的格式，Markdown 是一种书写的格式。就这样，Markdown 的格式语法只涵盖纯文本可以涵盖的范围。\n不在 Markdown 涵盖范围之内的标签，都可以直接在文档里面用 HTML 撰写。不需要额外标注这是 HTML 或是 Markdown；只要直接加标签就可以了。\n要制约的只有一些 HTML 区块元素――比如 &lt;div&gt;、&lt;table&gt;、&lt;pre&gt;、&lt;p&gt; 等标签，必须在前后加上空行与其它内容区隔开，还要求它们的开始标签与结尾标签不能用制表符或空格来缩进。Markdown 的生成器有足够智能，不会在 HTML 区块标签外加上不必要的 &lt;p&gt; 标签。\n例子如下，在 Markdown 文件里加上一段 HTML 表格：\n这是一个普通段落。\n\n&lt;table&gt;\n    &lt;tr&gt;\n        &lt;td&gt;Foo&lt;/td&gt;\n    &lt;/tr&gt;\n&lt;/table&gt;\n\n这是另一个普通段落。\n\n请注意，在 HTML 区块标签间的 Markdown 格式语法将不会被处理。比如，你在 HTML 区块内使用 Markdown 样式的*强调*会没有效果。\nHTML 的区段（行内）标签如 &lt;span&gt;、&lt;cite&gt;、&lt;del&gt; 可以在 Markdown 的段落、列表或是标题里随意使用。依照个人习惯，甚至可以不用 Markdown 格式，而直接采用 HTML 标签来格式化。举例说明：如果比较喜欢 HTML 的 &lt;a&gt; 或 &lt;img&gt; 标签，可以直接使用这些标签，而不用 Markdown 提供的链接或是图像标签语法。\n和处在 HTML 区块标签间不同，Markdown 语法在 HTML 区段标签间是有效的。\n特殊字符自动转换\n在 HTML 文件中，有两个字符需要特殊处理： `` ：\n\n&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,\n&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.\n&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.\n&gt; \n&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse\n&gt; id sem consectetuer libero luctus adipiscing.\n\nMarkdown 也允许你偷懒只在整个段落的第一行最前面加上 &gt; ：\n&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,\nconsectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.\nVestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.\n\n&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse\nid sem consectetuer libero luctus adipiscing.\n\n区块引用可以嵌套（例如：引用内的引用），只要根据层次加上不同数量的 &gt; ：\n&gt; This is the first level of quoting.\n&gt;\n&gt; &gt; This is nested blockquote.\n&gt;\n&gt; Back to the first level.\n\n引用的区块内也可以使用其他的 Markdown 语法，包括标题、列表、代码区块等：\n&gt; ## 这是一个标题。\n&gt; \n&gt; 1.   这是第一行列表项。\n&gt; 2.   这是第二行列表项。\n&gt; \n&gt; 给出一些例子代码：\n&gt; \n&gt;     return shell_exec(&quot;echo $input | $markdown_script&quot;);\n\n任何像样的文本编辑器都能轻松地建立 email 型的引用。例如在 BBEdit 中，你可以选取文字后然后从选单中选择增加引用阶层。\n列表\nMarkdown 支持有序列表和无序列表。\n\n无序列表使用星号、加号或是减号作为列表标记：\n*   Red\n*   Green\n*   Blue\n\n等同于：\n+   Red\n+   Green\n+   Blue\n\n也等同于：\n-   Red\n-   Green\n-   Blue\n\n有序列表则使用数字接着一个英文句点：\n1.  Bird\n2.  McHale\n3.  Parish\n\n很重要的一点是，你在列表标记上使用的数字并不会影响输出的 HTML 结果，上面的列表所产生的 HTML 标记为：\n&lt;ol&gt;\n&lt;li&gt;Bird&lt;/li&gt;\n&lt;li&gt;McHale&lt;/li&gt;\n&lt;li&gt;Parish&lt;/li&gt;\n&lt;/ol&gt;\n\n如果你的列表标记写成：\n1.  Bird\n1.  McHale\n1.  Parish\n\n或甚至是：\n3. Bird\n1. McHale\n8. Parish\n\n你都会得到完全相同的 HTML 输出。重点在于，你可以让 Markdown 文件的列表数字和输出的结果相同，或是你懒一点，你可以完全不用在意数字的正确性。\n如果你使用懒惰的写法，建议第一个项目最好还是从 1. 开始，因为 Markdown 未来可能会支持有序列表的 start 属性。\n列表项目标记通常是放在最左边，但是其实也可以缩进，最多 3 个空格，项目标记后面则一定要接着至少一个空格或制表符。\n要让列表看起来更漂亮，你可以把内容用固定的缩进整理好：\n*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.\n    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,\n    viverra nec, fringilla in, laoreet vitae, risus.\n*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.\n    Suspendisse id sem consectetuer libero luctus adipiscing.\n\n但是如果你懒，那也行：\n*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.\nAliquam hendrerit mi posuere lectus. Vestibulum enim wisi,\nviverra nec, fringilla in, laoreet vitae, risus.\n*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.\nSuspendisse id sem consectetuer libero luctus adipiscing.\n\n如果列表项目间用空行分开，在输出 HTML 时 Markdown 就会将项目内容用 &lt;p&gt;标签包起来，举例来说：\n*   Bird\n*   Magic\n\n会被转换为：\n&lt;ul&gt;\n&lt;li&gt;Bird&lt;/li&gt;\n&lt;li&gt;Magic&lt;/li&gt;\n&lt;/ul&gt;\n\n但是这个：\n*   Bird\n\n*   Magic\n\n会被转换为：\n&lt;ul&gt;\n&lt;li&gt;&lt;p&gt;Bird&lt;/p&gt;&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Magic&lt;/p&gt;&lt;/li&gt;\n&lt;/ul&gt;\n\n列表项目可以包含多个段落，每个项目下的段落都必须缩进 4 个空格或是 1 个制表符：\n1.  This is a list item with two paragraphs. Lorem ipsum dolor\n    sit amet, consectetuer adipiscing elit. Aliquam hendrerit\n    mi posuere lectus.\n\n    Vestibulum enim wisi, viverra nec, fringilla in, laoreet\n    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum\n    sit amet velit.\n\n2.  Suspendisse id sem consectetuer libero luctus adipiscing.\n\n如果你每行都有缩进，看起来会看好很多，当然，再次地，如果你很懒惰，Markdown 也允许：\n*   This is a list item with two paragraphs.\n\n    This is the second paragraph in the list item. You&#39;re\nonly required to indent the first line. Lorem ipsum dolor\nsit amet, consectetuer adipiscing elit.\n\n*   Another item in the same list.\n\n如果要在列表项目内放进引用，那 &gt; 就需要缩进：\n*   A list item with a blockquote:\n\n    &gt; This is a blockquote\n    &gt; inside a list item.\n\n如果要放代码区块的话，该区块就需要缩进两次，也就是 8 个空格或是 2 个制表符：\n*   一列表项包含一个列表区块：\n\n        &lt;代码写在这&gt;\n\n当然，项目列表很可能会不小心产生，像是下面这样的写法：\n1986. What a great season.\n\n换句话说，也就是在行首出现数字-句点-空白，要避免这样的状况，你可以在句点前面加上反斜杠。\n1986\\. What a great season.\n\n代码区块\n和程序相关的写作或是标签语言原始码通常会有已经排版好的代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 `` 和 `` 标签来把代码区块包起来。\n\n要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，例如，下面的输入：\n这是一个普通段落：\n\n    这是一个代码区块。\n\nMarkdown 会转换成：\n&lt;p&gt;这是一个普通段落：&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;这是一个代码区块。\n&lt;/code&gt;&lt;/pre&gt;\n\n这个每行一阶的缩进（4 个空格或是 1 个制表符），都会被移除，例如：\nHere is an example of AppleScript:\n\n    tell application &quot;Foo&quot;\n        beep\n    end tell\n\n会被转换为：\n&lt;p&gt;Here is an example of AppleScript:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;tell application &quot;Foo&quot;\n    beep\nend tell\n&lt;/code&gt;&lt;/pre&gt;\n\n一个代码区块会一直持续到没有缩进的那一行（或是文件结尾）。\n在代码区块里面， &amp; 、 &lt; 和 &gt; 会自动转成 HTML 实体，这样的方式让你非常容易使用 Markdown 插入范例用的 HTML 原始码，只需要复制贴上，再加上缩进就可以了，剩下的 Markdown 都会帮你处理，例如：\n    &lt;div class=&quot;footer&quot;&gt;\n        &amp;copy; 2004 Foo Corporation\n    &lt;/div&gt;\n\n会被转换为：\n&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&quot;footer&quot;&amp;gt;\n    &amp;amp;copy; 2004 Foo Corporation\n&amp;lt;/div&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n代码区块中，一般的 Markdown 语法不会被转换，像是星号便只是星号，这表示你可以很容易地以 Markdown 语法撰写 Markdown 语法相关的文件。\n分隔线\n你可以在一行中用三个以上的星号、减号、底线来建立一个分隔线，行内不能有其他东西。你也可以在星号或是减号中间插入空格。下面每种写法都可以建立分隔线：\n\n* * *\n\n***\n\n*****\n\n- - -\n\n---------------------------------------\n\n\n区段元素\n链接\nMarkdown 支持两种形式的链接语法： *行内式*和*参考式*两种形式。\n\n不管是哪一种，链接文字都是用 [方括号] 来标记。\n要建立一个行内式的链接，只要在方块括号后面紧接着圆括号并插入网址链接即可，如果你还想要加上链接的 title 文字，只要在网址后面，用双引号把 title 文字包起来即可，例如：\nThis is [an example](http://example.com/ &quot;Title&quot;) inline link.\n\n[This link](http://example.net/) has no title attribute.\n\n会产生：\n&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;\nan example&lt;/a&gt; inline link.&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has no\ntitle attribute.&lt;/p&gt;\n\n如果你是要链接到同样主机的资源，你可以使用相对路径：\nSee my [About](/about/) page for details.   \n\n参考式的链接是在链接文字的括号后面再接上另一个方括号，而在第二个方括号里面要填入用以辨识链接的标记：\nThis is [an example][id] reference-style link.\n\n你也可以选择性地在两个方括号中间加上一个空格：\nThis is [an example] [id] reference-style link.\n\n接着，在文件的任意处，你可以把这个标记的链接内容定义出来：\n[id]: http://example.com/  &quot;Optional Title Here&quot;\n\n链接内容定义的形式为：\n\n方括号（前面可以选择性地加上至多三个空格来缩进），里面输入链接文字\n接着一个冒号\n接着一个以上的空格或制表符\n接着链接的网址\n选择性地接着 title 内容，可以用单引号、双引号或是括弧包着\n\n下面这三种链接的定义都是相同：\n[foo]: http://example.com/  &quot;Optional Title Here&quot;\n[foo]: http://example.com/  &#39;Optional Title Here&#39;\n[foo]: http://example.com/  (Optional Title Here)\n\n请注意：有一个已知的问题是 Markdown.pl 1.0.1 会忽略单引号包起来的链接 title。\n链接网址也可以用尖括号包起来：\n[id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;\n\n你也可以把 title 属性放到下一行，也可以加一些缩进，若网址太长的话，这样会比较好看：\n[id]: http://example.com/longish/path/to/resource/here\n    &quot;Optional Title Here&quot;\n\n网址定义只有在产生链接的时候用到，并不会直接出现在文件之中。\n链接辨别标签可以有字母、数字、空白和标点符号，但是并不区分大小写，因此下面两个链接是一样的：\n[link text][a]\n[link text][A]\n\n隐式链接标记功能让你可以省略指定链接标记，这种情形下，链接标记会视为等同于链接文字，要用隐式链接标记只要在链接文字后面加上一个空的方括号，如果你要让 “Google” 链接到 google.com，你可以简化成：\n[Google][]\n\n然后定义链接内容：\n[Google]: http://google.com/\n\n由于链接文字可能包含空白，所以这种简化型的标记内也许包含多个单词：\nVisit [Daring Fireball][] for more information.\n\n然后接着定义链接：\n[Daring Fireball]: http://daringfireball.net/\n\n链接的定义可以放在文件中的任何一个地方，我比较偏好直接放在链接出现段落的后面，你也可以把它放在文件最后面，就像是注解一样。\n下面是一个参考式链接的范例：\nI get 10 times more traffic from [Google] [1] than from\n[Yahoo] [2] or [MSN] [3].\n\n  [1]: http://google.com/        &quot;Google&quot;\n  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;\n  [3]: http://search.msn.com/    &quot;MSN Search&quot;\n\n如果改成用链接名称的方式写：\nI get 10 times more traffic from [Google][] than from\n[Yahoo][] or [MSN][].\n\n  [google]: http://google.com/        &quot;Google&quot;\n  [yahoo]:  http://search.yahoo.com/  &quot;Yahoo Search&quot;\n  [msn]:    http://search.msn.com/    &quot;MSN Search&quot;\n\n上面两种写法都会产生下面的 HTML。\n&lt;p&gt;I get 10 times more traffic from &lt;a href=&quot;http://google.com/&quot;\ntitle=&quot;Google&quot;&gt;Google&lt;/a&gt; than from\n&lt;a href=&quot;http://search.yahoo.com/&quot; title=&quot;Yahoo Search&quot;&gt;Yahoo&lt;/a&gt;\nor &lt;a href=&quot;http://search.msn.com/&quot; title=&quot;MSN Search&quot;&gt;MSN&lt;/a&gt;.&lt;/p&gt;\n\n下面是用行内式写的同样一段内容的 Markdown 文件，提供作为比较之用：\nI get 10 times more traffic from [Google](http://google.com/ &quot;Google&quot;)\nthan from [Yahoo](http://search.yahoo.com/ &quot;Yahoo Search&quot;) or\n[MSN](http://search.msn.com/ &quot;MSN Search&quot;).\n\n参考式的链接其实重点不在于它比较好写，而是它比较好读，比较一下上面的范例，使用参考式的文章本身只有 81 个字符，但是用行内形式的却会增加到 176 个字元，如果是用纯 HTML 格式来写，会有 234 个字元，在 HTML 格式中，标签比文本还要多。\n使用 Markdown 的参考式链接，可以让文件更像是浏览器最后产生的结果，让你可以把一些标记相关的元数据移到段落文字之外，你就可以增加链接而不让文章的阅读感觉被打断。\n强调\nMarkdown 使用星号（`*`）和底线（`_`）作为标记强调字词的符号，被 `*` 或 `_` 包围的字词会被转成用 `` 标签包围，用两个 `*` 或 `_` 包起来的话，则会被转成 ``，例如：\n\n*single asterisks*\n\n_single underscores_\n\n**double asterisks**\n\n__double underscores__\n\n会转成：\n&lt;em&gt;single asterisks&lt;/em&gt;\n\n&lt;em&gt;single underscores&lt;/em&gt;\n\n&lt;strong&gt;double asterisks&lt;/strong&gt;\n\n&lt;strong&gt;double underscores&lt;/strong&gt;\n\n你可以随便用你喜欢的样式，唯一的限制是，你用什么符号开启标签，就要用什么符号结束。\n强调也可以直接插在文字中间：\nun*frigging*believable\n\n但是如果你的 * 和 _ 两边都有空白的话，它们就只会被当成普通的符号。\n如果要在文字前后直接插入普通的星号或底线，你可以用反斜线：\n\\*this text is surrounded by literal asterisks\\*\n\n代码\n如果要标记一小段行内代码，你可以用反引号把它包起来（`` ` ``），例如：\n\nUse the `printf()` function.\n\n会产生：\n&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;\n\n如果要在代码区段内插入反引号，你可以用多个反引号来开启和结束代码区段：\n``There is a literal backtick (`) here.``\n\n这段语法会产生：\n&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;\n\n代码区段的起始和结束端都可以放入一个空白，起始端后面一个，结束端前面一个，这样你就可以在区段的一开始就插入反引号：\nA single backtick in a code span: `` ` ``\n\nA backtick-delimited string in a code span: `` `foo` ``\n\n会产生：\n&lt;p&gt;A single backtick in a code span: &lt;code&gt;`&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;A backtick-delimited string in a code span: &lt;code&gt;`foo`&lt;/code&gt;&lt;/p&gt;\n\n在代码区段内，&amp; 和尖括号都会被自动地转成 HTML 实体，这使得插入 HTML 原始码变得很容易，Markdown 会把下面这段：\nPlease don&#39;t use any `&lt;blink&gt;` tags.\n\n转为：\n&lt;p&gt;Please don&#39;t use any &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tags.&lt;/p&gt;\n\n你也可以这样写：\n`&amp;#8212;` is the decimal-encoded equivalent of `&amp;mdash;`.\n\n以产生：\n&lt;p&gt;&lt;code&gt;&amp;amp;#8212;&lt;/code&gt; is the decimal-encoded\nequivalent of &lt;code&gt;&amp;amp;mdash;&lt;/code&gt;.&lt;/p&gt;\n\n图片\n很明显地，要在纯文字应用中设计一个「自然」的语法来插入图片是有一定难度的。\n\nMarkdown 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： 行内式和参考式。\n行内式的图片语法看起来像是：\n![Alt text](/path/to/img.jpg)\n\n![Alt text](/path/to/img.jpg &quot;Optional title&quot;)\n\n详细叙述如下：\n\n一个惊叹号 !\n接着一个方括号，里面放上图片的替代文字\n接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上选择性的 ‘title’ 文字。\n\n参考式的图片语法则长得像这样：\n![Alt text][id]\n\n「id」是图片参考的名称，图片参考的定义方式则和连结参考一样：\n[id]: url/to/image  &quot;Optional title attribute&quot;\n\n到目前为止， Markdown 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 &lt;img&gt; 标签。\n\n其它\n自动链接\nMarkdown 支持以比较简短的自动链接形式来处理网址和电子邮件信箱，只要是用尖括号包起来， Markdown 就会自动把它转成链接。一般网址的链接文字就和链接地址一样，例如：\n\n&lt;http://example.com/&gt;\n\nMarkdown 会转为：\n&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;\n\n邮址的自动链接也很类似，只是 Markdown 会先做一个编码转换的过程，把文字字符转成 16 进位码的 HTML 实体，这样的格式可以糊弄一些不好的邮址收集机器人，例如：\n&lt;address@example.com&gt;\n\nMarkdown 会转成：\n&lt;a href=&quot;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;\n&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;\n&amp;#109;&quot;&gt;&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;\n&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;\n\n在浏览器里面，这段字串（其实是 &lt;a href=&quot;mailto:address@example.com&quot;&gt;address@example.com&lt;/a&gt;）会变成一个可以点击的「&#97;&#x64;&#100;&#114;&#101;&#x73;&#x73;&#64;&#x65;&#120;&#x61;&#x6d;&#112;&#108;&#101;&#46;&#99;&#x6f;&#x6d;」链接。\n（这种作法虽然可以糊弄不少的机器人，但并不能全部挡下来，不过总比什么都不做好些。不管怎样，公开你的信箱终究会引来广告信件的。）\n反斜杠\nMarkdown 可以利用反斜杠来插入一些在语法中有其它意义的符号，例如：如果你想要用星号加在文字旁边的方式来做出强调效果（但不用 `` 标签），你可以在星号的前面加上反斜杠：\n\n\\*literal asterisks\\*\n\nMarkdown 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：\n\\   反斜线\n`   反引号\n*   星号\n_   底线\n&#123;&#125;  花括号\n[]  方括号\n()  括弧\n#   井字号\n+   加号\n-   减号\n.   英文句点\n!   惊叹号\n\n感谢\n感谢 [leafy7382][] 协助翻译，[hlb][]、[Randylien][] 帮忙润稿，[ethantw][] 的[汉字标准格式・CSS Reset][]， [WM][] 回报文字错误。\n\n感谢 fenprace，addv。\n\nMarkdown 免费编辑器\nWindows 平台\n\n\nMarkdownPad\nMarkPad\n\nLinux 平台\n\nReText\n\nMac 平台\n\nMou\n\n在线编辑器\n\nMarkable.in\nDillinger.io\n\n浏览器插件\n\nMaDe (Chrome)\n\n高级应用\n\nSublime Text 2 + MarkdownEditing &#x2F; 教程\n\n*** 如有更好的 Markdown 免费编辑器推荐，请到这里反馈，谢谢！\n","categories":["How-To"],"tags":["markdown","hexo"]},{"title":"Remote Access to Plex via IPv6","url":"/2022/06/03/remote-access-to-plex-via-ipv6.html","content":"\nPublic IPv4 addresses become much rarer in recent years, at the same time IPv6 grows rapidly and most ISPs have started supported it. To remote access to plex media server via IPv6, some configurations need to be setup.\n\n\n\nPrerequestThis article supposes you have a custom domain, and DDNS&#x2F;DNS has been properly configured. Thus the server can be accessed directly via domain.\nInstall Plex Media ServerDEB-based distros (Ubuntu, etc.)# Add sourceecho deb https://downloads.plex.tv/repo/deb public main | sudo tee /etc/apt/sources.list.d/plexmediaserver.list# Add keycurl https://downloads.plex.tv/plex-keys/PlexSign.key | sudo apt-key add -# Installsudo apt updatesudo apt install plexmediaserver\n\nRPM-based distros (Fedora, CentOS, etc.)sudo vim /etc/yum.repos.d/plex.repo\n\n[PlexRepo]name=PlexRepobaseurl=https://downloads.plex.tv/repo/rpm/$basearch/enabled=1gpgkey=https://downloads.plex.tv/plex-keys/PlexSign.keygpgcheck=1\n\nsudo yum updatesudo yum install plexmediaserver\n\nConfigure NetworkGoto Settings -&gt; Network\nEnable IPv6 support in plex media server\n\nSet custom URLThis step is to give you access to flex media server in android app.\n\n\nAllow insecure connectionOpen Android App, Goto Settings -&gt; Advantage -&gt; Allow insecure connection\nSet to Always\nJust PlayNow you can either access to your flex media server via\nhttp:&#x2F;&#x2F;&lt;your domain&gt;:32400\nOr through Android App.\nReferencehttps://support.plex.tv/articles/235974187-enable-repository-updating-for-supported-linux-server-distributions/\n","categories":["How-To"],"tags":["Media","Server"]},{"title":"安装Jellyfin并配置硬件加速","url":"/2022/02/27/setup-jellyfin-as-home-media-server.html","content":"\n如果在外网播放家里NAS中的视频，通常会遇到2个问题：带宽不足和编码不支持。这时候我们就需要NAS对原始视频进行二次编码，然后将低码率的视频推送到设备上，能完成这项任务的软件有3个：Plex、Emby和Jellyfin，鉴于前两个都需要付费才能解锁完整功能，我们自然优先选择开源免费的Jellyfin。\n\n\n\n安装JellyfinJellyfin为我们提供了一键安装脚本，能够自动检测系统环境，配置软件源并完成安装。\ncurl https://repo.jellyfin.org/install-debuntu.sh | sudo bash\n\n安装完成后，使用IP+端口的方式访问Jellyfin的Web界面，完成后续配置。http://your_local_IP_address:8096\n配置硬件加速默认情况下，Jellyfin使用CPU进行视频编解码，速度慢，功耗高，所以最好使用GPU来转码，以提高性能。\nIntel GPUIntel的GPU主要支持QSV和VA-API两种硬件加速方式。QSV性能好，但只支持5代以后的GPU；VA-API性能差，但支持几乎所有的GPU。\n\n安装jellyfin-ffmpeg\n sudo apt update &amp;&amp; sudo apt install -y jellyfin-ffmpeg7\n\n确认&#x2F;dev&#x2F;dri&#x2F;render节点是否存在\n\nPromoxVE中的LXC容器，编辑/etc/pve/lxc/&lt;CONTAINER_ID&gt;.conf\nlxc.cgroup2.devices.allow: c 226:0 rwmlxc.cgroup2.devices.allow: c 226:128 rwmlxc.mount.entry: /dev/dri/renderD128 dev/dri/renderD128 none bind,optional,create=file\n\n\n将jellyfin用户添加到render组\n sudo usermod -aG render jellyfinsudo systemctl restart jellyfin\n\n安装intel-opencl-icd\n sudo apt install -y intel-opencl-icd\n\n检查当前GPU支持的编码格式，以及OpenCL运行状态\n sudo /usr/lib/jellyfin-ffmpeg/vainfo --display drm --device /dev/dri/renderD128sudo /usr/lib/jellyfin-ffmpeg/ffmpeg -v verbose -init_hw_device vaapi=va:/dev/dri/renderD128 -init_hw_device opencl@va\n\n配置Jellyfin硬件转码\n 打开Jellyfin &gt; 控制台 &gt; 播放 &gt; 转码。\n\n硬件转码: Intel QuickSync (QSV)\nQSV设备: /dev/dri/renderD128\n启用硬件解码: 根据当前GPU支持的解码格式选择\n启用硬件编码: 根据当前GPU支持的编码格式选择\n启用VPP色调映射\n\n\n\n配置Nginx反向代理如果需要使用域名或者https访问Jellyfin服务，可以配置Nginx的反向代理功能。\n/etc/nginx/conf.d/jellyfin.conf\n# Uncomment the commented sections after you have acquired a SSL Certificateserver &#123;    listen 80;    listen [::]:80;    # server_name DOMAIN_NAME;    # Uncomment to redirect HTTP to HTTPS    # return 301 https://$host$request_uri;#&#125;#server &#123;    # listen 443 ssl http2;    # listen [::]:443 ssl http2;    server_name DOMAIN_NAME;    # use a variable to store the upstream proxy    # in this example we are using a hostname which is resolved via DNS    # (if you aren&#x27;t using DNS remove the resolver line and change the variable to point to an IP address e.g `set $jellyfin 127.0.0.1`)    set $jellyfin jellyfin;    resolver 127.0.0.1 valid=30;    #ssl_certificate /etc/letsencrypt/live/DOMAIN_NAME/fullchain.pem;    #ssl_certificate_key /etc/letsencrypt/live/DOMAIN_NAME/privkey.pem;    #include /etc/letsencrypt/options-ssl-nginx.conf;    #ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;    #add_header Strict-Transport-Security &quot;max-age=31536000&quot; always;    #ssl_trusted_certificate /etc/letsencrypt/live/DOMAIN_NAME/chain.pem;    #ssl_stapling on;    #ssl_stapling_verify on;    # Security / XSS Mitigation Headers    add_header X-Frame-Options &quot;SAMEORIGIN&quot;;    add_header X-XSS-Protection &quot;1; mode=block&quot;;    add_header X-Content-Type-Options &quot;nosniff&quot;;    # Content Security Policy    # See: https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP    # Enforces https content and restricts JS/CSS to origin    # External Javascript (such as cast_sender.js for Chromecast) must be whitelisted.    #add_header Content-Security-Policy &quot;default-src https: data: blob: http://image.tmdb.org; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; https://www.gstatic.com/cv/js/sender/v1/cast_sender.js https://www.gstatic.com/eureka/clank/95/cast_sender.js https://www.gstatic.com/eureka/clank/96/cast_sender.js https://www.gstatic.com/eureka/clank/97/cast_sender.js https://www.youtube.com blob:; worker-src &#x27;self&#x27; blob:; connect-src &#x27;self&#x27;; object-src &#x27;none&#x27;; frame-ancestors &#x27;self&#x27;&quot;;    location = / &#123;        return 302 http://$host/web/;        #return 302 https://$host/web/;    &#125;    location / &#123;        # Proxy main Jellyfin traffic        proxy_pass http://$jellyfin:8096;        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header X-Forwarded-Proto $scheme;        proxy_set_header X-Forwarded-Protocol $scheme;        proxy_set_header X-Forwarded-Host $http_host;        # Disable buffering when the nginx proxy gets very resource heavy upon streaming        proxy_buffering off;    &#125;    # location block for /web - This is purely for aesthetics so /web/#!/ works instead of having to go to /web/index.html/#!/    location = /web/ &#123;        # Proxy main Jellyfin traffic        proxy_pass http://$jellyfin:8096/web/index.html;        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header X-Forwarded-Proto $scheme;        proxy_set_header X-Forwarded-Protocol $scheme;        proxy_set_header X-Forwarded-Host $http_host;    &#125;    location /socket &#123;        # Proxy Jellyfin Websockets traffic        proxy_pass http://$jellyfin:8096;        proxy_http_version 1.1;        proxy_set_header Upgrade $http_upgrade;        proxy_set_header Connection &quot;upgrade&quot;;        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        proxy_set_header X-Forwarded-Proto $scheme;        proxy_set_header X-Forwarded-Protocol $scheme;        proxy_set_header X-Forwarded-Host $http_host;    &#125;&#125;\n\n参考https://miaotony.xyz/2023/11/26/Server_HomeLab_4_GPUtranscoding/\nhttps://jellyfin.org/docs/general/post-install/transcoding/hardware-acceleration/\nDownloads - Jellyfin: The Free Software Media System\nHome | Documentation - Jellyfin Project\nIntel media stack on Ubuntu · Intel-Media-SDK&#x2F;MediaSDK Wiki · GitHub\nsoftware recommendation - How to measure GPU usage? - Ask Ubuntu\nlinuxserver&#x2F;jellyfin:10.6.4-1-ls96 broke Intel Quicksync (most likely due to jellyfin-ffmpeg4.3.1-4-focal) · Issue #96 · linuxserver&#x2F;docker-jellyfin · GitHub\nHardware video acceleration - ArchWiki\n","categories":["How-To"],"tags":["jellyfin","media","server"]},{"title":"从源码构建linux 2.6.10系统环境","url":"/2020/08/23/setup-linux-2-6-system-from-scratch.html","content":"\n最近想要重新看一遍ldd3，以前看的时候总是照着新版的内核写代码，结果很多接口都发生了变化，在这个问题上浪费了不少时间，以至于最后看不下去了。所以这次打算使用upstream的linux 2.6.10来做实验，一方面upstream的内核没有受到第三方patch的污染，另一方面可以把关注点放在内核的接口设计以及驱动框架本身。所以就花了一些时间把linux 2.6.10的系统环境搭建了出来，这里记录一下搭建过程。\n\n\n\nBuild kernel由于linux 2.6.10是一个相当古老的内核版本，她是2004年release的，想要在2020年的系统中直接编译她是很难的，我们需要找一个与她release时间接近的发行版，这里我选择了ubuntu 5.04的Docker container，关于如何制作这样的Docker image，可以参考这篇文章：将rootfs转换成Dcoker image。\n安装依赖包sudo apt-get install build-essential libncurses-dev gcc make libc6-dev\n\n配置kernel由于我需要使用nfs挂载rootfs，所以需要需要保证kernel启动时能够正常配置网络。\nmake defconfigmake menuconfig# 配置网卡驱动，qemu使用的网卡通常为E1000Intel(R) PRO/1000 Gigabit Ethernet support (E1000)Location: -&gt; Device Drivers  -&gt; Networking support   -&gt; Network device support (NETDEVICES)    -&gt; Ethernet (1000 Mbit)# 配置IP PNP，NFS ROOT依赖此选项IP: kernel level autoconfiguration (IP_PNP)IP: DHCP support (IP_PNP_DHCP)IP: BOOTP support (IP_PNP_BOOTP)IP: RARP support (IP_PNP_RARP)Location: -&gt; Device Drivers  -&gt; Networking support   -&gt; Networking support (NET)    -&gt; Networking options     -&gt; TCP/IP networking (INET)# 配置NFS ROOTRoot file system on NFS (ROOT_NFS)Location: -&gt; File systems  -&gt; Network File Systems\n\n编译kernelmake -j8\n\n  SYSMAP  System.map  SYSMAP  .tmp_System.map  Building modules, stage 2.  MODPOST  AS      arch/x86_64/boot/setup.o  OBJCOPY arch/x86_64/boot/compressed/vmlinux.bin  LD      arch/x86_64/boot/setup  GZIP    arch/x86_64/boot/compressed/vmlinux.bin.gz  LD      arch/x86_64/boot/compressed/piggy.o  LD      arch/x86_64/boot/compressed/vmlinux  OBJCOPY arch/x86_64/boot/vmlinux.bin  BUILD   arch/x86_64/boot/bzImageRoot device is (0, 60)Boot sector 512 bytes.Setup is 2444 bytes.System is 2141 kBKernel: arch/x86_64/boot/bzImage is ready\n\nBuild rootfs构建rootfs的方式有很多种，比如busybox，buildroot，yocto等。由于本次的重点在于kernel，所以我们选择buildroot来快速构建一个rootfs。\n版本选择虽然kernel的系统调用接口是非常稳定的，但由于linux 2.6.10太老了，使用新版本的toolchain编译出的binary在她上执行可能会报“kernel too old”的错误，所以我们并不能直接使用最新的buildroot，经过实验，buildroot-2014.11是一个能够使用的版本。\n配置BuildrootBuildroot自带一些config模板，因为我们使用的是qemu-x86-64的平台，因此只要执行以下命令\nmake qemu_x86_64_defconfig\n\n因为我们并不需要Buildroot来编译内核，也不需要生成文件系统镜像，所以要基于此配置做一些修改\nmake menuconfig# 取消kernel编译Symbol: BR2_LINUX_KERNEL [=n]Type  : booleanPrompt: Linux Kernel  Location:    -&gt; Kernel# 只打包tar包Symbol: BR2_TARGET_ROOTFS_TAR [=y]Type  : booleanPrompt: tar the root filesystem  Location:    -&gt; Filesystem images# 配置consoleSymbol: BR2_TARGET_GENERIC_GETTY_PORT [=console]Type  : stringPrompt: TTY port  Location:    -&gt; System configuration      -&gt; Run a getty (login prompt) after boot (BR2_TARGET_GENERIC_GETTY [=y])        -&gt; getty options\n\n编译Buildrootmake -j8\n\n最后即可生成rootfs的tar包\noutput/images/rootfs.tar\n\nNFS boot这里并不会直接使用命令行来启动qemu，而是使用virt-manager，ubuntu使用以下命令来安装\nsudo apt install virt-manager\n\nNFS exports参数\n/exports/rootfs *(rw,no_root_squash,no_all_squash)\n\n使用的cmdline如下\nroot=/dev/nfs nfsroot=192.168.1.1:/exports/rootfs,nfsvers=3 rw ip=dhcp console=ttyS0\n\n","categories":["How-To"],"tags":["linux","buildroot","ldd3"]},{"title":"shell脚本技巧","url":"/2021/04/27/shell-script-tips.html","content":"实用shell脚本技巧。\n\n\n\nbash下使用echo的时候&#39;\\n&#39;不能换行？\n在shell脚本开头添加：\nshopt -s xpg_echo\n\nshell script函数返回值\n\n使用全局变量\nfunction myfunc()&#123;    myresult=&#x27;some value&#x27;&#125;myfuncecho $myresult\n\n使用echo\nfunction myfunc()&#123;    local  myresult=&#x27;some value&#x27;    echo &quot;$myresult&quot;&#125;result=$(myfunc)   # or result=`myfunc`echo $result\n\n使用eval\nfunction myfunc()&#123;    local  __resultvar=$1    local  myresult=&#x27;some value&#x27;    eval $__resultvar=&quot;&#x27;$myresult&#x27;&quot;&#125;myfunc resultecho $result\n\n\n\n","categories":["How-To"],"tags":["linux","shell"]},{"title":"分手后该不该做朋友","url":"/2021/04/02/should-we-keep-friendship-after-break-up.html","content":"\nSpecial meeting: Debates\n情侣分手后能不能做朋友——不能做朋友\n\n\n\n传统心理学的观点认为爱情是由友爱与热爱组成。热爱是强烈的渴望，通常陪随着生理激起（呼吸急促、心跳加速，如堕入爱河）。而友爱，或者说友情是指人类或动物间的情谊或是指亲切的交谊、交情。友情是基于相互的了解、尊重和喜欢。存在友情的两人，互称朋友。\n回到今天的辩题，分手后能不能做朋友。分手意味着两人都曾付出过真心，如果有一方抱着欺骗或者利用的心态，那不叫分手；而朋友意味着两人可以真诚相待，仅仅存在于微信好友列表那不叫朋友。\n分手的原因大体可以分为：缺乏信任、冲突太多、不安全感等。纵观以上这几个原因，无论哪一个，都将导致我们不再信任对方，甚至厌恶对方，这直接打破了友情的基础——互相喜欢，互相不喜欢的两个人，即使再了解、再尊重，也不可能成为我们的朋友。\n因此，我方认为，情侣分手之后，不能做朋友。\n我将主要从以下三个方面来阐述：\n第一，曾经的诺言变成谎言。试想，两个曾经互相倾心，互相仰慕，互相海誓山盟要共度此生的人分开之后，他们要如何面对这些难以承受的诺言。真诚是友情的基石，我们想要交朋友，是因为在这个复杂多变的世界，我们想要有一个人，可以毫无顾忌的倾诉。而面对一个曾经说过谎的人，你真的能够放下所有的防备，放下所有的戒心，去展露你最脆弱的一面吗？这是很难做到的。当我们向这样的人去分享自己心中的秘密时，我们会不会担心：这个人靠谱吗，他会不会把我的秘密说出去，他说的话真的可信吗？这些猜忌，不仅会毁了友情，也会给自己增添无意义的精神压力。本来我们跟朋友交流是为了获得愉悦，结果反而更加烦恼，这好吗，这不好。\n第二，让自己处于进退两难的境地。分手后做朋友，可以说提出这个想法的人肯定是有私心的。两个相爱过的人分手后，无论是哪一方，都不会很好受，在这种强烈的负面情绪的刺激下，就会想出“我们继续做朋友”这种主意，但这是非理性的决定。两个人会走到分手这一步，说明互相有一些完全不可接受和忍让的点，但是处于分手痛苦中的人通常会忘记这些，而只是想着快乐的记忆，造成一种我们还能继续的错觉。但实际上真的重新相处后，又会重新面对这些问题，再次分手。这种死循环既浪费时间，也浪费精力，更浪费金钱。\n第三，可能会给自己的爱情带来危险。我想，没有几个人会希望自己的另一半对前任念念不忘，爱情是自私的，我们都希望自己是对方的唯一。但是如果自己经常跟前任出去逛街，吃饭，看电影，做一切朋友之间都会做的事情，你的另一半会如何想？你们真的只是单纯的朋友关系吗？你们会不会死灰复燃？这些想法挥之不去，直到你的另一半崩溃，然后吵架，最后你的现任也变成了前任，你会暗自庆幸自己又多了一个朋友吗？\n综上，我方认为，情侣分手后不能做朋友，那是一种非常不理性且危险的行为。\n","categories":["Life"],"tags":["toastmaster","debates"]},{"title":"通过trace-cmd和kernelshark简化Ftrace的使用","url":"/2019/12/21/simplify-ftrace-with-tracecmd-and-kernelshark.html","content":"\n虽然Ftrace在debugfs中的接口很简单，但在实际操作时，还是显得不太灵活。如果能让一个应用程序代替我们与Ftrace的接口交互，将会大大简化其使用，而这个程序就是trace-cmd。此外，为了能够更加直观的分析过滤Ftrace的log，将会介绍一个基于GUI的工具kernelshark。\n\n\n\n安装从软件源安装sudo apt install trace-cmd kernelshark\n\n从源码安装\n安装依赖\nsudo apt-get install build-essential git cmake libjson-c-dev -ysudo apt-get install freeglut3-dev libxmu-dev libxi-dev -ysudo apt-get install qtbase5-dev -ysudo apt-get install graphviz doxygen-gui -y\n\n克隆源码\ngit clone https://git.kernel.org/pub/scm/linux/kernel/git/rostedt/trace-cmd.git\n\n编译安装\ncd trace-cmd# compile trace-cmdmake# install trace-cmdmake install# compile kernelsharkmake gui# install kernelsharkmake install_gui\n\n工作原理下面是一个简单的例子:\nsudo trace-cmd record -e ext4 lssudo trace-cmd report\n\nCPU 0 is emptyCPU 1 is emptyCPU 2 is emptyCPU 3 is emptyCPU 4 is emptyCPU 6 is emptyCPU 7 is emptycpus=8              ls-8018  [005] 1233847.755818: ext4_es_lookup_extent_enter: dev 252,1 ino 28442625 lblk 0              ls-8018  [005] 1233847.755834: ext4_es_lookup_extent_exit: dev 252,1 ino 28442625 found 1 [0/1) 113778720 W              ls-8018  [005] 1233847.755859: ext4_journal_start:   dev 252,1 blocks, 2 rsv_blocks, 0 caller ext4_dirty_inode              ls-8018  [005] 1233847.755861: ext4_mark_inode_dirty: dev 252,1 ino 28442625 caller ext4_dirty_inode\n\n第一条命令记录了ls命令在执行时，ext4子系统中所有tracepoint的输出。输出结果保存在文件trace.dat中，可以分别对record和report使用-o和-i来设置输出和输入的文件名。\n第二条命令解析trace.dat中的内容并打印到标准输出。可以看到CPU的数量以及哪些CPU的buffer为空，最下面则是记录的log，其格式与function tracer相同。\n当开始记录时，trace-cmd会为每一个CPU创建一个进程，每个进程打开对应CPU的buffer文件并记录到单独的文件中，比如CPU0的buffer映射到/sys/kernel/debug/tracing/per_cpu/cpu0/trace_pipe_raw，其数据会被记录到trace.dat.cpu0。当结束记录时，这些文件会被合并到一个文件中，比如trace.dat。\n使用trace-cmd不需要手动挂载debugfs，它会自动挂载debugfs并寻找其挂载路径。\nRecord基本参数record的参数实际上对应了Ftrace在debugfs中的接口。\n\n-e表示跟踪一个event，可以使用event名，子系统名，如果要跟踪多个event，可以多次使用该选项，或者all用来监控所有的event。可以使用sudo trace-cmd list -e来查看当前系统中有哪些支持跟踪的event。\n\n-f表示对一个event中的某些域（field）进行过滤，只对其之前-e设置的event生效，因此一般紧跟在-e之后。要查看一个event有哪些域可以进行过滤，可以查看/sys/kernel/debug/tracing/events/&lt;subsystem&gt;/&lt;event&gt;/format，其中subsystem和event可以通过sudo trace-cmd list -e来获得。\n\n-p表示使用一个plugin，实际上就是Ftrace中的tracer，可以使用sudo trace-cmd list -t查看当前系统支持哪些tracer。同一时刻只能使用一种plugin。\n\n-l表示后面跟上函数名，表示只跟踪这个函数；-n后面跟上函数名，表示不跟踪这个函数，这两个选项均可多次使用来设置多个函数。可以通过sudo trace-cmd list -f查看哪些函数可以进行过滤。注意，函数过滤仅在使用function和function_graph这两个plugin时有效。\n\n-M表示CPU掩码，使用16进制表示，每一位表示一个CPU，例如4(16) &#x3D; 100(2)，因此只有CPU2的数据会被记录。\n\n\n下面是一些例子：\n\n跟踪内核中中断的执行时间\nsudo trace-cmd record -p function_graph -l do_IRQ -e irq_handler_entry sleep 1\n\nCPU 1 is emptyCPU 2 is emptyCPU 3 is emptyCPU 5 is emptyCPU 6 is emptyCPU 7 is emptycpus=8          &lt;idle&gt;-0     [000] 1251617.972283: funcgraph_entry:                   |  do_IRQ() &#123;          &lt;idle&gt;-0     [000] 1251617.972302: irq_handler_entry:    irq=10 name=virtio0          &lt;idle&gt;-0     [000] 1251617.972359: funcgraph_exit:       + 77.853 us  |  &#125;          &lt;idle&gt;-0     [004] 1251618.092777: funcgraph_entry:                   |  do_IRQ() &#123;          &lt;idle&gt;-0     [004] 1251618.092792: irq_handler_entry:    irq=15 name=ata_piix          &lt;idle&gt;-0     [004] 1251618.092892: funcgraph_exit:       ! 116.705 us |  &#125;          &lt;idle&gt;-0     [004] 1251618.092907: funcgraph_entry:                   |  do_IRQ() &#123;          &lt;idle&gt;-0     [004] 1251618.092908: irq_handler_entry:    irq=15 name=ata_piix          &lt;idle&gt;-0     [004] 1251618.092954: funcgraph_exit:       + 47.463 us  |  &#125;\n\n通过bytes_req域过滤kmalloc_node event\ntrace-cmd record -e kmalloc_node -f &#x27;bytes_req &gt; 1000&#x27;\n\nname: kmalloc_nodeID: 515format:        field:unsigned short common_type;       offset:0;       size:2; signed:0;        field:unsigned char common_flags;       offset:2;       size:1; signed:0;        field:unsigned char common_preempt_count;       offset:3;       size:1; signed:0;        field:int common_pid;   offset:4;       size:4; signed:1;        field:unsigned long call_site;  offset:8;       size:8; signed:0;        field:const void * ptr; offset:16;      size:8; signed:0;        field:size_t bytes_req; offset:24;      size:8; signed:0;        field:size_t bytes_alloc;       offset:32;      size:8; signed:0;        field:gfp_t gfp_flags;  offset:40;      size:4; signed:0;        field:int node; offset:44;      size:4; signed:1;    [...]\n\n通过网络传输对于一些存储空间非常有限，或者存储器速度较慢的设备，可以通过网络将trace.dat保存到其它设备中。\n\nhost\ntrace-cmd listen -p 12345 -D -d /images/tracing/ -l /images/tracing/logfile\n\n-p：端口\n-D：daemon模式\n-d：trace文件保存的位置\n-l：log文件保存的位置\n\nclient\ntrace-cmd record -N 192.168.1.100:12345 -e ext4 ls\n\n-N：IP地址和端口号\n\n\nReport此时，我们已经拿到了trace.dat，现在需要对其进行分析。因为其中可能包含海量的数据，所以仍然需要过滤。\ntrace-cmdtrace-cmd report\n\ntrace-cmd本身提供了非常灵活且强大的过滤功能，但是使用起来也非常繁琐，尤其是当处理大量数据时，因此，这里不对其进行详细介绍，有需要可以通过man trace-cmd-report了解其详细用法。\nkernelsharkkernelshark是一个用来查看trace.dat的GUI程序，完整的文档请访问KernelShark。\n\n\n总结以上是对Ftrace的两个前端工具——trace-cmd和kernelshark的简单介绍，通过这两个工具，可以更加容易的使用Ftrace接口，从而更加高效的调试、优化内核。\n参考资料trace-cmd: A front-end for Ftrace\nUsing KernelShark to analyze the real-time scheduler\nKernelShark\n","categories":["Kernel"],"tags":["linux","debug","ftrace","trace-cmd","kernelshark"]},{"title":"软件收集","url":"/2021/07/03/software-collection.html","content":"\n本文用来记录曾经使用过的软件。\n\n\n\n软件站点乐软博客\n软件资源MatlabMathWorks MATLAB R2021a中文破解版\n思维导图Diagrams\n视频编辑Avidemux\nXserverVcxsrv\nPXEiPXE\n编译器Compiler Explore\n","categories":["Resources"],"tags":["软件"]},{"title":"Survive in the Debate","url":"/2021/10/20/survive-in-the-debate.html","content":"\nPathways: Dynamic Leadership\nLevel 2-2: Understanding Your Communication Style\n\n\n\nContentSurvive in the debate, after reading this title, you may guess I will introduce some magic debate skills to you, right? Well, please let me share a small story to you first, then you may understand what I’m going to talk about.\nIt’s a sunshiny morning at about one year ago. I was having a voice call with my girl friend. In the phone, she said: today I got up very early and wiped the floor. I responded: wow, it must be pretty tired to squat and wipe. “No, I used a mop”, she said. “But if you use a mop, it should be mopping rather than wiping the floor”, I queried her. Then she said:”But all of us call that wiping, nobody says mopping”. I debated:”It seems only you use wiping, in my family, we always use mopping”. “Then what, I just use wiping”, she’s a little angry. But I still wanted to persuade her, “it’s wired using wiping, you should use mopping”. Then, she ended the call.\nI didn’t understand why she got angry, because at that time, I was a kind of debate elf in the real life. I always tried my best to stand for my point, during the lunch with my colleague, during the evening with my family, or even in the comments of a microblog. I debated with these people and I enjoined it, because on most of time I wo . Maybe these people just didn’t want to argue with me.\nAt the end, my girl friend left me after a quarrel, I can’t even remember what we were arguing for. Then I got into a heart broken period.\nOccasionally, I found a interesting view in a book, It said: The only way to win in a debate is avoiding debate. Because our life is not a debate contest, most of us are just normal people, thus we may have some weakness in our mind. And one of them is that it’s nearly impossible to change one’s mind unless he would like to. If we debate with a person, we are challenging his knowledge and dignity, then he will get into fight mode, and stands for his point from start to the end, even if you are right.\nI was little curious if this theory would work for me, because it seemed I didn’t have many friends and good relationship with my family, so I start trying to change my communication style, to be more gentle and approachable, to see what will happen. In the later days, when I had conversation with colleague, even if I knew someone was wrong, I would not point out directly if it’s not that important. While talking with my parents, I just listened and answered their questions, without debating for small things. I suddenly realized, when I was a child, I must made lots of small mistakes, but my parents seemed never arguing with me. Now, they are getting old and some knowledge is out of date, I should do the same thing to them.\nNow I’m perceived as patient, amiable and supportive by my friends. My parents like to share their story with me,  and even my girl friend said that I am changing a lot, to the good way.\nJust like the book said: If you argue and debate, you may gain the victory for temporary, but that is short and useless, and you will never earn other’s favor. We are in a society and have connection with others. Sometimes, it may change everything if we let our customer, lover, husband or wife win us in a small debate.\nEvaluation\n\nPhotos\n\n\n\n\n\n\n\n\n","categories":["Life"],"tags":["toastmaster","speech"]},{"title":"修改Windows注册表交换Ctrl和Caps按键","url":"/2019/11/09/swap-ctrl-and-caps-under-windows.html","content":"\n在使用键盘的时候，经常会用到Ctrl来触发各种快捷键，但每次使用Ctrl，手都需要大幅度扭曲，非常不舒服，反观Caps这个按键，不仅位置舒适，而且按键更大，但却常年得不到有效利用。目前市面上已经有一些键盘另辟蹊径，把Ctrl和Caps进行交换来获得更好的打字体验，但这通常需要特殊的固件或者驱动才能实现。实际上，在Windows下可以通过修改注册表来重新映射按键，从而让普通键盘也能做到这一点。\n\n\n\n手动修改\nWin+R，输入regedit，打开注册表编辑器\n\n\n按照以下路径找到Keyboard Layout\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Keyboard Layout\n\n右键Keyboard Layout，选择新建二进制值，并将新建的值重命名为Scancode Map\n\n\n右键Scancode Map，选择修改，然后输入以下数值，注意，数值不能复制，必须手动输入\n00 00 00 00 00 00 00 0003 00 00 00 1D 00 3A 003A 00 1D 00 00 00 00 00\n\n输入完成后的效果如下\n\n\n重启电脑即可生效\n\n\n自动修改将以下代码保存为swap-ctrl-caps.reg，双击运行即可直接导入数值\nWindows Registry Editor Version 5.00[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Keyboard Layout]&quot;Scancode Map&quot;=hex:00,00,00,00,00,00,00,00,03,00,00,00,3a,00,1d,00,1d,00,3a,00,\\  00,00,00,00\n\n如何恢复将Scancode Map删除，重启即可恢复。\n","categories":["How-To"],"tags":["windows"]},{"title":"The Goose that Lays Golden Eggs","url":"/2021/03/14/the-goose-that-lays-golden-eggs.html","content":"\nPathways: Dynamic Leadership\nLevel 1-2: Evaluation and Feedback\n\n\n\nYou may be curious about this title, but please let me share a story with you first.\nThere was once a Countryman who possessed the most wonderful Goose you can imagine, for every day when he visited the nest, the Goose had laid a beautiful, glittering, golden egg. The Countryman took the eggs to market and soon began to get rich. But it was not long before he grew impatient with the Goose because she gave him only a single golden egg a day. He was not getting rich fast enough. Then one day, after he had finished counting his money, the idea came to him that he could get all the golden eggs at once by killing the Goose and cutting it open. But when the deed was done, not a single golden egg did he find, and his precious Goose was dead.\nIn the real life, the goose means our money, while the golden egg is the money made by our money, which means the interest.\nThe story revealed the most usual scenario in our daily life: We save money and we gain interest.\nAnd this is the topic I would like to share: Saving money.\nWhy should we save money? (Ask audiences)\nAbout this, my point is: Saving is for making. By saving money, the interest we get could even cover our daily cost, which sounds too good to be true and seems to decades of years, or does it?\nThe magic key is the compound interest. In one word, compound interest means that the interest can also make interest. There is a principle named “Rule of 72”, let’s do the math about it. Suppose I have 100 yuan, and the annual interest rate is 8%, then we use 72 divide 8 and get 9, it means I will have 200 yuan after 9 years, the money becomes double. Under the effect of compound interest, the assets will grow in a much faster speed than we can imagine.\nNow we know why we should save money, but do you know how to save money? In the past, after I got salary, I just left it in the bank account, and used it whenever I would like to buy something. You know I am a computer fans, thus I often upgraded my computer by buying some hardware, such as memory, hard drive and monitor. And in the end of year, I always found I didn’t have much money saved, not even think about the interest. Where did my money go? Actually, My goose was killed by the wrong method of saving money. Is there existing a better way of saving money? Let’s think about the following solution.\nI separate my income into three parts:\n\nThe first part is for daily life, such as food and traffic.\nThe second part is for my dreams, such as new phone or traveling. Once the account becomes ready, I will use it to achieve one of my dream.\nThe last part is for making interest, and that is my goose account. I will never take out the money from my goose account. As the goose grows up, the interest made by it will increase as well.\n\nBy following this approach, my daily life is covered well, and my dream will come true one by one. The most important thing is that I have a goose that will lay golden eggs for me all the time, and I will never kill it.\nI believe the financial intelligence will also be the crucial ability in 21 century. As there are too much things we want, if the desire is not handled properly, we may get trapped in financial problem.\nIt’s a good way to start leaning financial knowledge by saving money. Raise a goose of ourselves and watch it growing up, the interest will be the power we move on. And in the journey, the dreams in the list will also come true, with a healthy finance status and a better life.\n","categories":["Wealth"],"tags":["toastmaster","speech"]},{"title":"The Person Upholding My Mind","url":"/2022/01/12/the-person-uphold-my-mind.html","content":"\nPathways: Dynamic Leadership\nLevel 2-3: Introduction to Toastmasters Mentoring\n\n\n\n\n\nWhy do you join Toastmaster? Maybe you have heard of this question for many times. But here’s another question: Why do you stay in the club? Maybe you want to make friends, or learn new speak skills, for me, I may have a kind different answer.\nI still remember the first time when I joined the meeting. I had totally no idea about what you guys were doing. Suddenly someone asked me: Ryan, please introduce yourself. I had to say, this is the first time in my life I delivered a self introduction in English. Even though that’s a online meeting, I was just too nerverous to speak, countless Ahs just slid out of my mouth. But what amazed me is that no one laughed at me. This is the moment I decided to join. After I joined the club, Jun Ge contacted me soon and said: Hey Ryan, you can choose a person in club as your mentor.\nEmm… But what is mentor? I asked. Well, it’s just an experienced club member, who can help you if you need help. Oh, I knew it, just like a new staff in company, someone would help him in work. But then another question came to my mind, who should I choose? At that moment, I totally didn’t understand what is toastmaster, table topic master or evalutor. Suddenly, a word arose in my mind: President, Emm… yes, as a president, she must be the most experienced person in club. And her name is… Well, I forgot it, I browsed the agenda, then, Sherry became my mentor. Even though we haven’t talked with each other, it seems I have already gained a lot confidence because I believe someone good will help me.\nMy first role play is Ah-counter, when I was worrying how to do that, Sherry contacted me and gave me some links about Ah-counter, it’s just too good to be true, then I started to exploring those documents and prepared my role. After the meeting, she contacted me again and sent me 4 sections of wechat voice to congratulate my performance, it’s so encourage and sincere, which made it the moment I’d like to stay.\nWell you can see, today’s topic is mentor. In toastmasters, we all have mentors. Someone regard mentors as a coach, actually, it’s not exactly the same. Compared to teaching stuff hand by hand, I think there is a much magical capability of a mentor, and that’s the title of my speech: Upholding your mind. Think about it, when we are in trouble, if someone just gives us a task list, like step1, step2, step3… Well, that’s good. But if someone helps us analyze the problem, leads our mind and let us figure out the solution by ourselves, that woud be fantantic. And if there’s any encourage after we finish the task, like “good job Ryan”, I would call it the “perfect” experience.\nIf friendly environment is the key point of attracting new member in toastmaster, then mentor must be an important key of keeping old guys. Maybe after the meeting, you can contact with your mentor for your problem as he will always be the guy who can upholds your mind.\n","categories":["Life"],"tags":["Toastmaster","Speech"]},{"title":"Toastmaster常规会议(2021-05-07)","url":"/2021/05/06/toastmaster-regular-meeting-aatmc-20210507.html","content":"\nI am toastmaster and table topic master.\n\n\n\nToastmasterDear toastmasters, I’m Ryan, toastmaster of today’s meeting. After 5 days holiday we get together again, you may be tired or still be excited about your journey, we will talk about that later, but don’t forget an important thing, it’s workday on Saturday.\nBefore we start the meeting, please keep your mobile phone in silent mode and there are 4 forbidden topics we should not talk about, they are religion, race, politics and sex.\nNext please let me introduce the treasure part of our club: Evalution team. First is our timer Sherry, next is Grammarian Christina, the last is Ah-counter Lisa.\nToday our theme is “Journey on Internal Labour Day”. It’s the holiday for workers, you and me. \nFirst I would like to know how many of you people went outside of home and visited somewhere, please raise your hand.\nFor me, I have gone through 27 Labour Days, but this one is special, because for the first time I decided to went out of home to have a trip, though it’s a short trip. Do you know what changed my mind? Of course my girlfriend.\nNow let’s step into Table topic section.\nAbout one month before the holiday, she asked me: I want to go to Mount Tai on holiday, you, make a plan. In less than 0.01 seconds, I have imagined a picture, we are pushed and squeezed in the flow of people, the hotel is pretty expensive and we can not even rent a clothes on the top of Mount Tai, shaking in the cold dark night. So I decided to respond her: OK, no problem.\nThen I started making the plan, I searched other’s strategy on the internet, figured out when to buy train tickets, where to order the hotel, and the path we would take to climb the mountain. Final, I had everything done except the train ticket, and this is the most crazy part. I pressed the order button by counting the seconds, but I didn’t even see 1 tickets. I could only buy the candidate ticket. Well, we waited for it until 28, April, then we gave up.\nThen I proposed staying at Beijing, I quickly chose 3 places, Luohong Photography Exhibition, CCTV Tower and Hongluo Temple. And we went to study at last two days. It’s tired but fun, we enjoyed the amazing photo, the delicious food and the beautiful scenery.\nTable topic masterTopic: Journey on International Labour day\nFor the people who took the journey:\n\nThe most impressive thing in your journey?\nDo you feel satisfied with your journey and why?\nWhat do you think about the person who just stayed at home in such a long holiday?\n\nFor the people who didn’t take the journey:\n\nIf there any reason that stops you from travelling?\nIf you can do time travelling and go back to the start of holiday, will you decide to go somewhere?\nWhat do you think about the person who go travelling despite the crowded people and expensive hotel?\n\nCommon problem:\n\nTravelling alone or travelling with someone, which one do you prefer?\nThough we have continuous 5 days holiday, but actually 2 of them are exchanged from weekends, do you like this approach?\n\n\n\n\n\n\n\n\n\n\n\n","categories":["Toastmaster"],"tags":["toastmaster"]},{"title":"Toastmaster Regular Meeting","url":"/2021/07/03/toastmaster-regular-meeting-aatmc-20210702.html","content":"\nDate: 2021-07-02 12:00 - 13:30\nSite: Novo Nordisk, Wangjing, Beijing\nRole: Table Topic Evaluator\n\n\n\n本以为又是一次没有多少人的普通会议，没想到来了这么多新老会员，连guest都有三位。\nSherry，Jane，Alex不远万里打车从Sony赶到NN分部（bushi），Jun哥也Order了一个大会议室，现场配有完善的远程连线设备，Nan哥与guest小佛在线参加。\n\n\n会议的主题是“Plastic Surrgery”，整容。似乎在场的女生都有很多故事可以分享。为什么要整容，如何看待整容，大家各抒己见。Jane觉得“We can use but not overuse it”，Nicole则相信“It can change destiny”，更多的人则认为“We should pay more attention to our inner building”。不过确实有很多人，通过整容获得了更多自信。\n由于只有一个Speaker，Table Topic延长了10分钟，给作为Evalutor的我造成了很大挑战。不过更大的压力似乎也促使自己提高注意力，在记录的同时还能听清Speaker所讲的内容。结果最后响铃了也没有report完（还差一个guest）。\n\n\n接下来的Prepared Speech，Nicole表现的非常出色，个人觉得俱乐部中的女生的英语水平比男生高了不止一倍。她绘声绘色地通过两个故事描述为什么要重新回到Toastermasters，整个演讲错落有致，节奏恰到好处，最后用5、2、1三个数字点题，同时表达了对俱乐部的热爱，可谓是点睛之笔。\n\n\nRoxanne的到场也是一个小惊喜，作为俱乐部中最年轻的成员，英语水平一流，作为本次会议的General Evalutor，她详尽地点评了本场会议，没有停顿，没有重复，干货满满。\n她给我的建议则是：作为TTE，应该更关注Speaker的performance，logical，而不是content。\n\n\n表情管理大失败~~~\n\n\n本场会议无论是阵容还是内容都属于高水准，最后作为三月续费的会员，还送了一个主题菜篮。\n\n\n\n","categories":["Toastmaster"],"tags":["toastmaster"]},{"title":"Toastmaster Regular Meeting","url":"/2021/07/08/toastmaster-regular-meeting-aatmc-20210709.html","content":"\nDate: 2021-07-09 12:00 - 13:30\nSite: Novo Nordisk, Wangjing, Beijing\nRole: Table Topic Master\n\n\n\n这是一场小而精致的会议，所有的Function Role，Prepared Speech一应俱全，Alex作为Toastmaster，稳控全场，每一个转场都自然流畅，恰倒好处。当然还有Online的Jane。\n\n\n\n\n我们还为新会员Annie和Nicole举办了入会仪式，有趣的是，她们都是曾经的Toastmasters会员，都由于一些特殊原因离开，待生活稳定之后，又出于对提高自己的渴求，重新加入Toastmasters这个大家庭。看来Toastmasters真的是会让人上瘾。\n\n\n接下来就是我的主场，Table Topic环节，虽然我非常喜欢这个Role，但是由于准备的确实不充分（前一天晚上才想好开场词），整个开场磕磕绊绊。好在主题比较有趣，“Owe A Favor”，欠人情。大家也讨论的颇为尽兴。Christina的论点我很赞同：大多数时候，我们都不需要担心“Owe A Favor”，因为当你“Return it back”的时候，The relationship will be enhanced。\n\n\nChristina的演讲绝对是本次会议的亮点，她非常专业流畅地向我们职场人传授“How to manage your boos”。第一，准确理解老板的意图；第二，向老板申请资源；第三，向老板寻求反馈。这三步是依次递进的，最终能使你出色地完成工作。\n\n\n最后，我居然还获得了最佳Function Role地奖状，有点不好意思，下次我一定认真准备。\n\n\nTable Topic MasterGood afternoon, I’m Ryan, table topic master of today’s meeting. During this section, I will share my stories and thoughts related to today’s topic. And you will have the chance standing on the stage, sharing your mind. No further ado, let’s start.\nYou may have noticed, today our topic is Owe A Favor (欠人情). I believe it’s quite an usual phenomenon for Chinese because we used to put a high value on the relationship with other people.\nWe will owe a favor to someone under plenty of situation, the most common one could be that you obtain some help from people. And after that, you may start to think about how to return it back. By aSSffording for a meal, or giving a present, you will have your own way.\nBut what if you owe a favor to someone, and then he asks you for help as well, not at your convenience. giving the help may keep you far away from your important work, or if you just reject, things may get worse, you can imagine what he will think about: What an ungrateful person, I gave my help but he just reject my request, I will never help him again.\nThis is a tough condition and actually I just encountered it recently. Last month, my mother did a physical examination and the doctor recommended to take out something from her body by a small operation. But she has been not caught up with mobile phone. As we know, to register at hospital, you need mobile phone, to check your health status, you need mobile phone, and even when paying money, you are suggested to use mobile phone. She just can’t figure these things out and then asked a doctor neighbour for help. Finally she finished the operation and everything went well. I am pretty grateful and want to thank her face to face. But when she heard that I am a software engineer, she believed I must be good at computer and want me to make a ppt for her. I just couldn’t say no at that moment. And it takes me nearly two days to organize the data and design the diagram. After that, I will have to work over and over time to make up the progress of my job.\nI still feel grateful for her. But I also realize it’s hard to return the favor sometime. Have you ever owed favor to some one and how did you return it, now it’s you turn.\nI prepared 8 questions for you, you can choose the question or just share the story about what kind of favor you have ever owed and how did you return it back.\n\nIf some one owe a favor to you but never return it back, will you help him again?\nWill you return the favor by doing something you are not good at?\nDo you agree this statement: we can owe anything but not a favor?\nWill you feel pressure if you owe a favor to someone?\nWill you spend a lot of money just to avoid owing a favor?\n\n","categories":["Toastmaster"],"tags":["toastmaster"]},{"title":"Break the Lucky Silence","url":"/2021/02/23/toastmaster-speech-ice-breaker.html","content":"\nPathways: Dynamic Leadership\nLevel 1-1: Ice Breaker\n\n\n\nI was born in a snowy midnight in a small village of Heilongjiang Province. My mother gave me the name Rui which means lucky in Chinese. That word comes from the saying: A snowy year, A harvest year.\nAs my mother’s wish, I am truly a lucky boy, not means winning the lottery, to be more precise, I am a quiet boy. \nNot like my cousins, I never cried for any toy or candy. My mother told me to study, I just began studying. I didn’t understand why I should learn Chinese and math, actually I didn’t even heard of collage until junior high school. But what I did know is that my parents would feel happy if I said nothing and follow their instruction.\nI followed my parents to Zhejiang Province and went through the whole primary school period. The dialect in that place is quite hard to understand. Luckily both teachers and students spoke mandarin in the class. In the school I was a kind of transparent person as I didn’t talk much. My favorite habit was reading books about computer and electronic, those books were put in the corner of the shelf at library, I really enjoyed the content in those books even though I couldn’t understand it.\nTalking less let me have more time to read and think, gradually I became a good listener. My friends preferred to share their happiness and sadness with me, of course, they wouldn’t expect much voice response. Also Being quiet prevented me from many troubles, such as fighting with other people.\nThings got change at middle high school after I came to Shandong Province with my family. The knowledge became harder and harder to learn, but I was not good at asking others for help. What’s worse, nobody had time talking with me, I could only solve the problem by myself, which would not turn to good result at that period. Eventually I went to an ordinary university at Yantai city to learn computer science.\nThe shortcoming of being not good at talking became even more obvious in collage. I saw many people make friends, make money, and even make girl friends by communicating with others. I had no idea how to make change because I got nervous and afraid while taking with strangers. At last I joined in a lab and made use of my entire spare time to study. Yes I got a great performance on my subject, but in my deep heart, I knew I didn’t make any progress at some aspect.\nAfter graduated, I came to Beijing with one of my collage classmates and rented a room together. I guess we are the most strange roommates in the world: At weekends, we laid on our beds, played mobile phone or computer, without saying a word among whole day. Even at meal time, we ordered our food silently.\nThis weakness also started affecting my life, while interviewing for a job, I never had courage to argue for a better salary. While getting along with my girl friend, the failure of expressing my feelings made me lost her.\nBut just like someone had said: Love has a magic power. I never had made such a great determination to make change after breakup. The sadness forced myself to experience different kind groups of people. Some people got exercise at night, I tried it; Some people were discussing a news, I joined it. Someone joined a club, I am here.\nThe past is the past, now I am seeking for a rebirth. There is a saying: Silence is gold. but I hope I have the ability to express my thought, to influence people, to break the silence. I need to talk, I want to talk, I will be good at talk.\n","categories":["Toastmaster"],"tags":["toastmaster","speech"]},{"title":"将rootfs转换成Dcoker image","url":"/2020/08/23/transform-rootfs-to-docker-image.html","content":"\n我们在编译一些老版本的软件时，通常必须选择一个较老版本的host环境，这时候我们可能会选择vm，但是vm有几个比较明显的缺陷：一是资源的消耗较大，因为vm本质上是一个独立的系统，内核以及大量的服务在host运行了一份，在vm里还要再运行一份，消耗了大量内存；二是在host和vm之间共享存储不方便，虽然可以使用nfs，samba之类的方式，但是他们都是基于网络的，当编译时会有大量小文件读写，这时可能会遇到性能瓶颈。通过使用Docker，则可以较好的解决这类问题。\n\n\n\nDocker的优势Docker并不会重新运行一个新的内核，它只是通过内核的cgroup和namespace机制，对进程的权限和资源进行控制，从而实现一种轻量级的隔离。\n不同container中的进程虽然使用自己的lib以及binary，但是他们都是依靠host的kernel的系统调用来工作，因此，理论上会有更小的性能损失。\ncontainer中也不需要运行那些与编译无关的服务，因为编译过程只会用到rootfs中的lib和binary，这会节省大量的内存。\n还有很重要的一点，host的目录可以直接映射到container内，而不是通过网络，这样在container内部对于存储的读写性能几乎跟host是一样的。\n创建Docker image通常来说，有三种方法来创建Docker image：\n\nDockerfile\nDockerhub\nrootfs\n\n我们重点说Dockerhub和rootfs这两种方式，因为第一种我还不会。。。\nDocker hub获得Docker image最简单的方法就是直接从Docker hub上pull下来，例如我需要一个Ubuntu 18.04的Docker image，只需要执行\ndocker pull ubuntu:18.04\n\n这种方法有个局限，就是有些非常老的发行版并没有对应的官方Dcoker image，你可能会找到一些个人上传的，但如果你对于环境的安全性和稳定性有较高的要求，那就需要自己制作一个。\nrootfs如果你现在有一个运行的linux系统，可能是物理机，可能是虚拟机，你只是用它来做编译，那么你现在有一个更好的选择，那就是将它转换成一个Docker image。\nsudo tar --numeric-owner --exclude=/boot/* --exclude=/dev/* --exclude=/lost+found --exclude=/proc/* --exclude=/selinux --exclude=/sys/* --exclude=/tmp/* --exclude=/var/run/* --exclude=/var/log/* -cf ubuntu-5.04.tar /\n\n然后，我们只需要将ubuntu-5.04.tar导入Docker的本地Repository，即可启动这个container。\ndocker import ubuntu-5.04.tar ubuntu:5.04\n\ndocker run -it --rm ubuntu:5.04 bash","categories":["How-To"],"tags":["linux","docker","rootfs"]},{"title":"使用kcptun来加速shadowsocks","url":"/2019/03/30/use-kcptun-to-accelecate-proxy-md.html","content":"\n最近gfw升级之后，似乎带来一个全新的特性——TCP阻断。受影响的vps可以ping，但是所有使用tcp协议的应用都会失效，如ssh和shadowsocks，不过udp并未受到影响，个人分析可能tcp的长连接更容易识别。由于shadowsocks并不支持udp通讯，所以需要使用kcptun作为中间层。\n\n\n\n基本原理这是kcptun项目网站的原理图片。\n\n\n可以看到kcptun的客户端会在本地监听来自应用程序的流量，同时将数据发往服务端，kcptun服务端程序会将数据发往目标端口。客户端和服务端之间使用kcp协议，它基于udp。\n安装kcptun根据你的设备的处理器架构以及系统类型，从https://github.com/shadowsocks/kcptun/releases/latest下载相应的程序。\n服务端\n将下载好的服务端程序改名为kcp-server，并且复制到/usr/bin\n\n由于kcptun目前不支持直接生成守护进程，同时为了方便管理，我编写了基于systemd的服务脚本\ngit clone https://github.com/colorfulshark/kcptun-daemon.git\n\n安装服务脚本及配置文件\ncd kcptun-daemonchmod +x install.shsudo ./install.sh\n\n客户端Windows：https://github.com/shadowsocks/kcptun/releases/latest\n下载解压之后，将客户端程序复制到shadowsocks所在目录，并改名为kcp-client.exe\nAndroid：https://github.com/shadowsocks/kcptun-android/releases/latest\n直接安装即可\n配置kcptun这里并不探讨最佳配置，因为每个人的网络情况都不同，所以这里只介绍一个最小的可工作配置。\n服务端服务端的配置文件在/etc/kcptun/config.json\n\nlisten：kcptun的本地监听端口，用于与客户端通讯\ntarget：服务端接收到数据后转发的地址，这里就是你的shadowsocks所监听的IP地址和端口号\nkey：客户端与服务端认证的密钥\ncrypt：加密方式，由于shadowsocks本身已经加密，所以不需要设置非常复杂的加密方式\nmode：响应模式，更快的响应可能造成更高的丢包率\n\n注意，shadowsocks的监听端口与kcptun的target端口要一致。\n客户端Windows\n打开shadowsocks编辑服务器的界面\n将服务器端口改为kcptun所监听的端口，默认是29900\n在插件程序中，填入kcp-server.exe\n在插件选项中，填入mode=fast;key=&quot;it&#39;s a secrect&quot;\n确认即可\n\nAndroid\n安装kcptun后，在shadowsocks的服务器编辑界面的Plugin中选择kcptun\n在Configure中填入mode=fast;key=&quot;it&#39;s a secrect&quot;\n确认后重新连接服务器\n\n","categories":["How-To"],"tags":["linux","shadowsocks","kcptun"]},{"title":"在Debian下使用Gnome3","url":"/2018/12/31/using-gnome3-under-debian.html","content":"\n接触Gnome最早是在Ubuntu上，但是后来Ubuntu换成了Unity，不过最后又换回了Gnome，可谓一波三折。目前Gnome3无论是在性能、稳定性还是可玩性都已经有了长足的进步，所以打算将Debian上的Ubuntu-Mate切换为Gnome3。\n\n\n\n安装Gnome3sudo apt updatesudo apt install task-gnome-desktop\n\n在安装的过程中，会安装GDM3作为桌面管理器，如果你当前的桌面管理器不是它，会让你选择一个默认的桌面管理器。\n配置Gnome3完善插件环境Gnome3的一个很大的优势就是有一个活跃的社区，以及大量的桌面扩展支持。如果想要方便的安装扩展程序，需要一些额外的步骤。\n\n在Chrome安装“GNOME Shell integration”插件\n\n安装“chrome-gnome-shell”\nsudo apt install chrome-gnome-shell\n\n复制配置文件\nsudo mkdir -p /etc/opt/chromesudo cp -r /etc/chromium/* /etc/opt/chrome/\n\n以上步骤的目的是开启Chrome等浏览器中检测Gnome信息的功能，详见GNOME Shell integration for Chrome Installation Guide\n安装插件Gnome Extensions\nGnome3中一个争议很大的地方就是Gnome-Shell，它有点类似于MacOS的LaunchPad，但由于Linux下的GPU加速支持并不完善，因此其过多的动画反而成了减分项，为了更高效的打开程序，需要额外的插件支持。\n\nArc Menu\n这时一个类似于WIndows开始菜单的插件，里面对于系统中的软件进行了分类，也支持快速搜索\n\nDash to Dock\n这是一个类似于MacOS中的Dock栏的插件，通过简单的配置可以变得类似于Gnome2中的侧栏，可以快速打开或者切换应用\n\nActivities Configurator\n这是一个用来调节顶栏效果的插件，目的是让顶栏与侧栏在效果上一致，不会有割裂感。\n\nNight Light Slider\n这是一个用来调整护眼模式级别的插件，默认的护眼模式只能打开或关闭，不能调整色温。\n\n\n安装主题Gnome Look\n为了能够在网页上方便的安装主题，需要安装ocs-url。\n首先打开ocs-url的主页，然后在“Files”选项卡中下载deb安装包，下载后执行以下命令即可。\nsudo apt updatesudo dpkg -i ocs-url*sudo apt install -f\n\n最后，在Gnome Look上直接在响应主题点击Install即可。\n小技巧\n如何使dock栏的活跃图标在不同工作区内完全隔离？\ngsettings set org.gnome.shell.app-switcher current-workspace-only truegsettings set org.gnome.shell.extensions.dash-to-dock isolate-workspaces true\n\n中科大软件源生成器\nrepository file generator\n\n老版本Ubuntu的软件源失效如何解决？\nsudo sed -i &#x27;s/archive.ubuntu/old-releases.ubuntu/&#x27; /etc/apt/sources.list\n\n在Ubuntu Server安装Gnome3后无法使用Network Manager？\nvim /etc/netplannetwork:  version: 2  renderer: NetworkManagernetplan generatenetplan apply\n\n如何查看当前的系统版本？\nlsb_release -acat /etc/issuecat /etc/os-releasehostnamectl\n\n","categories":["How-To"],"tags":["debian","gnome3"]},{"title":"在Windows中使用Xserver","url":"/2021/01/16/using-xserver-in-windows.html","content":"\n随着公司全面转向微软云服务，尤其是outlook、calendar、onedrive和office这几个套件的加入，使用Windows电脑确实能带来更高效便捷的办公体验，作为Linux程序员最后的执着，我的Linux系统最终也活在了虚拟机里，变成了Windows的一个“服务”。然而有时候当我们必须使用Linux下的图形程序时该怎么办呢？\n\n\n\n实际上X Window System最初设计上就充分考虑了通过网络传输GUI这个特性，Xclient在一台Linux机器上运行，而其GUI可以通过网络在任何运行Xserver的机器上显示。基于这个原理，我们只需要在Windows中安装Xserver，即可“运行”Linux中的GUI程序。\n选择一款Xserver目前主流的有以下几款：\n\nXming：已经不再更新\nVcXsrv\nCygwin\nMobaXterm\nX410\n\n这里基于简单、易用、开源、免费的原则，选择了VcXsrv。只需要下载最新版本的exe安装即可。\n配置Windows端打开VcXsrv后，程序会要求进行配置，除了在Extra settings中选择Disable access control之外，其它保持默认即可，如图。\n\n\n\n\n\n\n配置Linux端通常情况下，Xserver都是配合X11 Forward来使用的，但是因为在我们的场景当中，Linux与Windows在同一个网络中，他们是能够直接互相访问的，所以可以使用一种更加简单的方式：\nexport DISPLAY=192.168.50.1:0.0\n\n192.168.50.1是Windows的IP地址，0.0是X server的Display编号，一般保持默认即可。\n这样设置完成之后，在Windows中使用任意终端连接到Linux，启动GUI程序后，都能在Windows上显示，而无需关注SSH的X11 Forward是否开启。\n使用X11 Forward如果你的Linux机器不能直接访问Windows，那么此时你必须使用SSH的X11 Forward，使用这个功能需要SSH server开启X11 Forward，并且SSH client在连接时也启用该功能，一般是添加-X参数。\n最重要的一点是，你需要在SSH client的环境中设置DISPLAY变量，这时候不同SSH client的设置方法并不相同，可以查阅相关文档。\n","categories":["How-To"],"tags":["windows","xserver"]},{"title":"部署网心云——利用闲置宽带赚钱","url":"/2022/08/30/make-money-with-wxedge.html","content":"\n我大约是从2020年开始接触PCDN，当时在我的小出租屋里面，通过Windows Hyper V部署了一个网心云，本就抱着试试看的态度，没想到收益竟意外的不错，从此就踏上了PCDN赚钱之路。在此也总结一下以往的经验。\n\n\n\n大前提PCDN的本质就是利用闲置的带宽以及硬盘资源，帮大公司缓存内容，从而加速其用户加载资源的速度。比如哔哩哔哩，当用户播放视频的时候，有可能并不从哔哩哔哩的服务器加载，而是从我们的PCDN设备直接加载，一方面节省了公司的带宽，另一方面，由于我们的设备可能距离用户更近，从而也提高了加载速度。\n若要玩转PCDN业务，我们需要有3个大前提：\n闲置的计算机可以是笔记本，台式机，甚至是树莓派，电视盒子。\n闲置的硬盘由于需要缓存内容，因此需要较大容量的硬盘。\n合适的宽带PCDN对于宽带的要求较高，一方面，上传速度要尽可能快，另一方面，要尽可能提供从外网访问内网的途径。\n对于第一点，由于国内的民用宽带大多为非对等宽带，上传速度非常受限，一般从10Mbps到100Mbps左右，可以使用speedtest进行测速，如果速度低于10Mbps，部署PCDN的意义就不大了。\n对于第二点，如果要做到外网设备访问内网设备，一般有3种途径来实现：\n\n公网IP：PCDN设备拨号后直接获取公网IP。\n映射公网IP：光猫、路由器等拨号，且PCDN设备接在开启了获取了公网IP且开启了UPnP的设备下。\n全锥型NAT：需要PCDN设备主动访问公网设备，由公网服务器记录我们的真实IP及端口，并将此信息同步给客户端，实现外网IP+端口到内网设备的访问，也就是我们常说的UDP打洞。\n\n如果我们的网络无法满足以上条件，也没有必要部署PCDN设备。\n部署模式网心云主要提供了3种模式：嵌入式设备、X86、docker。\n官网下载地址\n嵌入式设备网心云称为三方盒子，主要包括以下几种：\n\n斐讯N1盒子\nWJY盒子\n树莓派3B\n树莓派4B\n\n其安装方式根据设备不同而不同，但基本上都是直接将带分区的系统镜像写入Flash当中。\nX86基于X86平台的系统包括以下几种：\n\n基于Hyper-V的虚拟化镜像\n基于KVM的虚拟化镜像\n基于VMWare的虚拟化镜像\n基于群晖系统的虚拟化镜像（KVM）\nISO安装包（基于CentOS7）\n\nX86平台与我们平时接触的Windows和Linux系统相似，安装过程也极为类似。相对于嵌入式设备，X86平台的上限更高，适合大带宽的玩家，当然，其占用的系统资源也是最大的。普通的家用带宽很可能是回不了本的。\nDocker这是我目前最喜欢的一种部署模式，因为PCDN本质上就是一套用户态的应用程序，为了几个应用程序而安装整个系统，会造成大量资源浪费。而使用Docker就可以兼具功能和资源消耗。\n虽然这种模式非常适合小带宽玩家，但是官方似乎并没有特别宣传此种方式，甚至在官网都找不到特别详尽完整的教程，因此本文着重对此种方式进行描述。\n安装Docker我们可以直接按照Docker官方文档来安装：\n\nCentOS\nDebian\nFedora\nRHEL\nSLES\nUbuntu\n\n下载网心云docker镜像网心云Docker Hub地址\ndocker pull onething1/wxedge\n\n启动镜像这里分为两种情况：\n\n使用host网络。配置简单，但是只能部署一个container，且会影响host网络，延迟较大。\ndocker run -d \\           --name=wxedge \\           --restart=always \\           --privileged \\           --net=host  \\           --tmpfs /run \\           --tmpfs /tmp \\           -v 磁盘路径:/storage:rw \\           onething1/wxedge\n\n使用macvlan网络，配置复杂，但不会影响host网络，隔离性更好，延迟也低一些。\n# 创建macvlan，假设网关是10.0.0.1docker network create -d macvlan \\                      --subnet=10.0.0.0/24 \\                      --gateway=10.0.0.1 \\                      -o parent=enp3s0 \\                      macvlan0# 创建resolv.conf文件，否则会使用docker默认的DNS服务器，造成网络识别错误sudo bash -c &quot;echo nameserver 10.0.0.1 &gt; 磁盘路径/resolv.conf&quot;\n\ndocker run -d \\           --name=wxedge \\           --restart=always \\           --privileged \\           --net=macvlan0 \\           --ip=10.0.0.100  \\           --tmpfs /run \\           --tmpfs /tmp \\           -v 磁盘路径:/storage:rw \\           -v 磁盘路径/resolv.conf:/etc/resolv.conf \\           onething1/wxedge\n\n部署完成后，就可以通过http://10.0.0.100:18888访问了。\n使用此种方式还有一个隐形大坑，container会向overlayfs写入大量数据，造成根目录所在的分区快速减少，如果你的系统分区不大，建议将docker目录迁移到其他分区。\n# 停止服务sudo systemctl stop docker.servicesudo systemctl stop docker.socket# 修改systemd服务sudo vim /lib/systemd/system/docker.service&lt;&lt;&lt;ExecStart=/usr/bin/dockerd -g /new/path/docker -H fd://&gt;&gt;&gt;# 迁移docker目录sudo mkdir -p /new/path/dockersudo rsync -aqxP /var/lib/docker/ /new/path/docker# 重启dockersudo systemctl daemon-reloadsudo systemctl start docker\n\n参考Change Docker root directory &#x2F;var&#x2F;lib&#x2F;docker to another location\n网络类型、UPnP、DMZ的粗浅解释\n","categories":["Geek"],"tags":["docker","网心云","虚拟化"]},{"title":"All-in-One，但是小米笔记本！","url":"/2022/11/10/all-in-one-but-xiaomi-laptop.html","content":"\n一直想尝试一下All-in-One的方案，但是无奈手边并没有支持iommu的设备，正值双十一之际，就在我决定挑选硬件组装一台All-in-One PC时，我突然想到，自己的小米游戏本有没有可能支持iommu呢？一念之间，我已经做好了Debian live的U盘，此时，神奇的事情发生了。。。\n\n\n\n没错，你可能已经猜到了，在设置了内核cmdline后，IOMMU竟然启用了，不仅如此，PCI Passthrough所需的特性全部都启用了！最终我成功的在PVE上安装了Windows11并透传了独立显卡GTX1060m。此文将记录这一切是如何发生的。\n0x0 准备工作\n小米游戏本一代，处理器i5-7300hq，显卡GTX1060m，内存16GB\nU盘\nPVE镜像，Windows11镜像\nUSB键盘，USB鼠标\n\n0x1 安装PVE可以参考这篇文章在Proxmox VE中安装Openwrt作为软路由\n0x2 配置PCI Passthrough所需特性0x2.1 启用IOMMU打开grub配置文件，在内核cmdline中追加intel_iommu=on，并更新grub配置。\nvim /etc/default/grub&gt;&gt; GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;update-grub\n\n0x2.2 加载vfio驱动模块将vfio相关模块追加到/etc/modules。\nvim /etc/modules&gt;&gt;vfiovfio_iommu_type1vfio_pcivfio_virqfd\n\n0x2.3 检查配置是否生效\n查看IOMMU是否启动\ndmesg | grep -e DMAR -e IOMMU\n\n如果生效，将会有类似于DMAR: IOMMU enabled的log输出，如图\n\n\n查看IOMMU Interrupt Remapping是否启动\ndmesg | grep &#x27;remapping&#x27;\n\n如果生效，将会有类似于DMAR-IR: Enabled IRQ remapping in x2apic mode的log输出，如图\n\n\n查看IOMMU Isolation是否启动\nfind /sys/kernel/iommu_groups/ -type l\n\n检查IOMMU分组是否正确，这需要ACS (Access Control Services)的支持，如图\n\n\n0x3 安装Windows11虚拟机创建虚拟机的过程中有几个步骤需要注意：\n\nGuest OS选择Microsoft Windows\n\n\nMachine选择q35，BIOS选择OVMF(UEFI)，添加EFI Disk和TPM\n\n\nCPU Type选择host\n\n\n添加Windows的virtio驱动镜像，从这里下载\n\n\n当安装到选择磁盘这一步时，需要选择加载驱动程序，否则会找不到虚拟硬盘。后续的安装过程与标准流程没有区别。\n0x4 设置GPU Passthrough这是All-in-One方案中最重要的部分，毕竟代码要写，游戏也还是要玩的😁。\n这个步骤本身没什么难的，直接添加对应的PCI设备即可。\n\n\n但对于小米游戏本，这一步有两个大坑！\n\n因为它的独显的VBIOS不支持UEFI启动，所以如果虚拟机只有一个独显，WIndows系统是没有办法完成初始化的，表现为系统始终无法启动，因此我们需要一个虚拟显示设备辅助WIndows启动。\n\n\n好的，现在我们进入系统了，结果发现显卡驱动竟然安装不上，显示为找不到兼容的显示设备。经过几天的调查，发现设备管理器里面，显卡的Sub_Vendor ID和Sub_Product ID是全0，有可能是这个信息是存储在主板BIOS中，而不是VBIOS中，解决方法比较简单，在PVE的PCI Passthrough界面可以直接配置该信息。另外还需要选中All Functions和PCI-Express。\n\n\n设置KVM选项ignore_msrs，否则虚拟机在使用独显的过程中会崩溃\necho &quot;options kvm ignore_msrs=1 report_ignored_msrs=0&quot; &gt; /etc/modprobe.d/kvm.conf\n\n最后，附上完整的硬件配置\n\n\n0x5 软路由既然是All-in-One，OpenWRT，爱快，网心云这些肯定是少不了啦，不过这些都是常规的操作，不作详细介绍了。\n0x6 一周之后虽然整套All-in-One方案在功能上没有任何问题，但却拜倒在这颗i5-7300hq上，它太弱啦😂。\n直接表现就是在Windows中玩游戏一卡一卡，CPU占用直接100%😫。\n所以一周之后，我打算重新装回WIndows11，不过在之前，我写下此文，特此纪念自己的折腾之路😊。\n0x7 参考https://pve.proxmox.com/wiki/Pci_passthrough\nhttps://pve.proxmox.com/wiki/PCI(e)_Passthrough\nhttps://pve.proxmox.com/wiki/Windows_VirtIO_Drivers\nhttps://wiki.archlinux.org/title/PCI_passthrough_via_OVMF\nhttps://lantian.pub/article/modify-computer/laptop-muxed-nvidia-passthrough.lantian/\nhttps://lantian.pub/article/modify-computer/laptop-intel-nvidia-optimus-passthrough.lantian/\nhttps://post.smzdm.com/p/avx8pn3n/\nhttps://xylog.cn/2020/03/03/proxmox-vga-nvidia.html\nhttps://iamroot.cn/pvean-zhuang-win/\nhttps://www.syfly007.com/post/CS/linux/pve%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A.html\n","categories":["Geek"],"tags":["虚拟化","软路由"]},{"title":"使用acme申请https证书","url":"/2023/01/08/issue-https-cert-with-acme.html","content":"\n随着互联网的飞速发展，http这种明文传输协议已经越来越无法满足建站的需求，因此当今绝大多数网站都已经切换到了https。虽然https协议使用TLS加密极大地提高了传输安全性，但也带来了更大的部署难度，首当其冲的就是TLS证书申请，本文将介绍如何使用acme免费申请一个供个人使用的证书。\n\n\n\n准备工作虽然说是免费申请，但我们还是需要一些前置条件，其中最重要的就是\n\n一个域名。\n一个公网IP（v4或者v6都可以）。\n\n此外，还需要一个Linux环境来执行acme程序。\n安装acme证书申请的原理就是向一些证书发行组织，如letsencrypt、zerossl等，发送域名和服务器等信息，如果信息校验成功，这些组织就会给我们颁发TLS证书。\n由于与证书颁发服务器之间的通信协议较为繁琐，我们需要使用程序来完成这一系列操作，而acme就是用来完成这项工作的脚本程序。\n根据使用系统环境的不同，acme的安装方式也不尽相同。\n标准发行版如Ubuntu、Debian、CentOS等。\n在线安装\ncurl https://get.acme.sh | sh -s email=my@example.comwget -O -  https://get.acme.sh | sh -s email=my@example.com\n\n离线安装\ngit clone https://github.com/acmesh-official/acme.sh.gitcd ./acme.sh./acme.sh --install -m my@example.com\n\n申请的证书保存在~/.acme.sh/$domain中。\nOpenWRT安装以下包\nluci-app-acmeacmeacme-deployacme-dnsapiacme-notify\n\n申请的证书保存在/etc/acme/$domain中。\n证书申请根据网站部署方式的不同，使用acme申请证书的方式也不相同。\n使用DNS API申请证书要使用DNS API，通常都需要获取一个API Key。acme要求我们在使用DNS API之前设置相关环境变量。\n设置环境变量Cloudflare打开https://dash.cloudflare.com/profile/api-tokens，查看Global API Key，并设置以下环境变量。\nexport CF_Key=&quot;&quot;export CF_Email=&quot;&quot;export DNS_API=&#x27;dns_cf&#x27;\n\nDynv6打开https://dynv6.com/keys/token/new，创建一个新的HTTP Token。\n创建本地ssh公私钥，并将公钥~/.ssh/id_ed25519.pub上传到https://dynv6.com/keys中的SSH Public Keys。\nssh-keygen -t ed25519\n\n设置环境变量\nexport KEY=&quot;~/.ssh/id_ed25519.pub&quot;export DYNV6_TOKEN=&quot;&quot;export DNS_API=&#x27;dns_dynv6&#x27;\n\n申请证书标准发行版执行以下脚本之前，相关的环境变量必须已经设置好。\n域名可以填入多个，用空格分隔，这样多个域名可以共享同一个证书。\n#!/bin/bash# Related environment variables must have been exported before# the first is the main domaindomain_list=&#x27;example.org sub.example.org *.sub.example.org&#x27;for domain in $domain_listdo        domain_opt=&quot;$domain_opt -d $domain&quot;done~/.acme.sh/acme.sh --issue --dns $DNS_API $domain_opt --server letsencrypt\n\nOpenWRT打开服务 &gt; ACME证书。\n在域名这一项里面添加所需的域名，在DNS API这一项里面填入环境变量$DNS_API的值，最后分别将其它环境变量填入DNS API 凭证中。\n\n\n证书使用为了确保证书的最佳兼容性，证书文件使用fullchain.cer，而密钥文件使用$domain.key\n参考动态域名商Dynv6之acme使用dnsapi申请证书\n","categories":["How-To"],"tags":["acme","https","证书"]},{"title":"使用Yuzu游玩Switch游戏","url":"/2023/01/27/play-ns-games-on-yuzu.html","content":"\n众所周知，任天堂的游戏极具趣味性，但硬件机能却非常差，分辨率低不说，在有些游戏中连30帧的帧率都无法保障，并且据说2024年将发布下一代主机，现在购买Switch很可能49年入国军。对于那些只想玩几个特定的单机游戏的人来说，使用模拟器也是一个可行的方案。本文将完整介绍如何在Windows PC上畅玩Switch游戏。\n\n\n\n准备工作由于模拟器通常具有较高的性能损耗，所以首先我们要有一台性能强劲的电脑，这里给出一个硬件需求：\n\nCPU：至少4核心，且单核性能在英特尔8代i5及以上\n内存：8GiB以上\n显卡：GTX1050及以上，显存至少4GiB\n\n另外，Switch游戏全部都是针对手柄做适配，所以使用键鼠游玩会非常难以适应，大大降低游戏乐趣，为了保证最佳游戏体验，建议购买一对Joycons手柄，目前Yuzu已经几乎完美适配该手柄，无需使用第三方软件即可实现HD震动和体感。\n开始安装Yuzu本身并不是完整的Switch模拟器，它需要Switch的固件以及密钥，而由于法律原因，这两部分是不能与Yuzu一起发行的，所以完整的安装过程包括：\n安装Yuzu安装密钥安装固件从https://yuzu-emu.org/downloads/下载并安装Yuzu。\n每次运行Yuzu的时候，它都会检查是否有更新，建议始终使用最新版。从http://www.mediafire.com/file/ldsbcskbt0z10kv/prod.keys/file下载prod.keys。\n启动Yuzu，选择文件-&gt;打开yuzu文件夹，将prod.keys放入文件夹中的keys目录。\n从https://darthsternie.net/switch-firmwares/下载固件。\n启动Yuzu，选择文件-&gt;打开yuzu文件夹，将固件解压到文件夹中的nand\\system\\Contents\\registered目录。\n\n\n完成所有步骤后，重启Yuzu。\n安装游戏Yuzu支持Switch上的NSP和XCI格式的游戏，而游戏本身又分为本体、更新和DLC。\n设置游戏目录下载游戏安装游戏启动Yuzu，点击主页的添加游戏目录，选择一个目录来存储游戏。\n可以下载Switch游戏的网站有很多，这里主要推荐以下4个：\n\nhttps://nxbrew.com/\nhttps://nsw2u.xyz/\nhttps://nswgame.com/category/switch/\nhttps://www.ziperto.com/nintendo-switch-nsp/\n将下载的游戏本体直接放入第一步设置的游戏目录即可。\n对于游戏更新和DLC，可以选择文件-&gt;安装文件到NAND，并选择对应的文件安装即可。\n\n\n设置手柄虽然Yuzu已经内置了Joycons驱动，但由于Joycons是通过蓝牙连接到电脑，为了避免各种各样的兼容性问题，推荐使用USB蓝牙适配器，并且最好是蓝牙4.0协议。\n蓝牙连接单人模式多人模式长按Joycons的蓝牙配对键，直到4个流水灯闪烁，使用电脑搜索蓝牙设备，并依次连接两个手柄。\n打开模拟-&gt;设置-&gt;控制，连接控制器选择双Joycons手柄，输入设备选择Dual Joycon 1，此时摇动摇杆或者按动按键可以看到相应的动画。\n打开模拟-&gt;设置-&gt;控制。\n玩家 1的连接控制器选择右Joycons手柄，输入设备选择Right Joycon 1，此时摇动摇杆或者按动按键可以看到相应的动画。\n玩家 2的连接控制器选择左Joycons手柄，输入设备选择Left Joycon 1，此时摇动摇杆或者按动按键可以看到相应的动画。\n\n\n\n\n开始游戏最后，双击游戏即可开始畅玩。\n\n\n参考Complete guide for maximum performance on Yuzu + Download links for Keys, Firmware, Switch Games and Shaders\nHow to setup your input software to provide motion sensor data\n关于蓝牙适配器连接原装joycon\n","categories":["Games"],"tags":["switch","yuzu"]},{"title":"使用QEMU GDB调试Linux内核","url":"/2023/01/28/debug-kernel-with-qemu-gdb.html","content":"\n调试Linux内核从来都不是一件容易事。如果在开发过程中发现内核无法启动，甚至连日志输出都没有，问题就会变得很棘手。如果是开发板，可能还可以借助JTAG，但如果没有JTAG，要如何进行调试呢？本文给出另外一种可能：使用QEMU来进行内核调试。\n\n\n\n准备工作要使用QEMU GDB调试Linux内核，首先我们需要让内核能够在QEMU中启动。对于X86架构，这通常不困难，但是对于ARM架构，尤其是ARM32架构，可能需要借助uboot才能启动内核，具体可以参考在QEMU中启动U-Boot和内核。\n其次我们还需要GDB运行环境，可以使用GDB命令，也可以使用gdbgui这样的图形化工具。\n最后，我们还需要让内核保留调试信息，可以在menuconfig做如下配置\nSymbol: DEBUG_KERNEL [=y]Type  : boolDefined at lib/Kconfig.debug:211  Prompt: Kernel debugging  Location:    -&gt; Kernel hacking      -&gt; Kernel debugging (DEBUG_KERNEL [=y])\n\nSymbol: DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT [=y]Type  : boolDefined at lib/Kconfig.debug:258  Prompt: Rely on the toolchain&#x27;s implicit default DWARF version  Depends on: &lt;choice&gt; &amp;&amp; (!CC_IS_CLANG [=n] || AS_IS_LLVM [=n] || CLANG_VERSION [=0]&lt;140000 || AS_IS_GNU [=y] &amp;&amp; \\AS_VERSION [=23502]&gt;=23502 &amp;&amp; AS_HAS_NON_CONST_LEB128 [=y])  Location:   -&gt; Kernel hacking     -&gt; Compile-time checks and compiler options       -&gt; Debug information (&lt;choice&gt; [=y])         -&gt; Rely on the toolchain&#x27;s implicit default DWARF version (DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT [=y])\n\n启动GDB Server假设我们基于X86架构调试，那么编译出的内核镜像通常是bzImage，我们可以尝试使用如下命令启动内核，因为并没有指定根文件系统，所以内核会在挂载root目录时panic。\nqemu-system-x86_64 -nographic -kernel arch/x86_64/boot/bzImage -append &#x27;console=ttyS0&#x27;\n\n要启动QEMU内置的GDB Server，我们需要使用2个额外的参数\n\n-s: Do not start CPU at startup\n-S: Open a gdbserver on TCP port 1234\n\n第一个参数的目的是让我们能够在CPU启动之前连接GDB Server，而第二个参数则是启动GDB Server。\n此外，我们还需要添加一个内核cmdline参数nokaslr来关闭内核地址随机化，否则我们打断点的地址与实际执行的地址将不一致，从而导致断点失效。\n于是，最终的命令为\nqemu-system-x86_64 -nographic -s -S -kernel arch/x86_64/boot/bzImage -append &#x27;console=ttyS0 nokaslr&#x27;\n\n执行命令后，我们会发现QEMU没有任何输出，因为此时虚拟机的CPU还未启动，接下来，我们将在GDB中完成后续工作。\nGDB调试在内核源码根目录执行gdb命令进入GDB shell。\n首先连接到QEMU的GDB Server，默认端口是1234\n(gdb) file vmlinux(gdb) add-auto-load-safe-path $(pwd)(gdb) target remote localhost:1234\n\n然后我们设置断点，以start_kernel函数为例\n(gdb) break start_kernel\n\n最后，我们通过GDB控制QEMU继续执行\n(gdb) continue\n\n我们将看到QEMU继续执行，并在start_kernel处停下来，等待GDB的命令。之后的调试方式与常规用户态的调试大同小异。\n参考How to debug the Linux kernel with GDB and QEMU?\n","categories":["Kernel"],"tags":["qemu","kernel","debug"]},{"title":"在Qemu中虚拟化固态硬盘","url":"/2023/01/30/emulate-ssd-in-qemu.html","content":"\nQemu虚拟机中的磁盘通常都是以文件形式存储在宿主机上，如qcow2，理论上虚拟磁盘的类型并不重要。但有时，虚拟机中的程序会主动检测当前使用的磁盘类型，如trim，于是就需要我们明确指定虚拟磁盘是机械硬盘，还是固态硬盘，本文将介绍如何在Qemu中完成配置。\n\n\n\n目前主流的固态硬盘有两种，使用PCIe总线的NVMe固态，和使用SATA/SCSI总线的固态，下面将分别针对不同场景对两种模拟固态的配置方法进行介绍。\n模拟NVMe固态在Qemu中，NVMe是一个独立的设备类型，所以只需要将硬盘的设备类型指定为NVMe即可。\nQemu command lineLibvirt XMLvirt-install-drive file=/path/to/nvme1.img,if=none,id=NVME1 \\-device nvme,drive=NVME1,serial=nvme-1&lt;qemu:commandline&gt;  &lt;qemu:arg value=&#x27;-drive&#x27;/&gt;  &lt;qemu:arg value=&#x27;file=/path/to/nvme1.img,format=raw,if=none,id=NVME1&#x27;/&gt;  &lt;qemu:arg value=&#x27;-device&#x27;/&gt;  &lt;qemu:arg value=&#x27;nvme,drive=NVME1,serial=nvme-1&#x27;/&gt;&lt;/qemu:commandline&gt;--qemu-commandline=&#x27;-drive file=/path/to/nvme1.img,format=raw,if=none,id=NVME1&#x27;--qemu-commandline=&#x27;-device nvme,drive=NVME1,serial=nvme-1&#x27;\n\n模拟SATA固态由于SATA&#x2F;SCSI总线既可以连接机械硬盘，也可以连接固态硬盘，所以我们需要设置总线上设备的属性rotation speed来进行区分。当设置其为1时，表示该设备为固态硬盘。\n要设置SATA&#x2F;SCSI总线上的设备属性，我们必须要找到其ID，比如sata0-0-0或者scsi0-0-0-0，可以使用以下命令查询。\nvirsh qemu-monitor-command --hmp 1 &quot;info qtree&quot;\n\ndev: scsi-hd, id &quot;scsi0-0-0-0&quot;  drive = &quot;drive-scsi0-0-0-0&quot;  logical_block_size = 512 (0x200)  physical_block_size = 512 (0x200)  min_io_size = 0 (0x0)  opt_io_size = 0 (0x0)  discard_granularity = 4096 (0x1000)  write-cache = &quot;on&quot;  share-rw = false  rerror = &quot;auto&quot;  werror = &quot;auto&quot;  ver = &quot;2.5+&quot;  serial = &quot;&quot;  vendor = &quot;QEMU&quot;  product = &quot;QEMU HARDDISK&quot;  device_id = &quot;drive-scsi0-0-0-0&quot;  removable = false  dpofua = false  wwn = 0 (0x0)  port_wwn = 0 (0x0)  port_index = 0 (0x0)  max_unmap_size = 1073741824 (0x40000000)  max_io_size = 2147483647 (0x7fffffff)  rotation_rate = 1 (0x1)  scsi_version = 5 (0x5)  cyls = 16383 (0x3fff)  heads = 16 (0x10)  secs = 63 (0x3f)  channel = 0 (0x0)  scsi-id = 0 (0x0)  lun = 0 (0x0)\n\n得到ID之后就可以进行设置了。\nQemu command lineLibvirt XMLvirt-install-set device.scsi0-0-0-0.rotation_rate=1&lt;qemu:commandline&gt;  &lt;qemu:arg value=&#x27;-set&#x27;/&gt;  &lt;qemu:arg value=&#x27;device.scsi0-0-0-0.rotation_rate=1&#x27;/&gt;&lt;/qemu:commandline&gt;--qemu-commandline=&#x27;-set device.scsi0-0-0-0.rotation_rate=1&#x27;\n\n参考KVM guests with emulated SSD and NVMe drivesQEMU command-line passthrough\n","categories":["How-To","Qemu"],"tags":["qemu","ssd"]},{"title":"使用Syncthing和FileRun搭建私人云盘","url":"/2023/03/07/setup-personal-cloud-drive-with-syncthing-and-filerun.html","content":"\n入手NAS之后，我一直使用NextCloud + IPv6远程管理其中的文件，以及同步备份手机和电脑的数据。由于在北京租房，所以NAS被放在了父母家，这就导致当想要下载一些大文件时，即使是直连，也需要等很久。因而打算设计一个新的架构，用来解决这个问题。\n\n\n\n问题和诉求目前的问题主要有3个：\n\n使用IPv6 + DDNS远程访问NAS并不稳定，有时遇到IP变换，或者所在网络不支持IPv6，数据便无法访问。\n虽然NAS上使用ZFS组了软RAID1，但毕竟两块硬盘是在同一台机器上，一旦机器损坏，可能丢失所有数据。\n有时，我会通过终端直接下载或复制一些文件到NAS中，但NextCloud并不能立即识别那些文件，必须手动更新数据库。\n\n基于以上问题，我明确了下面3个诉求：\n\n我需要在本地也保留一份完整的数据。\n文件管理程序必须能够自动识别新文件。\n本地数据和NAS中的数据必须保持一致.\n\n新方案经过搜索，我发现有两款软件可以满足我的需求：\n\nFileRun：基于LAMP架构的Web文件管理器，可实时显示文件变化\nSyncthing：集群文件存储工具，可在多台机器上同步文件\n\n安装部署FileRun与NextCloud一样，FileRun也是一个基于LAMP架构的项目，因此安装部署的步骤相似。不同之处在于，它不需要重新扫描，就可以立即识别新文件，这大大提高了文件管理的灵活性。\n\n安装Apache、MySQL和PHP\nsudo apt updatesudo apt install apache2 mariadb-server php libapache2-mod-php php-mysql php-mbstring php-zip php-curl php-gd php-ldap php-xml php-imagick\n\n配置数据库，注意修改用户密码\nsudo mysqlCREATE DATABASE filerun;CREATE USER &#x27;filerun&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;YOUR-DB-PASSWORD&#x27;;GRANT ALL ON filerun.* TO &#x27;filerun&#x27;@&#x27;localhost&#x27;;FLUSH PRIVILEGES;exit\n\n配置PHP\n\n安装ionCube  wget https://downloads.ioncube.com/loader_downloads/ioncube_loaders_lin_x86-64.tar.gzsudo tar -xzf ioncube_loaders_lin_x86-64.tar.gz -C /usr/lib/phpsudo vim /etc/php/7.4/apache2/conf.d/00-ioncube.ini&lt;&lt;&lt;zend_extension = /usr/lib/php/ioncube/ioncube_loader_lin_7.4.so&gt;&gt;&gt;\n创建基础配置  sudo vim /etc/php/7.4/apache2/conf.d/filerun.ini&lt;&lt;&lt;expose_php              = Off  error_reporting         = E_ALL &amp; ~E_NOTICE  display_errors          = Off  display_startup_errors  = Off  log_errors              = On  ignore_repeated_errors  = Off  allow_url_fopen         = On  allow_url_include       = Off  variables_order         = &quot;GPCS&quot;  allow_webdav_methods    = On  memory_limit            = 128M  max_execution_time      = 300  output_buffering        = Off  output_handler          = &quot;&quot;  zlib.output_compression = Off  zlib.output_handler     = &quot;&quot;  safe_mode               = Off  register_globals        = Off  magic_quotes_gpc        = Off  upload_max_filesize     = 20M  post_max_size           = 20M  enable_dl               = Off  disable_functions       = &quot;&quot;  disable_classes         = &quot;&quot;  session.save_handler     = files  session.use_cookies      = 1  session.use_only_cookies = 1  session.auto_start       = 0  session.cookie_lifetime  = 0  session.cookie_httponly  = 1  date.timezone            = &quot;UTC&quot; &gt;&gt;&gt;sudo systemctl restart apache2\n\n\n配置Apache\n httphttpssudo vim /etc/apache2/sites-available/filerun.conf&lt;&lt;&lt;&lt;VirtualHost *:80&gt;        ServerAdmin webmaster@localhost        DocumentRoot /var/www/filerun        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined&lt;/VirtualHost&gt;&gt;&gt;&gt;sudo a2ensite filerun.confsudo systemctl restart apache2openssl req -newkey rsa:4096 -x509 -sha256 -days 365 -nodes -out filerun.crt -keyout filerun.keysudo mv filerun.crt /etc/ssl/certs/sudo mv filerun.key /etc/ssl/private/sudo a2enmod rewrite headers env dir mime sslsudo vim /etc/apache2/sites-available/filerun.conf&lt;&lt;&lt;&lt;IfModule mod_ssl.c&gt;        &lt;VirtualHost _default_:443&gt;                ServerName nas.colorfulshark.net                &lt;IfModule mod_headers.c&gt;                        Header always set Strict-Transport-Security &quot;max-age=15552000; includeSubDomains&quot;                &lt;/IfModule&gt;                DocumentRoot /var/www/filerun                ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log                CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined                SSLEngine on                SSLCertificateFile      /etc/ssl/certs/filerun.crt                SSLCertificateKeyFile /etc/ssl/private/filerun.key                &lt;FilesMatch &quot;\\.(cgi|shtml|phtml|php)$&quot;&gt;                                SSLOptions +StdEnvVars                &lt;/FilesMatch&gt;                &lt;Directory /usr/lib/cgi-bin&gt;                                SSLOptions +StdEnvVars                &lt;/Directory&gt;        &lt;/VirtualHost&gt;&lt;/IfModule&gt;&gt;&gt;&gt;sudo a2ensite filerun.confsudo systemctl restart apache2\n\n安装FileRun\n cd /var/wwwsudo mkdir filerun &amp;&amp; cd filerunsudo wget -O FileRun.zip https://filerun.com/download-latest-ubuntu-20sudo unzip FileRun.zipsudo chown -R www-data:www-data /var/www/filerun\n\n配置FileRun\n在浏览器中打开http://IP（http）或者https://IP（https），即可打开FileRun的配置向导，在页面中完成配置即可。\n\n\nSyncthingSyncthing的功能非常简单：在两台机器之间同步目录。但同时，它又是目前我所知道的最强大的同步工具。\n当我们想要在两台机器上同步数据时，往往最麻烦的地方不是如何配置同步策略，减少冲突，而是如何让两台机器连通。如果是局域网，我们可能只需要手动设置IP；但到了广域网，想要连通两台机器通常是非常困难的，往往需要一台具备公网IP的中转服务器作为桥梁。而Syncthing则如魔法般，把上面所说的步骤全部抹除了，两台机器在弹指一挥间，就自动完成了连接，无论它们身处何方。\n那么Syncthing是如何做到的呢？这其实得益于它强大的网络探测功能。根据两台设备之间连接方式的不同，Syncthing会做如下处理：\n\n局域网：自动探测对方设备，IP互换，完成连接，此时不需要设备连接互联网。\n互联网：\n具备公网IP：只要任意一台机器具备且22000端口开放，两台机器将使用公网IP直连。\nNAT网络：尝试使用UDP进行打洞，实现内网穿透，任意一台机器穿透成功，即可直连。\n以上方案均失败：使用Relay桥接服务器，这些服务器通常是公用的，因此速度较慢。\n\n\n\n目前国内的运营商大多不再提供公网IPv4地址，取而代之的是公网IPv6地址。经过测试，使用IPv6并且开放22000端口后，是可以顺利连接的。\n即使没有IPv6，Syncthing也会尝试UDP打洞，经过测试，成功率还是非常高的，即使是公司的WiFi网络，也能成功实现公网直连。\n\n配置Syncthing源\nsudo curl -o /usr/share/keyrings/syncthing-archive-keyring.gpg https://syncthing.net/release-key.gpgecho &quot;deb [signed-by=/usr/share/keyrings/syncthing-archive-keyring.gpg] https://apt.syncthing.net/ syncthing stable&quot; | sudo tee /etc/apt/sources.list.d/syncthing.list\n\n安装Syncthing\nsudo apt updatesudo apt install syncthing\n\n配置Syncthing\n由于FileRun是使用www-data账户运行的，因此我们也使用该账户运行Synching，从而避免文件权限的问题。同时，将其监听IP改为0.0.0.0，这样就可以通过局域网IP访问。\nsudo mkdir /var/www/.configsudo chown www-data:www-data /var/www/.configsudo systemctl enable syncthing@www-datasudo systemctl start syncthing@www-datavim /var/www/.config/syncthing/config.xml&lt;&lt;&lt;&lt;address&gt;127.0.0.1:8384&lt;/address&gt; =&gt; &lt;address&gt;0.0.0.0:8384&lt;/address&gt;&gt;&gt;&gt;\n\n然后就可以通过http://IP:8384访问Syncthing的管理页面了。\n\n\n要用好Syncthing，需要深入理解它的同步逻辑。在Syncthing中，每一台机器对应一个Device ID，同步的最小单位是Folder，使用Folder ID标识，因此一个具体的Folder可以标定为[Device ID]:[Folder ID]。\nSyncthing会保证你的设备ID是独一无二的，要连接两台机器，需要各自添加对方的ID，只有一方添加ID是不会建立连接的，所以ID并不需要保密。\n若要在2台设备之间同步目录，首先要建立设备间的连接，然后在两台设备上各自创建共享目录，并共享给对方。\n创建共享目录时，可以参考以下建议，以达到比较好的效果：\n\n启用Trash Can File Versioning：这可以防止文件在一台机器上被误删除后，其它机器也跟着删除。自动清理时间可以设置为30天。\nIgnore Patterns设置为.*：这可以忽略隐藏文件，因为这些文件通常是临时文件。\nFull Rescan Interval设置为0：这在安卓手机上非常实用，可以节约电量，因为手机在切换网络时，Syncthing会重启，而这会强制重新扫描。\n启用Ignore Permissions：我们通常不太关心文件权限的变化，忽略它也可以降低同步频率。\n\n最终效果两台主同步设备拥有全部的文件，互为备份，而手机则选择性地与之同步，最终实现数据的异地防灾。\n\n\n参考FileRun Server Install Guides\nHow to install FileRun on Ubuntu 20\nHow To Install Linux, Apache, MySQL, PHP (LAMP) stack on Ubuntu 20.04\nAccessing via WebDAV\nhttps://apt.syncthing.net/\nSyncthing Getting Started\n","categories":["Geek","How-To"],"tags":["nas","syncthing","filerun"]},{"title":"在PVE中安装群晖DSM系统","url":"/2023/03/10/install-dsm-on-pve.html","content":"\n其实我一直对群晖的系统不太感冒，一方面它是闭源的，我无法得知它里面有多少未修复的漏洞以及后门；另一方面，即使硬件已经有了超高的溢价，群晖的套件也没有想象中那么好用，App总感觉就是半成品，系统与数据混在一起，这些因素决定了我注定不会是群晖的受众。但有钱能使鬼推磨，网心云发布了基于群晖的PCDN业务，并且看起来收益要优于Docker业务，于是，我也开始折腾起黑群晖了。\n\n\n\n创建虚拟机在PVE中创建一个标准的虚拟机，注意以下几点：\n\n在第二步OS中，选择Do not use any media。\n在第4步Disks中，删除所有硬盘。\n第5步CPU中，Type选择host。\n第6步Memory中，至少设置4GB内存。\n\n安装引导目前黑群晖主要是使用RedPill项目组开发的RPL(RedPill Loader)，放在以前，我们可能需要手动编译，还得设置正确的VID、PID、MAC等。但得益于ARPL(Automated Redpill Loader)项目，现在只要在menuconfig中简单设置几个选项，就可以得到专用的Loader，并且能够兼容最新的DSM系统。\nARPL本质上就是一个使用Ramfs的Linux系统，它里面配置了编译RPL所需的最小软件集。当我们启动ARPL的镜像后，就可以通过终端或者Web配置编译RPL，并且它会自动将RPL写入分区，并支持后续启动工作。\n因此，安装引导主要包括以下几个步骤：\n\n下载ARPL镜像并解压，例如\nwget https://github.com/fbelavenuto/arpl/releases/download/v1.1-beta2a/arpl-1.1-beta2a.img.zipunzip arpl-1.1-beta2a.img.zip\n\n将ARPL以USB存储设备的方式挂载到虚拟机\n假设你的虚拟机编号是200，在第一行添加如下内容，注意file=后面需要使用ARPL镜像的绝对路径。\n使用镜像文件使用LVM分区假设我们将解压出的arpl.img放在/root/arpl.img，那么需要做如下配置\nmv arpl.img /root/vim /etc/pve/qemu-server/200.conf&lt;&lt;&lt;args: -device &#x27;qemu-xhci,addr=0x18&#x27; -drive &#x27;id=synoboot,file=/root/arpl.img,if=none,format=raw&#x27; -device &#x27;usb-storage,id=synoboot,drive=synoboot,bootindex=1&#x27;&gt;&gt;&gt;假设我们要使用LVM分区，那么需要做如下配置\n# 创建一个新的LVM分区，假设你的VG是ssd，新的分区名为synoboot，新分区大小为1GiBlvcreate -L 1GB -n synoboot ssddd if=./arpl.img of=/dev/ssd/synobootvim /etc/pve/qemu-server/200.conf&lt;&lt;&lt;args: -device &#x27;qemu-xhci,addr=0x18&#x27; -drive &#x27;id=synoboot,file=/dev/ssd/synoboot,if=none,format=raw&#x27; -device &#x27;usb-storage,id=synoboot,drive=synoboot,bootindex=1&#x27;&gt;&gt;&gt;\n\n启动ARPL，配置相关选项，并启动系统\n1. 启动配置界面2. 选择机型3. 选择版本4. 编译5. 启动在终端输入menu.sh启动配置界面。\n进入Choose a model选项，选择所需机型，通常选择DS918+。\n\n\n直接选择最新版即可。\n选择Build，开始编译ARPL。\n选择Boot，启动引导程序。\n\n\n安装系统记录下终端上显示的IP，如192.168.0.2，接着在浏览器中输入\nhttp://192.168.0.2:5000\n即可进入DSM的安装界面。\n参考ARPL Github\n纳思小星产品介绍（网心云NAS版）\nNAS迅雷-群晖内测版下载地址和安装教程\n","categories":["Geek","How-To"],"tags":["pve","synology"]},{"title":"在群晖中挂载NFS文件系统","url":"/2024/01/21/mount-nfs-in-synology.html","content":"\n玩网心云的时候，在PVE中安装了一个黑群晖，但是并没有使用它管理任何数据，一方面盗版的东西可能不稳定，另一方面不想被某个生态捆绑。最重要的一点：我始终都是使用ZFS，而群晖并不支持ZFS。碰巧最近使用samba服务时遇到一些问题，因此打算研究一下能否把这个黑群晖利用起来。\n\n\n\n需求分析由于我所有的数据都是存储在PVE的ZFS中，因此我不能把硬盘直接透传给群晖，要想让群晖访问我现有的数据，主要有3个思路：\n\nVirtFS: 这是一种基于virtio的文件系统，可以将host中的目录映射为guest中的块设备，用于挂载。\nNFS: Linux上的网络文件系统，通过网络传输数据。\nSMB: Windows上用于网络共享的传输协议，通过网络传输数据。\n\n理论上VirtFS拥有最好的性能，但是群晖中并没有官方支持，需要加载第三方驱动，并且需要在命令行中配置，稳定性是个未知数。\nSMB在Linux上虽然已经有很好的支持，但配置相对繁琐，尤其是那套独立的用户管理。\n而NFS相对来说配置较为简单，在群晖系统中也有良好的支持，因此我最终选择它作为群晖和PVE之间的桥梁。\nNFS服务端配置NFS服务端主要有以下几个选项：\n\nrw: 允许读写操作，否则文件系统将变为只读。\nasync: 在写入完成之前就返回，可以提高性能，但是可能导致文件损坏。\nsync: 在写入完成之后才返回，可以保障写入按顺序执行，但会降低性能。\nno_subtree_check: 只检查被访问文件的权限，忽略子文件的权限检查。\nroot_squash: 将client的root用户和root组映射为server的匿名用户和匿名组，从而限制client的文件访问权限。\nno_root_squash: client的root用户和root组将映射为server的root用户和root组。\nall_squash: 将client所有的用户和组都映射为server的匿名映射和匿名组。这样client上不同用户的访问可以被映射为同一个用户。\nanonuid&#x2F;anongid: 设置匿名用户所对应的uid和gid。需要与root_squash或all_squash组合使用。\n\n为了不破坏ZFS中原有的文件owner信息，我需要使用all_squash配合anonuid&#x2F;anongid，将群晖中的用户映射为PVE中的www-data用户。因此配置为\n# /etc/exports/mnt  *(rw,sync,all_squash,anonuid=33,anongid=33)\n\n群晖配置创建一个新的共享文件夹由于我们将要挂载的文件系统不一定兼容群晖内置的权限模型，因此需要在群晖中创建一个原生的目录，作为包含挂载点容器，后续所有的操作和共享都基于此目录。\n控制面板-&gt;共享文件夹-&gt;新增-&gt;创建共享文件夹\n\n\n挂载NFSFile Station-&gt;工具-&gt;装载远程文件夹-&gt;NFS共享文件夹\n\n\n\n设置App权限在群晖中，需要为App配置目录的权限后，App才能访问。这里以Syncthing为例。\nFile Station-&gt;右键共享目录-&gt;属性-&gt;权限-&gt;新增\n将App所对应的用户添加进去，并授予读写权限。\n\n\n性能测试由于NFS的性能主要受限于网络性能，因此这里主要测试PVE和群晖间的网络吞吐，测试工具为iperf3，网卡驱动为virtio。\nserver: iperf3 -sclient: iperf3 -c &lt;SERVER_IP&gt;\n\n从结果上来看，TCP吞吐接近20 Gbits&#x2F;sec，已经远远超过大多数硬盘的读写性能。\n\n\n总结利用这套方案，我既可以享受群晖套件所带来的便利，也可以将数据管理权掌握在自己手中，无需担心黑群晖系统崩溃后导致的数据丢失问题。\n","categories":["Geek","How-To"],"tags":["pve","synology"]},{"title":"使用systemd运行hexo服务","url":"/2024/01/29/run-hexo-server-as-systemd-service.html","content":"\n通常hexo被用于创建静态站点，然后部署在GitHub等支持静态网站托管的平台。但hexo本身也支持启动一个简单的http server，用于在浏览器中实时显示编辑的内容。如果我们能让这个服务运行在后台，一方面无需每次手动拉起，另一方面可以当作一个小站点使用，并且支持实时更新。\n\n\n\n安装Node.js如果要让Node.js应用在开机后以root用户启动，我们需要把Node.js安装到根目录，而不是家目录。这里以Debian为例，其它系统参可以参考Installing Node.js via package manager。\ncurl -fsSL https://deb.nodesource.com/setup_current.x | sudo bash -sudo apt install -y nodejs\n\n安装hexosudo npm install -g hexo-cli\n\n创建systemd服务创建/lib/systemd/system/hexo.service文件，将/home/[yourdirectory]/blog替换成hexo的根目录：\n[Service]WorkingDirectory=/home/[yourdirectory]/blogExecStart=/bin/hexo server -p80Restart=alwaysStandardOutput=syslogStandardError=syslogSyslogIdentifier=hexoUser=rootGroup=rootEnvironment=NODE_ENV=production[Install]WantedBy=multi-user.target\n\n启动hexo服务sudo systemctl enable hexo.servicesudo systemctl start hexo.servicesudo systemctl status hexo.service\n\n参考A systemD unit file for Hexo\n","categories":["How-To"],"tags":["linux","hexo","systemd"]},{"title":"构建EDK2镜像并在QEMU启动","url":"/2023/08/29/build-and-boot-edk2-in-qemu.html","content":"\n从今天起，我将涉足一个新的领域：UEFI。目前UEFI已经逐渐从以X86为主的服务器PC领域，渗透到以ARM为主的终端领域。得益于其灵活的扩展性以及较低的开发门槛，以后越来越多的设备将使用它作为自身启动链的一个重要组成部分。由于UEFI只是一套标准，参照该标准有许多实现，其中最有名之一就是Intel主导开发的EDK2。因此我的学习之旅也会从它开始，今天主要介绍如何构建EDK2以及在QEMU上启动它。\n\n\n\n安装依赖我们将以Debian12作为例子，其他Linux发行版请自行修改。\nsudo apt install build-essential git python3 uuid-dev nasm acpica-tools cscope clangd\n\n下载源码git clone https://github.com/tianocore/edk2.gitcd edk2git submodule update --init\n\n构建EDK2EDK2支持多种平台和工具链，这里我们主要介绍QEMU平台上AARCH64和X86两个架构，并且使用CLANG和GCC两种工具链进行编译。\n构建EDK2工具集EDK2源码中包含了一系列工具，用于在构建过程中进行链接打包等工作，因此我们需要先将这些工具构建出来。\nexport EDK_TOOLS_PATH=$PWD/BaseToolssource edksetup.shmake -C BaseTools\n\nX86架构X86架构的QEMU固件所对应的Package是OvmfPkg/OvmfPkgX64.dsc。\n\n使用GCC工具链\n 根据需要安装GCC工具链，比如我们现在需要安装X86版本的GCC，并设置prefix：\n sudo apt install gccexport GCC5_AARCH64_PREFIX=\n\n 构建EDK2\n source edksetup.shbuild -a X64 -t GCC5 -p OvmfPkg/OvmfPkgX64.dsc -Y COMPILE_INFO -y BuildReport.log\n\n 编译出的固件在Build/OvmfX64/DEBUG_GCC5。\n\n使用CLANG工具链\n 由于clang原生支持交叉编译，因此可以直接安装：\n sudo apt install clang\n\n 构建EDK2\n source edksetup.shbuild -a X64 -t CLANGDWARF -p OvmfPkg/OvmfPkgX64.dsc -Y COMPILE_INFO -y BuildReport.log\n\n 编译出的固件在Build/OvmfX64/DEBUG_CLANGDWARF。\n\n\nAARCH64架构AARCH64架构的QEMU固件所对应的Package是ArmVirtPkg/ArmVirtQemu.dsc。\n\n使用GCC工具链\n 根据需要安装GCC工具链，比如我们现在需要安装AARCH64版本的GCC，并设置prefix：\n sudo apt install gcc-aarch64-linux-gnuexport GCC5_AARCH64_PREFIX=aarch64-linux-gnu-\n\n 构建EDK2\n source edksetup.shbuild -a AARCH64 -t GCC5 -p ArmVirtPkg/ArmVirtQemu.dsc -Y COMPILE_INFO -y BuildReport.log\n\n 编译出的固件在Build/ArmVirtQemu-AARCH64/DEBUG_GCC5。\n\n使用CLANG工具链\n 由于clang原生支持交叉编译，因此可以直接安装：\n sudo apt install clang llvm lld\n\n 构建EDK2\n source edksetup.shbuild -a AARCH64 -t CLANGDWARF -p ArmVirtPkg/ArmVirtQemu.dsc -Y COMPILE_INFO -y BuildReport.log\n\n 编译出的固件在Build/ArmVirtQemu-AARCH64/DEBUG_CLANGDWARF。\n\n\n在QEMU中启动启动所需的固件OVMF_CODE.fd和OVMF_VARS.fd在&lt;固件目录&gt;/FV中，这里以Build/OvmfX64/DEBUG_GCC5/FV和Build/ArmVirtQemu-AARCH64/DEBUG_GCC5/FV为例。\nX86架构cd Build/OvmfX64/DEBUG_GCC5/FVqemu-system-x86_64 -machine q35 -cpu qemu64 \\  -drive if=pflash,format=raw,unit=0,file=OVMF_CODE.fd,readonly=on \\  -drive if=pflash,format=raw,unit=1,file=OVMF_VARS.fd \\  -net none \\  -nographic\n\nAARCH64架构AARCH64要求pflash的大小为64M，因此我们首先需要调整固件大小到64M：\ncd Build/ArmVirtQemu-AARCH64/DEBUG_GCC5/FVdd if=/dev/zero of=QEMU_EFI_64.fd bs=1M count=64dd if=/dev/zero of=QEMU_VARS_64.fd bs=1M count=64dd if=QEMU_EFI.fd of=QEMU_EFI_64.fd conv=notruncdd if=QEMU_VARS.fd of=QEMU_VARS_64.fd conv=notrunc\n\nqemu-system-aarch64 -machine virt -cpu cortex-a57 \\  -drive if=pflash,format=raw,unit=0,file=QEMU_EFI_64.fd,readonly=on \\  -drive if=pflash,format=raw,unit=1,file=QEMU_VARS_64.fd \\  -net none \\  -nographic\n\n参考\nedk2 quickstart for virtualization\n\nhttps://wiki.osdev.org/EDK2\n\nhttps://wiki.osdev.org/UEFI\n\nHow to run OVMF\n\nBooting OVMF with -bios\n\n\n","categories":["Bootloader"],"tags":["UEFI","EDK2"]},{"title":"iTop-4412配置内核开发环境","url":"/2024/08/15/itop-4412-setup-kernel-dev-env.html","content":"\n虽然理论上开发板拿过来就可以使用，但如果正确配置环境，可以大大提高开发效率，事半功倍。\n\n\n\n搭建内核编译环境\n使能32位程序支持\n 因为交叉编译器为32位程序，因此需要安装32位动态库。\n sudo dpkg --add-architecture i386sudo apt install lib32z1 lib32ncurses6 lib32stdc++6\n\n安装交叉编译器\n # Download prebuilt toolchainwget https://github.com/colorfulshark/arm-2009q3/archive/refs/heads/master.zipunzip master.zipmv arm-2009q3-master arm-2009q3# install to target directorysudo mkdir /usr/local/armsudo mv arm-2009q3 /usr/local/arm/\n克隆内核源码\n git clone https://github.com/colorfulshark/iTop4412_Kernel_3.0.git\n\n编译内核\n # setup default configcp config_for_linux_9.7 .configmake\n\n刷写内核\n # execute in ubootfastboot# execute in hostsudo fastboot flash kernel arch/arm/boot/zImagesudo fastboot reboot\n\n搭建文件系统编译环境这里使用Buildroot构建文件系统，因为其对老内核的支持较好。\n\n克隆代码\n git clone https://gitlab.com/buildroot.org/buildroot.gitcd buildroot\n\n配置Buildroot\n make menuconfigTarget options:    Target Architecture: ARM (little endian)    Target Architecture Variant: cortex-A9Toolchain:    C library: musl    Kernel Headers: Manually specified Linux version    linux version: 3.0.15    Custom kernel headers series: 3.0.x\n\n构建Buildroot\n make\n\n解压rootfs\n sudo tar -xf output/images/rootfs.tar -C /rootfs\n\n设置NFS Boot网络启动使用NFS挂载根文件系统可以减少文件传输操作，提高开发效率，这里使用Buildroot作为根文件系统。\n\n配置NFS服务器\n sudo apt install nfs-kernel-serversudo vim /etc/exports&gt;&gt;&gt;/rootfs *(rw,sync,no_root_squash)&lt;&lt;&lt;sudo systemctl restart nfs-kernel-server\n\n配置内核选项\n Networking support:    Networking options:        IP: kernel level autoconfiguration:            IP: DHCP support: Y            IP: BOOTP support: Y            IP: RARP support: YFile systems:    Network File Systems:        NFS client support:            NFS client support for NFS version 3: Y        Root file system on NFS: YBoot options:    Default kernel command string: &quot;root=/dev/nfs nfsroot=192.168.0.1:/rootfs,proto=tcp,vers=3 rw ip=192.168.0.2:192.168.0.1:192.168.0.1:255.255.255.0:itop4412:eth0:off init=/linuxrc console=ttySAC2,115200 lcd=9.7&quot;\n\n调试NFS启动问题\n 如果内核无法挂载NFS根文件系统，可以使用以下内核cmdline进行调试\n\nnfsrootdebug: 启用NFS Root调试日志\nrootdelay&#x3D;N: 等待N秒后再挂载文件系统\nrootwait: 等待root出现后再挂载\n\n\n\n参考https://blog.csdn.net/ComputerInBook/article/details/107575590\nhttps://blog.colorfulshark.net/2020/08/23/setup-linux-2-6-system-from-scratch.html\n","categories":["Embedded"]},{"title":"使用VSCode进行内核开发","url":"/2024/12/22/kernel-development-with-vscode.html","content":"\nLinux内核并没有任何官方IDE，所以大家都是各显神通，比较常见的就是使用Vim&#x2F;Emacs结合各种插件，但这种方式普遍存在配置复杂和上手难度高的问题，我个人是不愿意浪费太多时间在IDE上的。碰巧有一款IDE，同样支持大量插件，并且社区活跃，它就是VSCode，所以今天就来看看如何通过各种插件将它打造为高效的内核开发IDE。\n\n\n\n远程连接Linux服务器我们要开发Linux内核，当然最好还是在Linux上进行，除非你的笔记本&#x2F;台式机就是Linux系统，我们更多的还是使用Windows&#x2F;Mac连接服务器来完成开发工作。\n通过使用Remote - SSH插件，我们可以像在本地一样，在远程服务器上进行开发。\n配置SSH连接\n# &lt;HOME&gt;/.ssh/configHost &lt;IP or hostname&gt;    HostName kernel-dev    User &lt;username&gt;\n\n设置代码索引和代码补全这一直是内核开发的老大难问题，因为内核源码过于庞大，以往的补全方案，要么速度快，但不精准，如ctags&#x2F;cscope；要么精准，但速度慢，如C&#x2F;C++ IntelliSense。\n然而clangd插件的出现，非常好的解决了速度和精确性的问题，但它有一个强依赖：需要使用compile_commands.json来生成索引数据。好在内核源码树中已经有工具可以为我们生成compile_commands.json。\n\n安装clangd\n sudo apt install clangd\n\n生成compile_commands.json\n 首先我们需要对内核或模块进行编译，编译成功后，在编译目录执行以下命令\n ./scripts/clang-tools/gen_compile_commands.py\n\n 打开compile_commands.json，确认不为空。\n\n配置clangd插件\n # Settings &gt; Remote &gt; Extensions &gt; clangd &gt; Arguments--compile-commands-dir=$&#123;workspaceFolder&#125;--background-index--completion-style=detailed--header-insertion=never-log=info-pretty-j=8\n\n 注意最后的-j=8是clangd在生成索引所创建的进程数，通常设置为CPU数量。\n\n配置工程\n 因为clangd使用clang来编译每个文件，如果我们的内核是使用GCC编译的，就会存在一些clang无法识别的编译选项，这些编译选项通常是用来进行代码优化的，所以去掉也不会影响代码索引。\n 在VSCode中执行命令&gt;clangd: Open project configuration file，打开.clangd文件，加入以下内容\n CompileFlags:    Remove:        - -m*        - -f*\n\n 如果你在开发内核模块，也可以使用Add参数附件内核头文件路径，例如\n CompileFlags:    Add:        - -I/kernel/include        - -I/kernel/arch/arm/include        - -I/kernel/arch/arm/include/generated\n\n重启clangd\n 在VSCode中执行命令&gt;clangd: Restart language server。\n\n\n配置汇编代码高亮做内核开发时，难免会涉及到一些汇编文件，但是VSCode默认并不对汇编文件进行高亮，因此需要安装插件来解决。\n\nARM汇编: Arm Assembly\n\nX86汇编: x86 and x86_64 Assembly\n\nMIPS汇编: MIPS Assembly Formatter\n\nLoongArch汇编: LoongArch Assembly\n\n\n显示代码历史git commit使用git blame是经常使用的“甩锅”手段，通过GitLens插件，我们可以实时看到每一行代码来自哪个commit。\n配置Vim快捷键我个人并不是Vim的狂热粉丝，但是Vim的快捷键设定，确实可以让我在大部分时间脱离鼠标和触控板，提高开发效率。通过安装Vim插件，即可立即享受大部分Vim的快捷键操作。\n参考https://github.com/clangd/clangd/issues/662\nhttps://stackoverflow.com/questions/49198816/how-to-use-the-visual-studio-code-to-navigate-linux-kernel-source\n","categories":["How-To"],"tags":["kernel","vscode"]},{"title":"部署私有IPTV流媒体服务","url":"/2025/01/25/setup-self-hosted-iptv-service.html","content":"\n最近有一大批IPv6的直播源被封，无奈需要寻找其他更流畅、更稳定的源，结果发现了一个全新的领域：部署私有IPTV流媒体服务，比如pixman，allinone等，本文会介绍市面主流的服务部署方式。\n\n\n\nPixman官网：https://pixman.io/\nTG：https://t.me/livednowgroup\n由于该项目短期内不会维护，已经无法正常播放。\nAllinone官网：https://pan.v1.mk/\n官方文档：https://pan.v1.mk/每期视频中用到的文件分享/allinone二进制文件/使用说明.md\nTG：https://t.me/feiyangdigital\n\n生成部署命令\n https://imgtool.v1.mk/allinone.html\n\n使用watchtower自动更新容器\n docker run -d --name watchtower --restart=always -v /var/run/docker.sock:/var/run/docker.sock containrrr/watchtower --cleanup --interval 3600\n\n下载m3u列表\n http:&#x2F;&#x2F;你的IP:35455&#x2F;tv.m3u\n\n使用格式化工具整理频道列表（可选）\n https://github.com/FanchangWang/allinone_format\n docker run -d --restart=unless-stopped --pull=always -v /etc/allinone_format:/app/config -p 35456:35456 --name allinone_format yuexuangu/allinone_format:latest\n\n http:&#x2F;&#x2F;你的IP:35456&#x2F;\n\n\nDoubeTG: https://t.me/doubebly003\ndocker run -d --name=doube-itv  --restart=always -p 50001:5000 doubebly/doube-itv:latest\n\nhttp:&#x2F;&#x2F;你的IP:50001&#x2F;help\nPGTG: https://t.me/PandaGroovePG\nPG需要进入TG发布群组后，手动下载软件包部署。\n","categories":["Geek","How-To"],"tags":["media","nas","iptv"]},{"title":"在Linux上部署Web文件管理器","url":"/2025/05/12/deploy-web-file-manager-on-linux.html","content":"\nLinux服务器的文件管理通常依赖sftp或samba，当网络环境较差时，操作延迟会变得非常大，甚至导致文件损坏，通过部署基于浏览器的文件管理服务，可以大大优化远程文件管理的体验。\n\n\n\n安装FileBrowsercurl -fsSL https://raw.githubusercontent.com/filebrowser/get/master/get.sh | bash\n\n配置Systemd只需修改WorkingDirectory为需要管理的目录即可。\n[Service]WorkingDirectory=/mntExecStart=/usr/local/bin/filebrowser -a 0.0.0.0Restart=alwaysStandardOutput=syslogStandardError=syslogSyslogIdentifier=filebrowserUser=rootGroup=rootEnvironment=[Install]WantedBy=multi-user.target\n\n参考链接https://filebrowser.org/installation\n","categories":["How-To"]}]